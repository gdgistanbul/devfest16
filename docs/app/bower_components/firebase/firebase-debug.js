!function(ns){ns.wrapper=function(goog,fb){function FirebaseIFrameScriptHolder(e,t,o,r){if(this.urlFn=r,this.onDisconnect=o,this.outstandingRequests=new fb.core.util.CountedSet,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,NODE_CLIENT)this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=fb.core.util.LUIDGenerator(),window[FIREBASE_LONGPOLL_COMMAND_CB_NAME+this.uniqueCallbackIdentifier]=e,window[FIREBASE_LONGPOLL_DATA_CB_NAME+this.uniqueCallbackIdentifier]=t,this.myIFrame=this.createIFrame_();var n="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)){var i=document.domain;n='<script>document.domain="'+i+'";</script>'}var a="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(e){fb.core.util.log("frame writing exception"),e.stack&&fb.core.util.log(e.stack),fb.core.util.log(e)}}}function letMeUseMapAccessors(){}var CLOSURE_NO_DEPS=!0,CLIENT_VERSION="2.4.2",COMPILED=!1,goog=goog||{};goog.global=this,goog.global.CLOSURE_UNCOMPILED_DEFINES,goog.global.CLOSURE_DEFINES,goog.isDef=function(e){return void 0!==e},goog.exportPath_=function(e,t,o){var r=e.split("."),n=o||goog.global;r[0]in n||!n.execScript||n.execScript("var "+r[0]);for(var i;r.length&&(i=r.shift());)!r.length&&goog.isDef(t)?n[i]=t:n=n[i]?n[i]:n[i]={}},goog.define=function(e,t){var o=t;COMPILED||(goog.global.CLOSURE_UNCOMPILED_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_UNCOMPILED_DEFINES,e)?o=goog.global.CLOSURE_UNCOMPILED_DEFINES[e]:goog.global.CLOSURE_DEFINES&&Object.prototype.hasOwnProperty.call(goog.global.CLOSURE_DEFINES,e)&&(o=goog.global.CLOSURE_DEFINES[e])),goog.exportPath_(e,o)},goog.define("goog.DEBUG",!0),goog.define("goog.LOCALE","en"),goog.define("goog.TRUSTED_SITE",!0),goog.define("goog.STRICT_MODE_COMPATIBLE",!1),goog.define("goog.DISALLOW_TEST_ONLY_CODE",COMPILED&&!goog.DEBUG),goog.provide=function(e){if(!COMPILED&&goog.isProvided_(e))throw Error('Namespace "'+e+'" already declared.');goog.constructNamespace_(e)},goog.constructNamespace_=function(e,t){if(!COMPILED){delete goog.implicitNamespaces_[e];for(var o=e;(o=o.substring(0,o.lastIndexOf(".")))&&!goog.getObjectByName(o);)goog.implicitNamespaces_[o]=!0}goog.exportPath_(e,t)},goog.VALID_MODULE_RE_=/^[a-zA-Z_$][a-zA-Z0-9._$]*$/,goog.module=function(e){if(!goog.isString(e)||!e||e.search(goog.VALID_MODULE_RE_)==-1)throw Error("Invalid module identifier");if(!goog.isInModuleLoader_())throw Error("Module "+e+" has been loaded incorrectly.");if(goog.moduleLoaderState_.moduleName)throw Error("goog.module may only be called once per module.");if(goog.moduleLoaderState_.moduleName=e,!COMPILED){if(goog.isProvided_(e))throw Error('Namespace "'+e+'" already declared.');delete goog.implicitNamespaces_[e]}},goog.module.get=function(e){return goog.module.getInternal_(e)},goog.module.getInternal_=function(e){if(!COMPILED)return goog.isProvided_(e)?e in goog.loadedModules_?goog.loadedModules_[e]:goog.getObjectByName(e):null},goog.moduleLoaderState_=null,goog.isInModuleLoader_=function(){return null!=goog.moduleLoaderState_},goog.module.declareTestMethods=function(){if(!goog.isInModuleLoader_())throw new Error("goog.module.declareTestMethods must be called from within a goog.module");goog.moduleLoaderState_.declareTestMethods=!0},goog.module.declareLegacyNamespace=function(){if(!COMPILED&&!goog.isInModuleLoader_())throw new Error("goog.module.declareLegacyNamespace must be called from within a goog.module");if(!COMPILED&&!goog.moduleLoaderState_.moduleName)throw Error("goog.module must be called prior to goog.module.declareLegacyNamespace.");goog.moduleLoaderState_.declareLegacyNamespace=!0},goog.setTestOnly=function(e){if(goog.DISALLOW_TEST_ONLY_CODE)throw e=e||"",Error("Importing test-only code into non-debug environment"+(e?": "+e:"."))},goog.forwardDeclare=function(e){},COMPILED||(goog.isProvided_=function(e){return e in goog.loadedModules_||!goog.implicitNamespaces_[e]&&goog.isDefAndNotNull(goog.getObjectByName(e))},goog.implicitNamespaces_={"goog.module":!0}),goog.getObjectByName=function(e,t){for(var o,r=e.split("."),n=t||goog.global;o=r.shift();){if(!goog.isDefAndNotNull(n[o]))return null;n=n[o]}return n},goog.globalize=function(e,t){var o=t||goog.global;for(var r in e)o[r]=e[r]},goog.addDependency=function(e,t,o,r){if(goog.DEPENDENCIES_ENABLED){for(var n,i,a=e.replace(/\\/g,"/"),s=goog.dependencies_,l=0;n=t[l];l++)s.nameToPath[n]=a,s.pathIsModule[a]=!!r;for(var g=0;i=o[g];g++)a in s.requires||(s.requires[a]={}),s.requires[a][i]=!0}},goog.define("goog.ENABLE_DEBUG_LOADER",!0),goog.logToConsole_=function(e){goog.global.console&&goog.global.console.error(e)},goog.require=function(e){if(!COMPILED){if(goog.ENABLE_DEBUG_LOADER&&goog.IS_OLD_IE_&&goog.maybeProcessDeferredDep_(e),goog.isProvided_(e))return goog.isInModuleLoader_()?goog.module.getInternal_(e):null;if(goog.ENABLE_DEBUG_LOADER){var t=goog.getPathFromDeps_(e);if(t)return goog.included_[t]=!0,goog.writeScripts_(),null}var o="goog.require could not find: "+e;throw goog.logToConsole_(o),Error(o)}},goog.basePath="",goog.global.CLOSURE_BASE_PATH,goog.global.CLOSURE_NO_DEPS,goog.global.CLOSURE_IMPORT_SCRIPT,goog.nullFunction=function(){},goog.identityFunction=function(e,t){return e},goog.abstractMethod=function(){throw Error("unimplemented abstract method")},goog.addSingletonGetter=function(e){e.getInstance=function(){return e.instance_?e.instance_:(goog.DEBUG&&(goog.instantiatedSingletons_[goog.instantiatedSingletons_.length]=e),e.instance_=new e)}},goog.instantiatedSingletons_=[],goog.define("goog.LOAD_MODULE_USING_EVAL",!0),goog.define("goog.SEAL_MODULE_EXPORTS",goog.DEBUG),goog.loadedModules_={},goog.DEPENDENCIES_ENABLED=!COMPILED&&goog.ENABLE_DEBUG_LOADER,goog.DEPENDENCIES_ENABLED&&(goog.included_={},goog.dependencies_={pathIsModule:{},nameToPath:{},requires:{},visited:{},written:{},deferred:{}},goog.inHtmlDocument_=function(){var e=goog.global.document;return"undefined"!=typeof e&&"write"in e},goog.findBasePath_=function(){if(goog.global.CLOSURE_BASE_PATH)return void(goog.basePath=goog.global.CLOSURE_BASE_PATH);if(goog.inHtmlDocument_())for(var e=goog.global.document,t=e.getElementsByTagName("script"),o=t.length-1;o>=0;--o){var r=t[o],n=r.src,i=n.lastIndexOf("?"),a=i==-1?n.length:i;if("base.js"==n.substr(a-7,7))return void(goog.basePath=n.substr(0,a-7))}},goog.importScript_=function(e,t){var o=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_;o(e,t)&&(goog.dependencies_.written[e]=!0)},goog.IS_OLD_IE_=!goog.global.atob&&goog.global.document&&goog.global.document.all,goog.importModule_=function(e){var t='goog.retrieveAndExecModule_("'+e+'");';goog.importScript_("",t)&&(goog.dependencies_.written[e]=!0)},goog.queuedModules_=[],goog.wrapModule_=function(e,t){return goog.LOAD_MODULE_USING_EVAL&&goog.isDef(goog.global.JSON)?"goog.loadModule("+goog.global.JSON.stringify(t+"\n//# sourceURL="+e+"\n")+");":'goog.loadModule(function(exports) {"use strict";'+t+"\n;return exports});\n//# sourceURL="+e+"\n"},goog.loadQueuedModules_=function(){var e=goog.queuedModules_.length;if(e>0){var t=goog.queuedModules_;goog.queuedModules_=[];for(var o=0;o<e;o++){var r=t[o];goog.maybeProcessDeferredPath_(r)}}},goog.maybeProcessDeferredDep_=function(e){if(goog.isDeferredModule_(e)&&goog.allDepsAreAvailable_(e)){var t=goog.getPathFromDeps_(e);goog.maybeProcessDeferredPath_(goog.basePath+t)}},goog.isDeferredModule_=function(e){var t=goog.getPathFromDeps_(e);if(t&&goog.dependencies_.pathIsModule[t]){var o=goog.basePath+t;return o in goog.dependencies_.deferred}return!1},goog.allDepsAreAvailable_=function(e){var t=goog.getPathFromDeps_(e);if(t&&t in goog.dependencies_.requires)for(var o in goog.dependencies_.requires[t])if(!goog.isProvided_(o)&&!goog.isDeferredModule_(o))return!1;return!0},goog.maybeProcessDeferredPath_=function(e){if(e in goog.dependencies_.deferred){var t=goog.dependencies_.deferred[e];delete goog.dependencies_.deferred[e],goog.globalEval(t)}},goog.loadModule=function(e){var t=goog.moduleLoaderState_;try{goog.moduleLoaderState_={moduleName:void 0,declareTestMethods:!1};var o;if(goog.isFunction(e))o=e.call(goog.global,{});else{if(!goog.isString(e))throw Error("Invalid module definition");o=goog.loadModuleFromSource_.call(goog.global,e)}var r=goog.moduleLoaderState_.moduleName;if(!goog.isString(r)||!r)throw Error('Invalid module name "'+r+'"');if(goog.moduleLoaderState_.declareLegacyNamespace?goog.constructNamespace_(r,o):goog.SEAL_MODULE_EXPORTS&&Object.seal&&Object.seal(o),goog.loadedModules_[r]=o,goog.moduleLoaderState_.declareTestMethods)for(var n in o)0!==n.indexOf("test",0)&&"tearDown"!=n&&"setUp"!=n&&"setUpPage"!=n&&"tearDownPage"!=n||(goog.global[n]=o[n])}finally{goog.moduleLoaderState_=t}},goog.loadModuleFromSource_=function(source){var exports={};return eval(arguments[0]),exports},goog.writeScriptTag_=function(e,t){if(goog.inHtmlDocument_()){var o=goog.global.document;if("complete"==o.readyState){var r=/\bdeps.js$/.test(e);if(r)return!1;throw Error('Cannot write "'+e+'" after document load')}var n=goog.IS_OLD_IE_;if(void 0===t)if(n){var i=" onreadystatechange='goog.onScriptLoad_(this, "+ ++goog.lastNonModuleScriptIndex_+")' ";o.write('<script type="text/javascript" src="'+e+'"'+i+"></script>")}else o.write('<script type="text/javascript" src="'+e+'"></script>');else o.write('<script type="text/javascript">'+t+"</script>");return!0}return!1},goog.lastNonModuleScriptIndex_=0,goog.onScriptLoad_=function(e,t){return"complete"==e.readyState&&goog.lastNonModuleScriptIndex_==t&&goog.loadQueuedModules_(),!0},goog.writeScripts_=function(){function e(n){if(!(n in r.written)){if(n in r.visited)return void(n in o||(o[n]=!0,t.push(n)));if(r.visited[n]=!0,n in r.requires)for(var i in r.requires[n])if(!goog.isProvided_(i)){if(!(i in r.nameToPath))throw Error("Undefined nameToPath for "+i);e(r.nameToPath[i])}n in o||(o[n]=!0,t.push(n))}}var t=[],o={},r=goog.dependencies_;for(var n in goog.included_)r.written[n]||e(n);for(var i=0;i<t.length;i++){var n=t[i];goog.dependencies_.written[n]=!0}var a=goog.moduleLoaderState_;goog.moduleLoaderState_=null;for(var s=!1,i=0;i<t.length;i++){var n=t[i];if(!n)throw goog.moduleLoaderState_=a,Error("Undefined script input");r.pathIsModule[n]?(s=!0,goog.importModule_(goog.basePath+n)):goog.importScript_(goog.basePath+n)}goog.moduleLoaderState_=a},goog.getPathFromDeps_=function(e){return e in goog.dependencies_.nameToPath?goog.dependencies_.nameToPath[e]:null},goog.findBasePath_(),goog.global.CLOSURE_NO_DEPS||goog.importScript_(goog.basePath+"deps.js")),goog.normalizePath_=function(e){for(var t=e.split("/"),o=0;o<t.length;)"."==t[o]?t.splice(o,1):o&&".."==t[o]&&t[o-1]&&".."!=t[o-1]?t.splice(--o,2):o++;return t.join("/")},goog.retrieveAndExecModule_=function(e){if(!COMPILED){var t=e;e=goog.normalizePath_(e);var o=goog.global.CLOSURE_IMPORT_SCRIPT||goog.writeScriptTag_,r=null,n=new goog.global.XMLHttpRequest;if(n.onload=function(){r=this.responseText},n.open("get",e,!1),n.send(),r=n.responseText,null==r)throw new Error("load of "+e+"failed");var i=goog.wrapModule_(e,r),a=goog.IS_OLD_IE_;a?(goog.dependencies_.deferred[t]=i,goog.queuedModules_.push(t)):o(e,i)}},goog.typeOf=function(e){var t=typeof e;if("object"==t){if(!e)return"null";if(e instanceof Array)return"array";if(e instanceof Object)return t;var o=Object.prototype.toString.call(e);if("[object Window]"==o)return"object";if("[object Array]"==o||"number"==typeof e.length&&"undefined"!=typeof e.splice&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("splice"))return"array";if("[object Function]"==o||"undefined"!=typeof e.call&&"undefined"!=typeof e.propertyIsEnumerable&&!e.propertyIsEnumerable("call"))return"function"}else if("function"==t&&"undefined"==typeof e.call)return"object";return t},goog.isNull=function(e){return null===e},goog.isDefAndNotNull=function(e){return null!=e},goog.isArray=function(e){return"array"==goog.typeOf(e)},goog.isArrayLike=function(e){var t=goog.typeOf(e);return"array"==t||"object"==t&&"number"==typeof e.length},goog.isDateLike=function(e){return goog.isObject(e)&&"function"==typeof e.getFullYear},goog.isString=function(e){return"string"==typeof e},goog.isBoolean=function(e){return"boolean"==typeof e},goog.isNumber=function(e){return"number"==typeof e},goog.isFunction=function(e){return"function"==goog.typeOf(e)},goog.isObject=function(e){var t=typeof e;return"object"==t&&null!=e||"function"==t},goog.getUid=function(e){return e[goog.UID_PROPERTY_]||(e[goog.UID_PROPERTY_]=++goog.uidCounter_)},goog.hasUid=function(e){return!!e[goog.UID_PROPERTY_]},goog.removeUid=function(e){"removeAttribute"in e&&e.removeAttribute(goog.UID_PROPERTY_);try{delete e[goog.UID_PROPERTY_]}catch(e){}},goog.UID_PROPERTY_="closure_uid_"+(1e9*Math.random()>>>0),goog.uidCounter_=0,goog.getHashCode=goog.getUid,goog.removeHashCode=goog.removeUid,goog.cloneObject=function(e){var t=goog.typeOf(e);if("object"==t||"array"==t){if(e.clone)return e.clone();var o="array"==t?[]:{};for(var r in e)o[r]=goog.cloneObject(e[r]);return o}return e},goog.bindNative_=function(e,t,o){return e.call.apply(e.bind,arguments)},goog.bindJs_=function(e,t,o){if(!e)throw new Error;if(arguments.length>2){var r=Array.prototype.slice.call(arguments,2);return function(){var o=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(o,r),e.apply(t,o)}}return function(){return e.apply(t,arguments)}},goog.bind=function(e,t,o){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?goog.bind=goog.bindNative_:goog.bind=goog.bindJs_,goog.bind.apply(null,arguments)},goog.partial=function(e,t){var o=Array.prototype.slice.call(arguments,1);return function(){var t=o.slice();return t.push.apply(t,arguments),e.apply(this,t)}},goog.mixin=function(e,t){for(var o in t)e[o]=t[o]},goog.now=goog.TRUSTED_SITE&&Date.now||function(){return+new Date},goog.globalEval=function(e){if(goog.global.execScript)goog.global.execScript(e,"JavaScript");else{if(!goog.global.eval)throw Error("goog.globalEval not available");if(null==goog.evalWorksForGlobals_&&(goog.global.eval("var _et_ = 1;"),"undefined"!=typeof goog.global._et_?(delete goog.global._et_,goog.evalWorksForGlobals_=!0):goog.evalWorksForGlobals_=!1),goog.evalWorksForGlobals_)goog.global.eval(e);else{var t=goog.global.document,o=t.createElement("script");o.type="text/javascript",o.defer=!1,o.appendChild(t.createTextNode(e)),t.body.appendChild(o),t.body.removeChild(o)}}},goog.evalWorksForGlobals_=null,goog.cssNameMapping_,goog.cssNameMappingStyle_,goog.getCssName=function(e,t){var o,r=function(e){return goog.cssNameMapping_[e]||e},n=function(e){for(var t=e.split("-"),o=[],n=0;n<t.length;n++)o.push(r(t[n]));return o.join("-")};return o=goog.cssNameMapping_?"BY_WHOLE"==goog.cssNameMappingStyle_?r:n:function(e){return e},t?e+"-"+o(t):o(e)},goog.setCssNameMapping=function(e,t){goog.cssNameMapping_=e,goog.cssNameMappingStyle_=t},goog.global.CLOSURE_CSS_NAME_MAPPING,!COMPILED&&goog.global.CLOSURE_CSS_NAME_MAPPING&&(goog.cssNameMapping_=goog.global.CLOSURE_CSS_NAME_MAPPING),goog.getMsg=function(e,t){return t&&(e=e.replace(/\{\$([^}]+)}/g,function(e,o){return o in t?t[o]:e})),e},goog.getMsgWithFallback=function(e,t){return e},goog.exportSymbol=function(e,t,o){goog.exportPath_(e,t,o)},goog.exportProperty=function(e,t,o){e[t]=o},goog.inherits=function(e,t){function o(){}o.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new o,e.prototype.constructor=e,e.base=function(e,o,r){for(var n=new Array(arguments.length-2),i=2;i<arguments.length;i++)n[i-2]=arguments[i];return t.prototype[o].apply(e,n)}},goog.base=function(e,t,o){var r=arguments.callee.caller;if(goog.STRICT_MODE_COMPATIBLE||goog.DEBUG&&!r)throw Error("arguments.caller not defined.  goog.base() cannot be used with strict mode code. See http://www.ecma-international.org/ecma-262/5.1/#sec-C");if(r.superClass_){for(var n=new Array(arguments.length-1),i=1;i<arguments.length;i++)n[i-1]=arguments[i];return r.superClass_.constructor.apply(e,n)}for(var a=new Array(arguments.length-2),i=2;i<arguments.length;i++)a[i-2]=arguments[i];for(var s=!1,l=e.constructor;l;l=l.superClass_&&l.superClass_.constructor)if(l.prototype[t]===r)s=!0;else if(s)return l.prototype[t].apply(e,a);if(e[t]===r)return e.constructor.prototype[t].apply(e,a);throw Error("goog.base called from a method of one name to a method of a different name")},goog.scope=function(e){e.call(goog.global)},COMPILED||(goog.global.COMPILED=COMPILED),goog.defineClass=function(e,t){var o=t.constructor,r=t.statics;o&&o!=Object.prototype.constructor||(o=function(){throw Error("cannot instantiate an interface (no constructor defined).")});var n=goog.defineClass.createSealingConstructor_(o,e);return e&&goog.inherits(n,e),delete t.constructor,delete t.statics,goog.defineClass.applyProperties_(n.prototype,t),null!=r&&(r instanceof Function?r(n):goog.defineClass.applyProperties_(n,r)),n},goog.defineClass.ClassDescriptor,goog.define("goog.defineClass.SEAL_CLASS_INSTANCES",goog.DEBUG),goog.defineClass.createSealingConstructor_=function(e,t){if(goog.defineClass.SEAL_CLASS_INSTANCES&&Object.seal instanceof Function){if(t&&t.prototype&&t.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_])return e;var o=function(){var t=e.apply(this,arguments)||this;return t[goog.UID_PROPERTY_]=t[goog.UID_PROPERTY_],this.constructor===o&&Object.seal(t),t};return o}return e},goog.defineClass.OBJECT_PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],goog.defineClass.applyProperties_=function(e,t){var o;for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);for(var r=0;r<goog.defineClass.OBJECT_PROTOTYPE_FIELDS_.length;r++)o=goog.defineClass.OBJECT_PROTOTYPE_FIELDS_[r],Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])},goog.tagUnsealableClass=function(e){!COMPILED&&goog.defineClass.SEAL_CLASS_INSTANCES&&(e.prototype[goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_]=!0)},goog.UNSEALABLE_CONSTRUCTOR_PROPERTY_="goog_defineClass_legacy_unsealable",goog.provide("goog.functions"),goog.functions.constant=function(e){return function(){return e}},goog.functions.FALSE=goog.functions.constant(!1),goog.functions.TRUE=goog.functions.constant(!0),goog.functions.NULL=goog.functions.constant(null),goog.functions.identity=function(e,t){return e},goog.functions.error=function(e){return function(){throw Error(e)}},goog.functions.fail=function(e){return function(){throw e}},goog.functions.lock=function(e,t){return t=t||0,function(){return e.apply(this,Array.prototype.slice.call(arguments,0,t))}},goog.functions.nth=function(e){return function(){return arguments[e]}},goog.functions.withReturnValue=function(e,t){return goog.functions.sequence(e,goog.functions.constant(t))},goog.functions.equalTo=function(e,t){return function(o){return t?e==o:e===o}},goog.functions.compose=function(e,t){var o=arguments,r=o.length;return function(){var e;r&&(e=o[r-1].apply(this,arguments));for(var t=r-2;t>=0;t--)e=o[t].call(this,e);return e}},goog.functions.sequence=function(e){var t=arguments,o=t.length;return function(){for(var e,r=0;r<o;r++)e=t[r].apply(this,arguments);return e}},goog.functions.and=function(e){var t=arguments,o=t.length;return function(){for(var e=0;e<o;e++)if(!t[e].apply(this,arguments))return!1;return!0}},goog.functions.or=function(e){var t=arguments,o=t.length;return function(){for(var e=0;e<o;e++)if(t[e].apply(this,arguments))return!0;return!1}},goog.functions.not=function(e){return function(){return!e.apply(this,arguments)}},goog.functions.create=function(e,t){var o=function(){};o.prototype=e.prototype;var r=new o;return e.apply(r,Array.prototype.slice.call(arguments,1)),r},goog.define("goog.functions.CACHE_RETURN_VALUE",!0),goog.functions.cacheReturnValue=function(e){var t,o=!1;return function(){return goog.functions.CACHE_RETURN_VALUE?(o||(t=e(),o=!0),t):e()}},goog.provide("goog.debug.Error"),goog.debug.Error=function(e){if(Error.captureStackTrace)Error.captureStackTrace(this,goog.debug.Error);else{var t=(new Error).stack;t&&(this.stack=t)}e&&(this.message=String(e))},goog.inherits(goog.debug.Error,Error),goog.debug.Error.prototype.name="CustomError",goog.provide("goog.object"),goog.object.forEach=function(e,t,o){for(var r in e)t.call(o,e[r],r,e)},goog.object.filter=function(e,t,o){var r={};for(var n in e)t.call(o,e[n],n,e)&&(r[n]=e[n]);return r},goog.object.map=function(e,t,o){var r={};for(var n in e)r[n]=t.call(o,e[n],n,e);return r},goog.object.some=function(e,t,o){for(var r in e)if(t.call(o,e[r],r,e))return!0;return!1},goog.object.every=function(e,t,o){for(var r in e)if(!t.call(o,e[r],r,e))return!1;return!0},goog.object.getCount=function(e){var t=0;for(var o in e)t++;return t},goog.object.getAnyKey=function(e){for(var t in e)return t},goog.object.getAnyValue=function(e){for(var t in e)return e[t]},goog.object.contains=function(e,t){return goog.object.containsValue(e,t)},goog.object.getValues=function(e){var t=[],o=0;for(var r in e)t[o++]=e[r];return t},goog.object.getKeys=function(e){var t=[],o=0;for(var r in e)t[o++]=r;return t},goog.object.getValueByKeys=function(e,t){for(var o=goog.isArrayLike(t),r=o?t:arguments,n=o?0:1;n<r.length&&(e=e[r[n]],goog.isDef(e));n++);return e},goog.object.containsKey=function(e,t){return t in e},goog.object.containsValue=function(e,t){for(var o in e)if(e[o]==t)return!0;return!1},goog.object.findKey=function(e,t,o){for(var r in e)if(t.call(o,e[r],r,e))return r},goog.object.findValue=function(e,t,o){var r=goog.object.findKey(e,t,o);return r&&e[r]},goog.object.isEmpty=function(e){for(var t in e)return!1;return!0},goog.object.clear=function(e){for(var t in e)delete e[t]},goog.object.remove=function(e,t){var o;return(o=t in e)&&delete e[t],o},goog.object.add=function(e,t,o){if(t in e)throw Error('The object already contains the key "'+t+'"');goog.object.set(e,t,o)},goog.object.get=function(e,t,o){return t in e?e[t]:o},goog.object.set=function(e,t,o){e[t]=o},goog.object.setIfUndefined=function(e,t,o){return t in e?e[t]:e[t]=o},goog.object.setWithReturnValueIfNotSet=function(e,t,o){if(t in e)return e[t];var r=o();return e[t]=r,r},goog.object.equals=function(e,t){for(var o in e)if(!(o in t)||e[o]!==t[o])return!1;for(var o in t)if(!(o in e))return!1;return!0},goog.object.clone=function(e){var t={};for(var o in e)t[o]=e[o];return t},goog.object.unsafeClone=function(e){var t=goog.typeOf(e);if("object"==t||"array"==t){if(e.clone)return e.clone();var o="array"==t?[]:{};for(var r in e)o[r]=goog.object.unsafeClone(e[r]);return o}return e},goog.object.transpose=function(e){var t={};for(var o in e)t[e[o]]=o;return t},goog.object.PROTOTYPE_FIELDS_=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],goog.object.extend=function(e,t){for(var o,r,n=1;n<arguments.length;n++){r=arguments[n];for(o in r)e[o]=r[o];for(var i=0;i<goog.object.PROTOTYPE_FIELDS_.length;i++)o=goog.object.PROTOTYPE_FIELDS_[i],Object.prototype.hasOwnProperty.call(r,o)&&(e[o]=r[o])}},goog.object.create=function(e){var t=arguments.length;if(1==t&&goog.isArray(arguments[0]))return goog.object.create.apply(null,arguments[0]);if(t%2)throw Error("Uneven number of arguments");for(var o={},r=0;r<t;r+=2)o[arguments[r]]=arguments[r+1];return o},goog.object.createSet=function(e){var t=arguments.length;if(1==t&&goog.isArray(arguments[0]))return goog.object.createSet.apply(null,arguments[0]);for(var o={},r=0;r<t;r++)o[arguments[r]]=!0;return o},goog.object.createImmutableView=function(e){var t=e;return Object.isFrozen&&!Object.isFrozen(e)&&(t=Object.create(e),Object.freeze(t)),t},goog.object.isImmutableView=function(e){return!!Object.isFrozen&&Object.isFrozen(e)},goog.provide("goog.dom.NodeType"),goog.dom.NodeType={ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12},goog.provide("goog.json"),goog.provide("goog.json.Replacer"),goog.provide("goog.json.Reviver"),goog.provide("goog.json.Serializer"),goog.define("goog.json.USE_NATIVE_JSON",!1),goog.json.isValid=function(e){if(/^\s*$/.test(e))return!1;var t=/\\["\\\/bfnrtu]/g,o=/"[^"\\\n\r\u2028\u2029\x00-\x08\x0a-\x1f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,r=/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,n=/^[\],:{}\s\u2028\u2029]*$/;return n.test(e.replace(t,"@").replace(o,"]").replace(r,""))},goog.json.parse=goog.json.USE_NATIVE_JSON?goog.global.JSON.parse:function(s){var o=String(s);if(goog.json.isValid(o))try{return eval("("+o+")")}catch(e){}throw Error("Invalid JSON string: "+o)},goog.json.unsafeParse=goog.json.USE_NATIVE_JSON?goog.global.JSON.parse:function(s){return eval("("+s+")")},goog.json.Replacer,goog.json.Reviver,goog.json.serialize=goog.json.USE_NATIVE_JSON?goog.global.JSON.stringify:function(e,t){return new goog.json.Serializer(t).serialize(e)},goog.json.Serializer=function(e){this.replacer_=e},goog.json.Serializer.prototype.serialize=function(e){var t=[];return this.serializeInternal(e,t),t.join("")},goog.json.Serializer.prototype.serializeInternal=function(e,t){switch(typeof e){case"string":this.serializeString_(e,t);break;case"number":this.serializeNumber_(e,t);break;case"boolean":t.push(e);break;case"undefined":t.push("null");break;case"object":if(null==e){t.push("null");break}if(goog.isArray(e)){this.serializeArray(e,t);break}this.serializeObject_(e,t);break;case"function":break;default:throw Error("Unknown type: "+typeof e)}},goog.json.Serializer.charToJsonCharCache_={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},goog.json.Serializer.charsToReplace_=/\uffff/.test("￿")?/[\\\"\x00-\x1f\x7f-\uffff]/g:/[\\\"\x00-\x1f\x7f-\xff]/g,goog.json.Serializer.prototype.serializeString_=function(e,t){t.push('"',e.replace(goog.json.Serializer.charsToReplace_,function(e){if(e in goog.json.Serializer.charToJsonCharCache_)return goog.json.Serializer.charToJsonCharCache_[e];var t=e.charCodeAt(0),o="\\u";return t<16?o+="000":t<256?o+="00":t<4096&&(o+="0"),goog.json.Serializer.charToJsonCharCache_[e]=o+t.toString(16)}),'"')},goog.json.Serializer.prototype.serializeNumber_=function(e,t){t.push(isFinite(e)&&!isNaN(e)?e:"null")},goog.json.Serializer.prototype.serializeArray=function(e,t){var o=e.length;t.push("[");for(var r="",n=0;n<o;n++){t.push(r);var i=e[n];this.serializeInternal(this.replacer_?this.replacer_.call(e,String(n),i):i,t),r=","}t.push("]")},goog.json.Serializer.prototype.serializeObject_=function(e,t){t.push("{");var o="";for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)){var n=e[r];"function"!=typeof n&&(t.push(o),this.serializeString_(r,t),t.push(":"),this.serializeInternal(this.replacer_?this.replacer_.call(e,r,n):n,t),o=",")}t.push("}")},goog.provide("goog.string"),goog.provide("goog.string.Unicode"),goog.define("goog.string.DETECT_DOUBLE_ESCAPING",!1),goog.define("goog.string.FORCE_NON_DOM_HTML_UNESCAPING",!1),goog.string.Unicode={NBSP:" "},goog.string.startsWith=function(e,t){return 0==e.lastIndexOf(t,0)},goog.string.endsWith=function(e,t){var o=e.length-t.length;return o>=0&&e.indexOf(t,o)==o},goog.string.caseInsensitiveStartsWith=function(e,t){return 0==goog.string.caseInsensitiveCompare(t,e.substr(0,t.length))},goog.string.caseInsensitiveEndsWith=function(e,t){return 0==goog.string.caseInsensitiveCompare(t,e.substr(e.length-t.length,t.length))},goog.string.caseInsensitiveEquals=function(e,t){return e.toLowerCase()==t.toLowerCase()},goog.string.subs=function(e,t){for(var o=e.split("%s"),r="",n=Array.prototype.slice.call(arguments,1);n.length&&o.length>1;)r+=o.shift()+n.shift();return r+o.join("%s")},goog.string.collapseWhitespace=function(e){return e.replace(/[\s\xa0]+/g," ").replace(/^\s+|\s+$/g,"")},goog.string.isEmptyOrWhitespace=function(e){return/^[\s\xa0]*$/.test(e)},goog.string.isEmptyString=function(e){return 0==e.length},goog.string.isEmpty=goog.string.isEmptyOrWhitespace,goog.string.isEmptyOrWhitespaceSafe=function(e){return goog.string.isEmptyOrWhitespace(goog.string.makeSafe(e))},goog.string.isEmptySafe=goog.string.isEmptyOrWhitespaceSafe,goog.string.isBreakingWhitespace=function(e){return!/[^\t\n\r ]/.test(e)},goog.string.isAlpha=function(e){return!/[^a-zA-Z]/.test(e)},goog.string.isNumeric=function(e){return!/[^0-9]/.test(e)},goog.string.isAlphaNumeric=function(e){return!/[^a-zA-Z0-9]/.test(e)},goog.string.isSpace=function(e){return" "==e},goog.string.isUnicodeChar=function(e){return 1==e.length&&e>=" "&&e<="~"||e>=""&&e<="�"},goog.string.stripNewlines=function(e){return e.replace(/(\r\n|\r|\n)+/g," ")};goog.string.canonicalizeNewlines=function(e){return e.replace(/(\r\n|\r|\n)/g,"\n")};goog.string.normalizeWhitespace=function(e){return e.replace(/\xa0|\s/g," ")},goog.string.normalizeSpaces=function(e){return e.replace(/\xa0|[ \t]+/g," ")},goog.string.collapseBreakingSpaces=function(e){return e.replace(/[\t\r\n ]+/g," ").replace(/^[\t\r\n ]+|[\t\r\n ]+$/g,"")},goog.string.trim=goog.TRUSTED_SITE&&String.prototype.trim?function(e){return e.trim()}:function(e){return e.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},goog.string.trimLeft=function(e){return e.replace(/^[\s\xa0]+/,"")},goog.string.trimRight=function(e){return e.replace(/[\s\xa0]+$/,"")},goog.string.caseInsensitiveCompare=function(e,t){var o=String(e).toLowerCase(),r=String(t).toLowerCase();return o<r?-1:o==r?0:1},goog.string.numerateCompareRegExp_=/(\.\d+)|(\d+)|(\D+)/g,goog.string.numerateCompare=function(e,t){if(e==t)return 0;if(!e)return-1;if(!t)return 1;for(var o=e.toLowerCase().match(goog.string.numerateCompareRegExp_),r=t.toLowerCase().match(goog.string.numerateCompareRegExp_),n=Math.min(o.length,r.length),i=0;i<n;i++){var a=o[i],s=r[i];if(a!=s){var l=parseInt(a,10);if(!isNaN(l)){var g=parseInt(s,10);if(!isNaN(g)&&l-g)return l-g}return a<s?-1:1}}return o.length!=r.length?o.length-r.length:e<t?-1:1},goog.string.urlEncode=function(e){return encodeURIComponent(String(e))},goog.string.urlDecode=function(e){return decodeURIComponent(e.replace(/\+/g," "))},goog.string.newLineToBr=function(e,t){return e.replace(/(\r\n|\r|\n)/g,t?"<br />":"<br>")},goog.string.htmlEscape=function(e,t){return t?(e=e.replace(goog.string.AMP_RE_,"&amp;").replace(goog.string.LT_RE_,"&lt;").replace(goog.string.GT_RE_,"&gt;").replace(goog.string.QUOT_RE_,"&quot;").replace(goog.string.SINGLE_QUOTE_RE_,"&#39;").replace(goog.string.NULL_RE_,"&#0;"),goog.string.DETECT_DOUBLE_ESCAPING&&(e=e.replace(goog.string.E_RE_,"&#101;")),e):goog.string.ALL_RE_.test(e)?(e.indexOf("&")!=-1&&(e=e.replace(goog.string.AMP_RE_,"&amp;")),e.indexOf("<")!=-1&&(e=e.replace(goog.string.LT_RE_,"&lt;")),e.indexOf(">")!=-1&&(e=e.replace(goog.string.GT_RE_,"&gt;")),e.indexOf('"')!=-1&&(e=e.replace(goog.string.QUOT_RE_,"&quot;")),e.indexOf("'")!=-1&&(e=e.replace(goog.string.SINGLE_QUOTE_RE_,"&#39;")),e.indexOf("\0")!=-1&&(e=e.replace(goog.string.NULL_RE_,"&#0;")),goog.string.DETECT_DOUBLE_ESCAPING&&e.indexOf("e")!=-1&&(e=e.replace(goog.string.E_RE_,"&#101;")),e):e},goog.string.AMP_RE_=/&/g,goog.string.LT_RE_=/</g,goog.string.GT_RE_=/>/g,goog.string.QUOT_RE_=/"/g,goog.string.SINGLE_QUOTE_RE_=/'/g,goog.string.NULL_RE_=/\x00/g,goog.string.E_RE_=/e/g,goog.string.ALL_RE_=goog.string.DETECT_DOUBLE_ESCAPING?/[\x00&<>"'e]/:/[\x00&<>"']/,goog.string.unescapeEntities=function(e){return goog.string.contains(e,"&")?!goog.string.FORCE_NON_DOM_HTML_UNESCAPING&&"document"in goog.global?goog.string.unescapeEntitiesUsingDom_(e):goog.string.unescapePureXmlEntities_(e):e},goog.string.unescapeEntitiesWithDocument=function(e,t){return goog.string.contains(e,"&")?goog.string.unescapeEntitiesUsingDom_(e,t):e},goog.string.unescapeEntitiesUsingDom_=function(e,t){var o,r={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"'};return o=t?t.createElement("div"):goog.global.document.createElement("div"),e.replace(goog.string.HTML_ENTITY_PATTERN_,function(e,t){var n=r[e];if(n)return n;if("#"==t.charAt(0)){var i=Number("0"+t.substr(1));
isNaN(i)||(n=String.fromCharCode(i))}return n||(o.innerHTML=e+" ",n=o.firstChild.nodeValue.slice(0,-1)),r[e]=n})},goog.string.unescapePureXmlEntities_=function(e){return e.replace(/&([^;]+);/g,function(e,t){switch(t){case"amp":return"&";case"lt":return"<";case"gt":return">";case"quot":return'"';default:if("#"==t.charAt(0)){var o=Number("0"+t.substr(1));if(!isNaN(o))return String.fromCharCode(o)}return e}})},goog.string.HTML_ENTITY_PATTERN_=/&([^;\s<&]+);?/g,goog.string.whitespaceEscape=function(e,t){return goog.string.newLineToBr(e.replace(/  /g," &#160;"),t)},goog.string.preserveSpaces=function(e){return e.replace(/(^|[\n ]) /g,"$1"+goog.string.Unicode.NBSP)},goog.string.stripQuotes=function(e,t){for(var o=t.length,r=0;r<o;r++){var n=1==o?t:t.charAt(r);if(e.charAt(0)==n&&e.charAt(e.length-1)==n)return e.substring(1,e.length-1)}return e},goog.string.truncate=function(e,t,o){return o&&(e=goog.string.unescapeEntities(e)),e.length>t&&(e=e.substring(0,t-3)+"..."),o&&(e=goog.string.htmlEscape(e)),e},goog.string.truncateMiddle=function(e,t,o,r){if(o&&(e=goog.string.unescapeEntities(e)),r&&e.length>t){r>t&&(r=t);var n=e.length-r,i=t-r;e=e.substring(0,i)+"..."+e.substring(n)}else if(e.length>t){var a=Math.floor(t/2),s=e.length-a;a+=t%2,e=e.substring(0,a)+"..."+e.substring(s)}return o&&(e=goog.string.htmlEscape(e)),e},goog.string.specialEscapeChars_={"\0":"\\0","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\x0B",'"':'\\"',"\\":"\\\\"},goog.string.jsEscapeCache_={"'":"\\'"},goog.string.quote=function(e){if(e=String(e),e.quote)return e.quote();for(var t=['"'],o=0;o<e.length;o++){var r=e.charAt(o),n=r.charCodeAt(0);t[o+1]=goog.string.specialEscapeChars_[r]||(n>31&&n<127?r:goog.string.escapeChar(r))}return t.push('"'),t.join("")},goog.string.escapeString=function(e){for(var t=[],o=0;o<e.length;o++)t[o]=goog.string.escapeChar(e.charAt(o));return t.join("")},goog.string.escapeChar=function(e){if(e in goog.string.jsEscapeCache_)return goog.string.jsEscapeCache_[e];if(e in goog.string.specialEscapeChars_)return goog.string.jsEscapeCache_[e]=goog.string.specialEscapeChars_[e];var t=e,o=e.charCodeAt(0);return o>31&&o<127?t=e:(o<256?(t="\\x",(o<16||o>256)&&(t+="0")):(t="\\u",o<4096&&(t+="0")),t+=o.toString(16).toUpperCase()),goog.string.jsEscapeCache_[e]=t},goog.string.contains=function(e,t){return e.indexOf(t)!=-1},goog.string.caseInsensitiveContains=function(e,t){return goog.string.contains(e.toLowerCase(),t.toLowerCase())},goog.string.countOf=function(e,t){return e&&t?e.split(t).length-1:0},goog.string.removeAt=function(e,t,o){var r=e;return t>=0&&t<e.length&&o>0&&(r=e.substr(0,t)+e.substr(t+o,e.length-t-o)),r},goog.string.remove=function(e,t){var o=new RegExp(goog.string.regExpEscape(t),"");return e.replace(o,"")},goog.string.removeAll=function(e,t){var o=new RegExp(goog.string.regExpEscape(t),"g");return e.replace(o,"")},goog.string.regExpEscape=function(e){return String(e).replace(/([-()\[\]{}+?*.$\^|,:#<!\\])/g,"\\$1").replace(/\x08/g,"\\x08")},goog.string.repeat=function(e,t){return new Array(t+1).join(e)},goog.string.padNumber=function(e,t,o){var r=goog.isDef(o)?e.toFixed(o):String(e),n=r.indexOf(".");return n==-1&&(n=r.length),goog.string.repeat("0",Math.max(0,t-n))+r},goog.string.makeSafe=function(e){return null==e?"":String(e)},goog.string.buildString=function(e){return Array.prototype.join.call(arguments,"")},goog.string.getRandomString=function(){var e=2147483648;return Math.floor(Math.random()*e).toString(36)+Math.abs(Math.floor(Math.random()*e)^goog.now()).toString(36)},goog.string.compareVersions=function(e,t){for(var o=0,r=goog.string.trim(String(e)).split("."),n=goog.string.trim(String(t)).split("."),i=Math.max(r.length,n.length),a=0;0==o&&a<i;a++){var s=r[a]||"",l=n[a]||"",g=new RegExp("(\\d*)(\\D*)","g"),u=new RegExp("(\\d*)(\\D*)","g");do{var c=g.exec(s)||["","",""],f=u.exec(l)||["","",""];if(0==c[0].length&&0==f[0].length)break;var h=0==c[1].length?0:parseInt(c[1],10),p=0==f[1].length?0:parseInt(f[1],10);o=goog.string.compareElements_(h,p)||goog.string.compareElements_(0==c[2].length,0==f[2].length)||goog.string.compareElements_(c[2],f[2])}while(0==o)}return o},goog.string.compareElements_=function(e,t){return e<t?-1:e>t?1:0},goog.string.HASHCODE_MAX_=4294967296,goog.string.hashCode=function(e){for(var t=0,o=0;o<e.length;++o)t=31*t+e.charCodeAt(o),t%=goog.string.HASHCODE_MAX_;return t},goog.string.uniqueStringCounter_=2147483648*Math.random()|0,goog.string.createUniqueString=function(){return"goog_"+goog.string.uniqueStringCounter_++},goog.string.toNumber=function(e){var t=Number(e);return 0==t&&goog.string.isEmptyOrWhitespace(e)?NaN:t},goog.string.isLowerCamelCase=function(e){return/^[a-z]+([A-Z][a-z]*)*$/.test(e)},goog.string.isUpperCamelCase=function(e){return/^([A-Z][a-z]*)+$/.test(e)},goog.string.toCamelCase=function(e){return String(e).replace(/\-([a-z])/g,function(e,t){return t.toUpperCase()})},goog.string.toSelectorCase=function(e){return String(e).replace(/([A-Z])/g,"-$1").toLowerCase()},goog.string.toTitleCase=function(e,t){var o=goog.isString(t)?goog.string.regExpEscape(t):"\\s";o=o?"|["+o+"]+":"";var r=new RegExp("(^"+o+")([a-z])","g");return e.replace(r,function(e,t,o){return t+o.toUpperCase()})},goog.string.capitalize=function(e){return String(e.charAt(0)).toUpperCase()+String(e.substr(1)).toLowerCase()},goog.string.parseInt=function(e){return isFinite(e)&&(e=String(e)),goog.isString(e)?/^\s*-?0x/i.test(e)?parseInt(e,16):parseInt(e,10):NaN},goog.string.splitLimit=function(e,t,o){for(var r=e.split(t),n=[];o>0&&r.length;)n.push(r.shift()),o--;return r.length&&n.push(r.join(t)),n},goog.string.editDistance=function(e,t){var o=[],r=[];if(e==t)return 0;if(!e.length||!t.length)return Math.max(e.length,t.length);for(var n=0;n<t.length+1;n++)o[n]=n;for(var n=0;n<e.length;n++){r[0]=n+1;for(var i=0;i<t.length;i++){var a=e[n]!=t[i];r[i+1]=Math.min(r[i]+1,o[i+1]+1,o[i]+a)}for(var i=0;i<o.length;i++)o[i]=r[i]}return r[t.length]},goog.provide("goog.labs.userAgent.util"),goog.require("goog.string"),goog.labs.userAgent.util.getNativeUserAgentString_=function(){var e=goog.labs.userAgent.util.getNavigator_();if(e){var t=e.userAgent;if(t)return t}return""},goog.labs.userAgent.util.getNavigator_=function(){return goog.global.navigator},goog.labs.userAgent.util.userAgent_=goog.labs.userAgent.util.getNativeUserAgentString_(),goog.labs.userAgent.util.setUserAgent=function(e){goog.labs.userAgent.util.userAgent_=e||goog.labs.userAgent.util.getNativeUserAgentString_()},goog.labs.userAgent.util.getUserAgent=function(){return goog.labs.userAgent.util.userAgent_},goog.labs.userAgent.util.matchUserAgent=function(e){var t=goog.labs.userAgent.util.getUserAgent();return goog.string.contains(t,e)},goog.labs.userAgent.util.matchUserAgentIgnoreCase=function(e){var t=goog.labs.userAgent.util.getUserAgent();return goog.string.caseInsensitiveContains(t,e)},goog.labs.userAgent.util.extractVersionTuples=function(e){for(var t,o=new RegExp("(\\w[\\w ]+)/([^\\s]+)\\s*(?:\\((.*?)\\))?","g"),r=[];t=o.exec(e);)r.push([t[1],t[2],t[3]||void 0]);return r},goog.provide("goog.labs.userAgent.platform"),goog.require("goog.labs.userAgent.util"),goog.require("goog.string"),goog.labs.userAgent.platform.isAndroid=function(){return goog.labs.userAgent.util.matchUserAgent("Android")},goog.labs.userAgent.platform.isIpod=function(){return goog.labs.userAgent.util.matchUserAgent("iPod")},goog.labs.userAgent.platform.isIphone=function(){return goog.labs.userAgent.util.matchUserAgent("iPhone")&&!goog.labs.userAgent.util.matchUserAgent("iPod")&&!goog.labs.userAgent.util.matchUserAgent("iPad")},goog.labs.userAgent.platform.isIpad=function(){return goog.labs.userAgent.util.matchUserAgent("iPad")},goog.labs.userAgent.platform.isIos=function(){return goog.labs.userAgent.platform.isIphone()||goog.labs.userAgent.platform.isIpad()||goog.labs.userAgent.platform.isIpod()},goog.labs.userAgent.platform.isMacintosh=function(){return goog.labs.userAgent.util.matchUserAgent("Macintosh")},goog.labs.userAgent.platform.isLinux=function(){return goog.labs.userAgent.util.matchUserAgent("Linux")},goog.labs.userAgent.platform.isWindows=function(){return goog.labs.userAgent.util.matchUserAgent("Windows")},goog.labs.userAgent.platform.isChromeOS=function(){return goog.labs.userAgent.util.matchUserAgent("CrOS")},goog.labs.userAgent.platform.getVersion=function(){var e,t=goog.labs.userAgent.util.getUserAgent(),o="";if(goog.labs.userAgent.platform.isWindows()){e=/Windows (?:NT|Phone) ([0-9.]+)/;var r=e.exec(t);o=r?r[1]:"0.0"}else if(goog.labs.userAgent.platform.isIos()){e=/(?:iPhone|iPod|iPad|CPU)\s+OS\s+(\S+)/;var r=e.exec(t);o=r&&r[1].replace(/_/g,".")}else if(goog.labs.userAgent.platform.isMacintosh()){e=/Mac OS X ([0-9_.]+)/;var r=e.exec(t);o=r?r[1].replace(/_/g,"."):"10"}else if(goog.labs.userAgent.platform.isAndroid()){e=/Android\s+([^\);]+)(\)|;)/;var r=e.exec(t);o=r&&r[1]}else if(goog.labs.userAgent.platform.isChromeOS()){e=/(?:CrOS\s+(?:i686|x86_64)\s+([0-9.]+))/;var r=e.exec(t);o=r&&r[1]}return o||""},goog.labs.userAgent.platform.isVersionOrHigher=function(e){return goog.string.compareVersions(goog.labs.userAgent.platform.getVersion(),e)>=0},goog.provide("goog.crypt.Hash"),goog.crypt.Hash=function(){this.blockSize=-1},goog.crypt.Hash.prototype.reset=goog.abstractMethod,goog.crypt.Hash.prototype.update=goog.abstractMethod,goog.crypt.Hash.prototype.digest=goog.abstractMethod,goog.provide("goog.crypt.Sha1"),goog.require("goog.crypt.Hash"),goog.crypt.Sha1=function(){goog.crypt.Sha1.base(this,"constructor"),this.blockSize=64,this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.pad_[0]=128;for(var e=1;e<this.blockSize;++e)this.pad_[e]=0;this.inbuf_=0,this.total_=0,this.reset()},goog.inherits(goog.crypt.Sha1,goog.crypt.Hash),goog.crypt.Sha1.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},goog.crypt.Sha1.prototype.compress_=function(e,t){t||(t=0);var o=this.W_;if(goog.isString(e))for(var r=0;r<16;r++)o[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(var r=0;r<16;r++)o[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(var r=16;r<80;r++){var n=o[r-3]^o[r-8]^o[r-14]^o[r-16];o[r]=4294967295&(n<<1|n>>>31)}for(var i,a,s=this.chain_[0],l=this.chain_[1],g=this.chain_[2],u=this.chain_[3],c=this.chain_[4],r=0;r<80;r++){r<40?r<20?(i=u^l&(g^u),a=1518500249):(i=l^g^u,a=1859775393):r<60?(i=l&g|u&(l|g),a=2400959708):(i=l^g^u,a=3395469782);var n=(s<<5|s>>>27)+i+c+a+o[r]&4294967295;c=u,u=g,g=4294967295&(l<<30|l>>>2),l=s,s=n}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+l&4294967295,this.chain_[2]=this.chain_[2]+g&4294967295,this.chain_[3]=this.chain_[3]+u&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295},goog.crypt.Sha1.prototype.update=function(e,t){if(null!=e){goog.isDef(t)||(t=e.length);for(var o=t-this.blockSize,r=0,n=this.buf_,i=this.inbuf_;r<t;){if(0==i)for(;r<=o;)this.compress_(e,r),r+=this.blockSize;if(goog.isString(e)){for(;r<t;)if(n[i]=e.charCodeAt(r),++i,++r,i==this.blockSize){this.compress_(n),i=0;break}}else for(;r<t;)if(n[i]=e[r],++i,++r,i==this.blockSize){this.compress_(n),i=0;break}}this.inbuf_=i,this.total_+=t}},goog.crypt.Sha1.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var o=this.blockSize-1;o>=56;o--)this.buf_[o]=255&t,t/=256;this.compress_(this.buf_);for(var r=0,o=0;o<5;o++)for(var n=24;n>=0;n-=8)e[r]=this.chain_[o]>>n&255,++r;return e},goog.provide("goog.testing.watchers"),goog.testing.watchers.resetWatchers_=[],goog.testing.watchers.signalClockReset=function(){for(var e=goog.testing.watchers.resetWatchers_,t=0;t<e.length;t++)goog.testing.watchers.resetWatchers_[t]()},goog.testing.watchers.watchClockReset=function(e){goog.testing.watchers.resetWatchers_.push(e)},goog.provide("goog.promise.Resolver"),goog.promise.Resolver=function(){},goog.promise.Resolver.prototype.promise,goog.promise.Resolver.prototype.resolve,goog.promise.Resolver.prototype.reject,goog.provide("goog.Thenable"),goog.Thenable=function(){},goog.Thenable.prototype.then=function(e,t,o){},goog.Thenable.IMPLEMENTED_BY_PROP="$goog_Thenable",goog.Thenable.addImplementation=function(e){goog.exportProperty(e.prototype,"then",e.prototype.then),COMPILED?e.prototype[goog.Thenable.IMPLEMENTED_BY_PROP]=!0:e.prototype.$goog_Thenable=!0},goog.Thenable.isImplementedBy=function(e){if(!e)return!1;try{return COMPILED?!!e[goog.Thenable.IMPLEMENTED_BY_PROP]:!!e.$goog_Thenable}catch(e){return!1}},goog.provide("goog.asserts"),goog.provide("goog.asserts.AssertionError"),goog.require("goog.debug.Error"),goog.require("goog.dom.NodeType"),goog.require("goog.string"),goog.define("goog.asserts.ENABLE_ASSERTS",goog.DEBUG),goog.asserts.AssertionError=function(e,t){t.unshift(e),goog.debug.Error.call(this,goog.string.subs.apply(null,t)),t.shift(),this.messagePattern=e},goog.inherits(goog.asserts.AssertionError,goog.debug.Error),goog.asserts.AssertionError.prototype.name="AssertionError",goog.asserts.DEFAULT_ERROR_HANDLER=function(e){throw e},goog.asserts.errorHandler_=goog.asserts.DEFAULT_ERROR_HANDLER,goog.asserts.doAssertFailure_=function(e,t,o,r){var n="Assertion failed";if(o){n+=": "+o;var i=r}else e&&(n+=": "+e,i=t);var a=new goog.asserts.AssertionError(""+n,i||[]);goog.asserts.errorHandler_(a)},goog.asserts.setErrorHandler=function(e){goog.asserts.ENABLE_ASSERTS&&(goog.asserts.errorHandler_=e)},goog.asserts.assert=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!e&&goog.asserts.doAssertFailure_("",null,t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.fail=function(e,t){goog.asserts.ENABLE_ASSERTS&&goog.asserts.errorHandler_(new goog.asserts.AssertionError("Failure"+(e?": "+e:""),Array.prototype.slice.call(arguments,1)))},goog.asserts.assertNumber=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!goog.isNumber(e)&&goog.asserts.doAssertFailure_("Expected number but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertString=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!goog.isString(e)&&goog.asserts.doAssertFailure_("Expected string but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertFunction=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!goog.isFunction(e)&&goog.asserts.doAssertFailure_("Expected function but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertObject=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!goog.isObject(e)&&goog.asserts.doAssertFailure_("Expected object but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertArray=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!goog.isArray(e)&&goog.asserts.doAssertFailure_("Expected array but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertBoolean=function(e,t,o){return goog.asserts.ENABLE_ASSERTS&&!goog.isBoolean(e)&&goog.asserts.doAssertFailure_("Expected boolean but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertElement=function(e,t,o){return!goog.asserts.ENABLE_ASSERTS||goog.isObject(e)&&e.nodeType==goog.dom.NodeType.ELEMENT||goog.asserts.doAssertFailure_("Expected Element but got %s: %s.",[goog.typeOf(e),e],t,Array.prototype.slice.call(arguments,2)),e},goog.asserts.assertInstanceof=function(e,t,o,r){return!goog.asserts.ENABLE_ASSERTS||e instanceof t||goog.asserts.doAssertFailure_("Expected instanceof %s but got %s.",[goog.asserts.getType_(t),goog.asserts.getType_(e)],o,Array.prototype.slice.call(arguments,3)),e},goog.asserts.assertObjectPrototypeIsIntact=function(){for(var e in Object.prototype)goog.asserts.fail(e+" should not be enumerable in Object.prototype.")},goog.asserts.getType_=function(e){return e instanceof Function?e.displayName||e.name||"unknown type name":e instanceof Object?e.constructor.displayName||e.constructor.name||Object.prototype.toString.call(e):null===e?"null":typeof e},goog.provide("goog.array"),goog.provide("goog.array.ArrayLike"),goog.require("goog.asserts"),goog.define("goog.NATIVE_ARRAY_PROTOTYPES",goog.TRUSTED_SITE),goog.define("goog.array.ASSUME_NATIVE_FUNCTIONS",!1),goog.array.ArrayLike,goog.array.peek=function(e){return e[e.length-1]},goog.array.last=goog.array.peek,goog.array.ARRAY_PROTOTYPE_=Array.prototype,goog.array.indexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.indexOf)?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.indexOf.call(e,t,o)}:function(e,t,o){var r=null==o?0:o<0?Math.max(0,e.length+o):o;if(goog.isString(e))return goog.isString(t)&&1==t.length?e.indexOf(t,r):-1;for(var n=r;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},goog.array.lastIndexOf=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.lastIndexOf)?function(e,t,o){goog.asserts.assert(null!=e.length);var r=null==o?e.length-1:o;return goog.array.ARRAY_PROTOTYPE_.lastIndexOf.call(e,t,r)}:function(e,t,o){var r=null==o?e.length-1:o;if(r<0&&(r=Math.max(0,e.length+r)),goog.isString(e))return goog.isString(t)&&1==t.length?e.lastIndexOf(t,r):-1;for(var n=r;n>=0;n--)if(n in e&&e[n]===t)return n;return-1},goog.array.forEach=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.forEach)?function(e,t,o){goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.forEach.call(e,t,o)}:function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=0;i<r;i++)i in n&&t.call(o,n[i],i,e)},goog.array.forEachRight=function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=r-1;i>=0;--i)i in n&&t.call(o,n[i],i,e)},goog.array.filter=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.filter)?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.filter.call(e,t,o)}:function(e,t,o){for(var r=e.length,n=[],i=0,a=goog.isString(e)?e.split(""):e,s=0;s<r;s++)if(s in a){var l=a[s];t.call(o,l,s,e)&&(n[i++]=l)}return n},goog.array.map=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.map)?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.map.call(e,t,o)}:function(e,t,o){for(var r=e.length,n=new Array(r),i=goog.isString(e)?e.split(""):e,a=0;a<r;a++)a in i&&(n[a]=t.call(o,i[a],a,e));return n},goog.array.reduce=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.reduce)?function(e,t,o,r){goog.asserts.assert(null!=e.length);for(var n=[],i=1,a=arguments.length;i<a;i++)n.push(arguments[i]);return r&&(n[0]=goog.bind(t,r)),goog.array.ARRAY_PROTOTYPE_.reduce.apply(e,n)}:function(e,t,o,r){var n=o;return goog.array.forEach(e,function(o,i){n=t.call(r,n,o,i,e)}),n},goog.array.reduceRight=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.reduceRight)?function(e,t,o,r){return goog.asserts.assert(null!=e.length),r&&(t=goog.bind(t,r)),goog.array.ARRAY_PROTOTYPE_.reduceRight.call(e,t,o)}:function(e,t,o,r){var n=o;return goog.array.forEachRight(e,function(o,i){n=t.call(r,n,o,i,e)}),n},goog.array.some=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.some)?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.some.call(e,t,o)}:function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=0;i<r;i++)if(i in n&&t.call(o,n[i],i,e))return!0;return!1},goog.array.every=goog.NATIVE_ARRAY_PROTOTYPES&&(goog.array.ASSUME_NATIVE_FUNCTIONS||goog.array.ARRAY_PROTOTYPE_.every)?function(e,t,o){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.every.call(e,t,o)}:function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=0;i<r;i++)if(i in n&&!t.call(o,n[i],i,e))return!1;return!0},goog.array.count=function(e,t,o){var r=0;return goog.array.forEach(e,function(e,n,i){t.call(o,e,n,i)&&++r},o),r},goog.array.find=function(e,t,o){var r=goog.array.findIndex(e,t,o);return r<0?null:goog.isString(e)?e.charAt(r):e[r]},goog.array.findIndex=function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=0;i<r;i++)if(i in n&&t.call(o,n[i],i,e))return i;return-1},goog.array.findRight=function(e,t,o){var r=goog.array.findIndexRight(e,t,o);return r<0?null:goog.isString(e)?e.charAt(r):e[r]},goog.array.findIndexRight=function(e,t,o){for(var r=e.length,n=goog.isString(e)?e.split(""):e,i=r-1;i>=0;i--)if(i in n&&t.call(o,n[i],i,e))return i;return-1},goog.array.contains=function(e,t){return goog.array.indexOf(e,t)>=0},goog.array.isEmpty=function(e){return 0==e.length},goog.array.clear=function(e){if(!goog.isArray(e))for(var t=e.length-1;t>=0;t--)delete e[t];e.length=0},goog.array.insert=function(e,t){goog.array.contains(e,t)||e.push(t)},goog.array.insertAt=function(e,t,o){goog.array.splice(e,o,0,t)},goog.array.insertArrayAt=function(e,t,o){goog.partial(goog.array.splice,e,o,0).apply(null,t)},goog.array.insertBefore=function(e,t,o){var r;2==arguments.length||(r=goog.array.indexOf(e,o))<0?e.push(t):goog.array.insertAt(e,t,r)},goog.array.remove=function(e,t){var o,r=goog.array.indexOf(e,t);return(o=r>=0)&&goog.array.removeAt(e,r),o},goog.array.removeAt=function(e,t){return goog.asserts.assert(null!=e.length),1==goog.array.ARRAY_PROTOTYPE_.splice.call(e,t,1).length},goog.array.removeIf=function(e,t,o){var r=goog.array.findIndex(e,t,o);return r>=0&&(goog.array.removeAt(e,r),!0)},goog.array.removeAllIf=function(e,t,o){var r=0;return goog.array.forEachRight(e,function(n,i){t.call(o,n,i,e)&&goog.array.removeAt(e,i)&&r++}),r},goog.array.concat=function(e){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)},goog.array.join=function(e){return goog.array.ARRAY_PROTOTYPE_.concat.apply(goog.array.ARRAY_PROTOTYPE_,arguments)},goog.array.toArray=function(e){var t=e.length;if(t>0){for(var o=new Array(t),r=0;r<t;r++)o[r]=e[r];return o}return[]},goog.array.clone=goog.array.toArray,goog.array.extend=function(e,t){for(var o=1;o<arguments.length;o++){var r=arguments[o];if(goog.isArrayLike(r)){var n=e.length||0,i=r.length||0;e.length=n+i;for(var a=0;a<i;a++)e[n+a]=r[a]}else e.push(r)}},goog.array.splice=function(e,t,o,r){return goog.asserts.assert(null!=e.length),goog.array.ARRAY_PROTOTYPE_.splice.apply(e,goog.array.slice(arguments,1))},goog.array.slice=function(e,t,o){return goog.asserts.assert(null!=e.length),arguments.length<=2?goog.array.ARRAY_PROTOTYPE_.slice.call(e,t):goog.array.ARRAY_PROTOTYPE_.slice.call(e,t,o)},goog.array.removeDuplicates=function(e,t,o){for(var r=t||e,n=function(e){return goog.isObject(g)?"o"+goog.getUid(g):(typeof g).charAt(0)+g},i=o||n,a={},s=0,l=0;l<e.length;){var g=e[l++],u=i(g);Object.prototype.hasOwnProperty.call(a,u)||(a[u]=!0,r[s++]=g)}r.length=s},goog.array.binarySearch=function(e,t,o){return goog.array.binarySearch_(e,o||goog.array.defaultCompare,!1,t)},goog.array.binarySelect=function(e,t,o){return goog.array.binarySearch_(e,t,!0,void 0,o)},goog.array.binarySearch_=function(e,t,o,r,n){for(var i,a=0,s=e.length;a<s;){var l,g=a+s>>1;l=o?t.call(n,e[g],g,e):t(r,e[g]),l>0?a=g+1:(s=g,i=!l)}return i?a:~a},goog.array.sort=function(e,t){e.sort(t||goog.array.defaultCompare)},goog.array.stableSort=function(e,t){function o(e,t){return n(e.value,t.value)||e.index-t.index}for(var r=0;r<e.length;r++)e[r]={index:r,value:e[r]};var n=t||goog.array.defaultCompare;goog.array.sort(e,o);for(var r=0;r<e.length;r++)e[r]=e[r].value},goog.array.sortByKey=function(e,t,o){var r=o||goog.array.defaultCompare;goog.array.sort(e,function(e,o){return r(t(e),t(o))})},goog.array.sortObjectsByKey=function(e,t,o){goog.array.sortByKey(e,function(e){return e[t]},o)},goog.array.isSorted=function(e,t,o){for(var r=t||goog.array.defaultCompare,n=1;n<e.length;n++){var i=r(e[n-1],e[n]);if(i>0||0==i&&o)return!1}return!0},goog.array.equals=function(e,t,o){if(!goog.isArrayLike(e)||!goog.isArrayLike(t)||e.length!=t.length)return!1;for(var r=e.length,n=o||goog.array.defaultCompareEquality,i=0;i<r;i++)if(!n(e[i],t[i]))return!1;return!0},goog.array.compare3=function(e,t,o){for(var r=o||goog.array.defaultCompare,n=Math.min(e.length,t.length),i=0;i<n;i++){var a=r(e[i],t[i]);if(0!=a)return a}return goog.array.defaultCompare(e.length,t.length)},goog.array.defaultCompare=function(e,t){return e>t?1:e<t?-1:0},goog.array.inverseDefaultCompare=function(e,t){return-goog.array.defaultCompare(e,t)},goog.array.defaultCompareEquality=function(e,t){return e===t},goog.array.binaryInsert=function(e,t,o){var r=goog.array.binarySearch(e,t,o);return r<0&&(goog.array.insertAt(e,t,-(r+1)),!0)},goog.array.binaryRemove=function(e,t,o){var r=goog.array.binarySearch(e,t,o);return r>=0&&goog.array.removeAt(e,r)},goog.array.bucket=function(e,t,o){for(var r={},n=0;n<e.length;n++){var i=e[n],a=t.call(o,i,n,e);if(goog.isDef(a)){var s=r[a]||(r[a]=[]);s.push(i)}}return r};goog.array.toObject=function(e,t,o){var r={};return goog.array.forEach(e,function(n,i){r[t.call(o,n,i,e)]=n}),r};goog.array.range=function(e,t,o){var r=[],n=0,i=e,a=o||1;if(void 0!==t&&(n=e,i=t),a*(i-n)<0)return[];if(a>0)for(var s=n;s<i;s+=a)r.push(s);else for(var s=n;s>i;s+=a)r.push(s);return r},goog.array.repeat=function(e,t){for(var o=[],r=0;r<t;r++)o[r]=e;return o},goog.array.flatten=function(e){for(var t=8192,o=[],r=0;r<arguments.length;r++){var n=arguments[r];if(goog.isArray(n))for(var i=0;i<n.length;i+=t)for(var a=goog.array.slice(n,i,i+t),s=goog.array.flatten.apply(null,a),l=0;l<s.length;l++)o.push(s[l]);else o.push(n)}return o},goog.array.rotate=function(e,t){return goog.asserts.assert(null!=e.length),e.length&&(t%=e.length,t>0?goog.array.ARRAY_PROTOTYPE_.unshift.apply(e,e.splice(-t,t)):t<0&&goog.array.ARRAY_PROTOTYPE_.push.apply(e,e.splice(0,-t))),e},goog.array.moveItem=function(e,t,o){goog.asserts.assert(t>=0&&t<e.length),goog.asserts.assert(o>=0&&o<e.length);var r=goog.array.ARRAY_PROTOTYPE_.splice.call(e,t,1);goog.array.ARRAY_PROTOTYPE_.splice.call(e,o,0,r[0])},goog.array.zip=function(e){if(!arguments.length)return[];for(var t=[],o=0;!0;o++){for(var r=[],n=0;n<arguments.length;n++){var i=arguments[n];if(o>=i.length)return t;r.push(i[o])}t.push(r)}},goog.array.shuffle=function(e,t){for(var o=t||Math.random,r=e.length-1;r>0;r--){var n=Math.floor(o()*(r+1)),i=e[r];e[r]=e[n],e[n]=i}},goog.array.copyByIndex=function(e,t){var o=[];return goog.array.forEach(t,function(t){o.push(e[t])}),o},goog.provide("goog.debug.EntryPointMonitor"),goog.provide("goog.debug.entryPointRegistry"),goog.require("goog.asserts"),goog.debug.EntryPointMonitor=function(){},goog.debug.EntryPointMonitor.prototype.wrap,goog.debug.EntryPointMonitor.prototype.unwrap,goog.debug.entryPointRegistry.refList_=[],goog.debug.entryPointRegistry.monitors_=[],goog.debug.entryPointRegistry.monitorsMayExist_=!1,goog.debug.entryPointRegistry.register=function(e){if(goog.debug.entryPointRegistry.refList_[goog.debug.entryPointRegistry.refList_.length]=e,goog.debug.entryPointRegistry.monitorsMayExist_)for(var t=goog.debug.entryPointRegistry.monitors_,o=0;o<t.length;o++)e(goog.bind(t[o].wrap,t[o]))},goog.debug.entryPointRegistry.monitorAll=function(e){goog.debug.entryPointRegistry.monitorsMayExist_=!0;for(var t=goog.bind(e.wrap,e),o=0;o<goog.debug.entryPointRegistry.refList_.length;o++)goog.debug.entryPointRegistry.refList_[o](t);goog.debug.entryPointRegistry.monitors_.push(e)},goog.debug.entryPointRegistry.unmonitorAllIfPossible=function(e){var t=goog.debug.entryPointRegistry.monitors_;goog.asserts.assert(e==t[t.length-1],"Only the most recent monitor can be unwrapped.");for(var o=goog.bind(e.unwrap,e),r=0;r<goog.debug.entryPointRegistry.refList_.length;r++)goog.debug.entryPointRegistry.refList_[r](o);t.length--},goog.provide("goog.labs.userAgent.browser"),goog.require("goog.array"),goog.require("goog.labs.userAgent.util"),goog.require("goog.object"),goog.require("goog.string"),goog.labs.userAgent.browser.matchOpera_=function(){return goog.labs.userAgent.util.matchUserAgent("Opera")||goog.labs.userAgent.util.matchUserAgent("OPR")},goog.labs.userAgent.browser.matchIE_=function(){return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")},goog.labs.userAgent.browser.matchFirefox_=function(){return goog.labs.userAgent.util.matchUserAgent("Firefox")},goog.labs.userAgent.browser.matchSafari_=function(){return goog.labs.userAgent.util.matchUserAgent("Safari")&&!(goog.labs.userAgent.browser.matchChrome_()||goog.labs.userAgent.browser.matchCoast_()||goog.labs.userAgent.browser.matchOpera_()||goog.labs.userAgent.browser.isSilk()||goog.labs.userAgent.util.matchUserAgent("Android"))},goog.labs.userAgent.browser.matchCoast_=function(){return goog.labs.userAgent.util.matchUserAgent("Coast")},goog.labs.userAgent.browser.matchIosWebview_=function(){return(goog.labs.userAgent.util.matchUserAgent("iPad")||goog.labs.userAgent.util.matchUserAgent("iPhone"))&&!goog.labs.userAgent.browser.matchSafari_()&&!goog.labs.userAgent.browser.matchChrome_()&&!goog.labs.userAgent.browser.matchCoast_()&&goog.labs.userAgent.util.matchUserAgent("AppleWebKit")},goog.labs.userAgent.browser.matchChrome_=function(){return(goog.labs.userAgent.util.matchUserAgent("Chrome")||goog.labs.userAgent.util.matchUserAgent("CriOS"))&&!goog.labs.userAgent.browser.matchOpera_()},goog.labs.userAgent.browser.matchAndroidBrowser_=function(){return goog.labs.userAgent.util.matchUserAgent("Android")&&!(goog.labs.userAgent.browser.isChrome()||goog.labs.userAgent.browser.isFirefox()||goog.labs.userAgent.browser.isOpera()||goog.labs.userAgent.browser.isSilk())},goog.labs.userAgent.browser.isOpera=goog.labs.userAgent.browser.matchOpera_,goog.labs.userAgent.browser.isIE=goog.labs.userAgent.browser.matchIE_,goog.labs.userAgent.browser.isFirefox=goog.labs.userAgent.browser.matchFirefox_,goog.labs.userAgent.browser.isSafari=goog.labs.userAgent.browser.matchSafari_,goog.labs.userAgent.browser.isCoast=goog.labs.userAgent.browser.matchCoast_,goog.labs.userAgent.browser.isIosWebview=goog.labs.userAgent.browser.matchIosWebview_,goog.labs.userAgent.browser.isChrome=goog.labs.userAgent.browser.matchChrome_,goog.labs.userAgent.browser.isAndroidBrowser=goog.labs.userAgent.browser.matchAndroidBrowser_,goog.labs.userAgent.browser.isSilk=function(){return goog.labs.userAgent.util.matchUserAgent("Silk")},goog.labs.userAgent.browser.getVersion=function(){function e(e){var t=goog.array.find(e,n);return r[t]||""}var t=goog.labs.userAgent.util.getUserAgent();if(goog.labs.userAgent.browser.isIE())return goog.labs.userAgent.browser.getIEVersion_(t);var o=goog.labs.userAgent.util.extractVersionTuples(t),r={};goog.array.forEach(o,function(e){var t=e[0],o=e[1];r[t]=o});var n=goog.partial(goog.object.containsKey,r);if(goog.labs.userAgent.browser.isOpera())return e(["Version","Opera","OPR"]);if(goog.labs.userAgent.browser.isChrome())return e(["Chrome","CriOS"]);var i=o[2];return i&&i[1]||""},goog.labs.userAgent.browser.isVersionOrHigher=function(e){return goog.string.compareVersions(goog.labs.userAgent.browser.getVersion(),e)>=0},goog.labs.userAgent.browser.getIEVersion_=function(e){var t=/rv: *([\d\.]*)/.exec(e);if(t&&t[1])return t[1];var o="",r=/MSIE +([\d\.]+)/.exec(e);if(r&&r[1]){var n=/Trident\/(\d.\d)/.exec(e);if("7.0"==r[1])if(n&&n[1])switch(n[1]){case"4.0":o="8.0";break;case"5.0":o="9.0";break;case"6.0":o="10.0";break;case"7.0":o="11.0"}else o="7.0";else o=r[1]}return o},goog.provide("goog.labs.userAgent.engine"),goog.require("goog.array"),goog.require("goog.labs.userAgent.util"),goog.require("goog.string"),goog.labs.userAgent.engine.isPresto=function(){return goog.labs.userAgent.util.matchUserAgent("Presto")},goog.labs.userAgent.engine.isTrident=function(){
return goog.labs.userAgent.util.matchUserAgent("Trident")||goog.labs.userAgent.util.matchUserAgent("MSIE")},goog.labs.userAgent.engine.isWebKit=function(){return goog.labs.userAgent.util.matchUserAgentIgnoreCase("WebKit")},goog.labs.userAgent.engine.isGecko=function(){return goog.labs.userAgent.util.matchUserAgent("Gecko")&&!goog.labs.userAgent.engine.isWebKit()&&!goog.labs.userAgent.engine.isTrident()},goog.labs.userAgent.engine.getVersion=function(){var e=goog.labs.userAgent.util.getUserAgent();if(e){var t=goog.labs.userAgent.util.extractVersionTuples(e),o=t[1];if(o)return"Gecko"==o[0]?goog.labs.userAgent.engine.getVersionForKey_(t,"Firefox"):o[1];var r,n=t[0];if(n&&(r=n[2])){var i=/Trident\/([^\s;]+)/.exec(r);if(i)return i[1]}}return""},goog.labs.userAgent.engine.isVersionOrHigher=function(e){return goog.string.compareVersions(goog.labs.userAgent.engine.getVersion(),e)>=0},goog.labs.userAgent.engine.getVersionForKey_=function(e,t){var o=goog.array.find(e,function(e){return t==e[0]});return o&&o[1]||""},goog.provide("goog.async.nextTick"),goog.provide("goog.async.throwException"),goog.require("goog.debug.entryPointRegistry"),goog.require("goog.functions"),goog.require("goog.labs.userAgent.browser"),goog.require("goog.labs.userAgent.engine"),goog.async.throwException=function(e){goog.global.setTimeout(function(){throw e},0)},goog.async.nextTick=function(e,t,o){var r=e;return t&&(r=goog.bind(e,t)),r=goog.async.nextTick.wrapCallback_(r),!goog.isFunction(goog.global.setImmediate)||!o&&goog.global.Window&&goog.global.Window.prototype&&goog.global.Window.prototype.setImmediate==goog.global.setImmediate?(goog.async.nextTick.setImmediate_||(goog.async.nextTick.setImmediate_=goog.async.nextTick.getSetImmediateEmulator_()),void goog.async.nextTick.setImmediate_(r)):void goog.global.setImmediate(r)},goog.async.nextTick.setImmediate_,goog.async.nextTick.getSetImmediateEmulator_=function(){var e=goog.global.MessageChannel;if("undefined"==typeof e&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!goog.labs.userAgent.engine.isPresto()&&(e=function(){var e=document.createElement("iframe");e.style.display="none",e.src="",document.documentElement.appendChild(e);var t=e.contentWindow,o=t.document;o.open(),o.write(""),o.close();var r="callImmediate"+Math.random(),n="file:"==t.location.protocol?"*":t.location.protocol+"//"+t.location.host,i=goog.bind(function(e){"*"!=n&&e.origin!=n||e.data!=r||this.port1.onmessage()},this);t.addEventListener("message",i,!1),this.port1={},this.port2={postMessage:function(){t.postMessage(r,n)}}}),"undefined"!=typeof e&&!goog.labs.userAgent.browser.isIE()){var t=new e,o={},r=o;return t.port1.onmessage=function(){if(goog.isDef(o.next)){o=o.next;var e=o.cb;o.cb=null,e()}},function(e){r.next={cb:e},r=r.next,t.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("script")?function(e){var t=document.createElement("script");t.onreadystatechange=function(){t.onreadystatechange=null,t.parentNode.removeChild(t),t=null,e(),e=null},document.documentElement.appendChild(t)}:function(e){goog.global.setTimeout(e,0)}},goog.async.nextTick.wrapCallback_=goog.functions.identity,goog.debug.entryPointRegistry.register(function(e){goog.async.nextTick.wrapCallback_=e}),goog.provide("goog.async.run"),goog.require("goog.async.nextTick"),goog.require("goog.async.throwException"),goog.require("goog.testing.watchers"),goog.async.run=function(e,t){goog.async.run.schedule_||goog.async.run.initializeRunner_(),goog.async.run.workQueueScheduled_||(goog.async.run.schedule_(),goog.async.run.workQueueScheduled_=!0),goog.async.run.workQueue_.push(new goog.async.run.WorkItem_(e,t))},goog.async.run.initializeRunner_=function(){if(goog.global.Promise&&goog.global.Promise.resolve){var e=goog.global.Promise.resolve();goog.async.run.schedule_=function(){e.then(goog.async.run.processWorkQueue)}}else goog.async.run.schedule_=function(){goog.async.nextTick(goog.async.run.processWorkQueue)}},goog.async.run.forceNextTick=function(){goog.async.run.schedule_=function(){goog.async.nextTick(goog.async.run.processWorkQueue)}},goog.async.run.schedule_,goog.async.run.workQueueScheduled_=!1,goog.async.run.workQueue_=[],goog.DEBUG&&(goog.async.run.resetQueue_=function(){goog.async.run.workQueueScheduled_=!1,goog.async.run.workQueue_=[]},goog.testing.watchers.watchClockReset(goog.async.run.resetQueue_)),goog.async.run.processWorkQueue=function(){for(;goog.async.run.workQueue_.length;){var e=goog.async.run.workQueue_;goog.async.run.workQueue_=[];for(var t=0;t<e.length;t++){var o=e[t];try{o.fn.call(o.scope)}catch(e){goog.async.throwException(e)}}}goog.async.run.workQueueScheduled_=!1},goog.async.run.WorkItem_=function(e,t){this.fn=e,this.scope=t},goog.provide("goog.crypt"),goog.require("goog.array"),goog.require("goog.asserts"),goog.crypt.stringToByteArray=function(e){for(var t=[],o=0,r=0;r<e.length;r++){for(var n=e.charCodeAt(r);n>255;)t[o++]=255&n,n>>=8;t[o++]=n}return t},goog.crypt.byteArrayToString=function(e){var t=8192;if(e.length<t)return String.fromCharCode.apply(null,e);for(var o="",r=0;r<e.length;r+=t){var n=goog.array.slice(e,r,r+t);o+=String.fromCharCode.apply(null,n)}return o},goog.crypt.byteArrayToHex=function(e){return goog.array.map(e,function(e){var t=e.toString(16);return t.length>1?t:"0"+t}).join("")},goog.crypt.hexToByteArray=function(e){goog.asserts.assert(e.length%2==0,"Key string length must be multiple of 2");for(var t=[],o=0;o<e.length;o+=2)t.push(parseInt(e.substring(o,o+2),16));return t},goog.crypt.stringToUtf8ByteArray=function(e){e=e.replace(/\r\n/g,"\n");for(var t=[],o=0,r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t[o++]=n:n<2048?(t[o++]=n>>6|192,t[o++]=63&n|128):(t[o++]=n>>12|224,t[o++]=n>>6&63|128,t[o++]=63&n|128)}return t},goog.crypt.utf8ByteArrayToString=function(e){for(var t=[],o=0,r=0;o<e.length;){var n=e[o++];if(n<128)t[r++]=String.fromCharCode(n);else if(n>191&&n<224){var i=e[o++];t[r++]=String.fromCharCode((31&n)<<6|63&i)}else{var i=e[o++],a=e[o++];t[r++]=String.fromCharCode((15&n)<<12|(63&i)<<6|63&a)}}return t.join("")},goog.crypt.xorByteArray=function(e,t){goog.asserts.assert(e.length==t.length,"XOR array lengths must match");for(var o=[],r=0;r<e.length;r++)o.push(e[r]^t[r]);return o},goog.provide("goog.userAgent"),goog.require("goog.labs.userAgent.browser"),goog.require("goog.labs.userAgent.engine"),goog.require("goog.labs.userAgent.platform"),goog.require("goog.labs.userAgent.util"),goog.require("goog.string"),goog.define("goog.userAgent.ASSUME_IE",!1),goog.define("goog.userAgent.ASSUME_GECKO",!1),goog.define("goog.userAgent.ASSUME_WEBKIT",!1),goog.define("goog.userAgent.ASSUME_MOBILE_WEBKIT",!1),goog.define("goog.userAgent.ASSUME_OPERA",!1),goog.define("goog.userAgent.ASSUME_ANY_VERSION",!1),goog.userAgent.BROWSER_KNOWN_=goog.userAgent.ASSUME_IE||goog.userAgent.ASSUME_GECKO||goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_OPERA,goog.userAgent.getUserAgentString=function(){return goog.labs.userAgent.util.getUserAgent()},goog.userAgent.getNavigator=function(){return goog.global.navigator||null},goog.userAgent.OPERA=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_OPERA:goog.labs.userAgent.browser.isOpera(),goog.userAgent.IE=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_IE:goog.labs.userAgent.browser.isIE(),goog.userAgent.GECKO=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_GECKO:goog.labs.userAgent.engine.isGecko(),goog.userAgent.WEBKIT=goog.userAgent.BROWSER_KNOWN_?goog.userAgent.ASSUME_WEBKIT||goog.userAgent.ASSUME_MOBILE_WEBKIT:goog.labs.userAgent.engine.isWebKit(),goog.userAgent.isMobile_=function(){return goog.userAgent.WEBKIT&&goog.labs.userAgent.util.matchUserAgent("Mobile")},goog.userAgent.MOBILE=goog.userAgent.ASSUME_MOBILE_WEBKIT||goog.userAgent.isMobile_(),goog.userAgent.SAFARI=goog.userAgent.WEBKIT,goog.userAgent.determinePlatform_=function(){var e=goog.userAgent.getNavigator();return e&&e.platform||""},goog.userAgent.PLATFORM=goog.userAgent.determinePlatform_(),goog.define("goog.userAgent.ASSUME_MAC",!1),goog.define("goog.userAgent.ASSUME_WINDOWS",!1),goog.define("goog.userAgent.ASSUME_LINUX",!1),goog.define("goog.userAgent.ASSUME_X11",!1),goog.define("goog.userAgent.ASSUME_ANDROID",!1),goog.define("goog.userAgent.ASSUME_IPHONE",!1),goog.define("goog.userAgent.ASSUME_IPAD",!1),goog.userAgent.PLATFORM_KNOWN_=goog.userAgent.ASSUME_MAC||goog.userAgent.ASSUME_WINDOWS||goog.userAgent.ASSUME_LINUX||goog.userAgent.ASSUME_X11||goog.userAgent.ASSUME_ANDROID||goog.userAgent.ASSUME_IPHONE||goog.userAgent.ASSUME_IPAD,goog.userAgent.MAC=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_MAC:goog.labs.userAgent.platform.isMacintosh(),goog.userAgent.WINDOWS=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_WINDOWS:goog.labs.userAgent.platform.isWindows(),goog.userAgent.isLegacyLinux_=function(){return goog.labs.userAgent.platform.isLinux()||goog.labs.userAgent.platform.isChromeOS()},goog.userAgent.LINUX=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_LINUX:goog.userAgent.isLegacyLinux_(),goog.userAgent.isX11_=function(){var e=goog.userAgent.getNavigator();return!!e&&goog.string.contains(e.appVersion||"","X11")},goog.userAgent.X11=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_X11:goog.userAgent.isX11_(),goog.userAgent.ANDROID=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_ANDROID:goog.labs.userAgent.platform.isAndroid(),goog.userAgent.IPHONE=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPHONE:goog.labs.userAgent.platform.isIphone(),goog.userAgent.IPAD=goog.userAgent.PLATFORM_KNOWN_?goog.userAgent.ASSUME_IPAD:goog.labs.userAgent.platform.isIpad(),goog.userAgent.determineVersion_=function(){var e,t="";if(goog.userAgent.OPERA&&goog.global.opera){var o=goog.global.opera.version;return goog.isFunction(o)?o():o}if(goog.userAgent.GECKO?e=/rv\:([^\);]+)(\)|;)/:goog.userAgent.IE?e=/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/:goog.userAgent.WEBKIT&&(e=/WebKit\/(\S+)/),e){var r=e.exec(goog.userAgent.getUserAgentString());t=r?r[1]:""}if(goog.userAgent.IE){var n=goog.userAgent.getDocumentMode_();if(n>parseFloat(t))return String(n)}return t},goog.userAgent.getDocumentMode_=function(){var e=goog.global.document;return e?e.documentMode:void 0},goog.userAgent.VERSION=goog.userAgent.determineVersion_(),goog.userAgent.compare=function(e,t){return goog.string.compareVersions(e,t)},goog.userAgent.isVersionOrHigherCache_={},goog.userAgent.isVersionOrHigher=function(e){return goog.userAgent.ASSUME_ANY_VERSION||goog.userAgent.isVersionOrHigherCache_[e]||(goog.userAgent.isVersionOrHigherCache_[e]=goog.string.compareVersions(goog.userAgent.VERSION,e)>=0)},goog.userAgent.isVersion=goog.userAgent.isVersionOrHigher,goog.userAgent.isDocumentModeOrHigher=function(e){return goog.userAgent.IE&&goog.userAgent.DOCUMENT_MODE>=e},goog.userAgent.isDocumentMode=goog.userAgent.isDocumentModeOrHigher,goog.userAgent.DOCUMENT_MODE=function(){var e=goog.global.document;if(e&&goog.userAgent.IE){var t=goog.userAgent.getDocumentMode_();return t||("CSS1Compat"==e.compatMode?parseInt(goog.userAgent.VERSION,10):5)}}(),goog.provide("goog.crypt.base64"),goog.require("goog.crypt"),goog.require("goog.userAgent"),goog.crypt.base64.byteToCharMap_=null,goog.crypt.base64.charToByteMap_=null,goog.crypt.base64.byteToCharMapWebSafe_=null,goog.crypt.base64.charToByteMapWebSafe_=null,goog.crypt.base64.ENCODED_VALS_BASE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",goog.crypt.base64.ENCODED_VALS=goog.crypt.base64.ENCODED_VALS_BASE+"+/=",goog.crypt.base64.ENCODED_VALS_WEBSAFE=goog.crypt.base64.ENCODED_VALS_BASE+"-_.",goog.crypt.base64.HAS_NATIVE_SUPPORT=goog.userAgent.GECKO||goog.userAgent.WEBKIT||goog.userAgent.OPERA||"function"==typeof goog.global.atob,goog.crypt.base64.encodeByteArray=function(e,t){if(!goog.isArrayLike(e))throw Error("encodeByteArray takes an array as a parameter");goog.crypt.base64.init_();for(var o=t?goog.crypt.base64.byteToCharMapWebSafe_:goog.crypt.base64.byteToCharMap_,r=[],n=0;n<e.length;n+=3){var i=e[n],a=n+1<e.length,s=a?e[n+1]:0,l=n+2<e.length,g=l?e[n+2]:0,u=i>>2,c=(3&i)<<4|s>>4,f=(15&s)<<2|g>>6,h=63&g;l||(h=64,a||(f=64)),r.push(o[u],o[c],o[f],o[h])}return r.join("")},goog.crypt.base64.encodeString=function(e,t){return goog.crypt.base64.HAS_NATIVE_SUPPORT&&!t?goog.global.btoa(e):goog.crypt.base64.encodeByteArray(goog.crypt.stringToByteArray(e),t)},goog.crypt.base64.decodeString=function(e,t){return goog.crypt.base64.HAS_NATIVE_SUPPORT&&!t?goog.global.atob(e):goog.crypt.byteArrayToString(goog.crypt.base64.decodeStringToByteArray(e,t))},goog.crypt.base64.decodeStringToByteArray=function(e,t){goog.crypt.base64.init_();for(var o=t?goog.crypt.base64.charToByteMapWebSafe_:goog.crypt.base64.charToByteMap_,r=[],n=0;n<e.length;){var i=o[e.charAt(n++)],a=n<e.length,s=a?o[e.charAt(n)]:0;++n;var l=n<e.length,g=l?o[e.charAt(n)]:64;++n;var u=n<e.length,c=u?o[e.charAt(n)]:64;if(++n,null==i||null==s||null==g||null==c)throw Error();var f=i<<2|s>>4;if(r.push(f),64!=g){var h=s<<4&240|g>>2;if(r.push(h),64!=c){var p=g<<6&192|c;r.push(p)}}}return r},goog.crypt.base64.init_=function(){if(!goog.crypt.base64.byteToCharMap_){goog.crypt.base64.byteToCharMap_={},goog.crypt.base64.charToByteMap_={},goog.crypt.base64.byteToCharMapWebSafe_={},goog.crypt.base64.charToByteMapWebSafe_={};for(var e=0;e<goog.crypt.base64.ENCODED_VALS.length;e++)goog.crypt.base64.byteToCharMap_[e]=goog.crypt.base64.ENCODED_VALS.charAt(e),goog.crypt.base64.charToByteMap_[goog.crypt.base64.byteToCharMap_[e]]=e,goog.crypt.base64.byteToCharMapWebSafe_[e]=goog.crypt.base64.ENCODED_VALS_WEBSAFE.charAt(e),goog.crypt.base64.charToByteMapWebSafe_[goog.crypt.base64.byteToCharMapWebSafe_[e]]=e,e>=goog.crypt.base64.ENCODED_VALS_BASE.length&&(goog.crypt.base64.charToByteMap_[goog.crypt.base64.ENCODED_VALS_WEBSAFE.charAt(e)]=e,goog.crypt.base64.charToByteMapWebSafe_[goog.crypt.base64.ENCODED_VALS.charAt(e)]=e)}},goog.provide("goog.Promise"),goog.require("goog.Thenable"),goog.require("goog.asserts"),goog.require("goog.async.run"),goog.require("goog.async.throwException"),goog.require("goog.debug.Error"),goog.require("goog.promise.Resolver"),goog.Promise=function(e,t){if(this.state_=goog.Promise.State_.PENDING,this.result_=void 0,this.parent_=null,this.callbackEntries_=null,this.executing_=!1,goog.Promise.UNHANDLED_REJECTION_DELAY>0?this.unhandledRejectionId_=0:0==goog.Promise.UNHANDLED_REJECTION_DELAY&&(this.hadUnhandledRejection_=!1),goog.Promise.LONG_STACK_TRACES&&(this.stack_=[],this.addStackTrace_(new Error("created")),this.currentStep_=0),e==goog.Promise.RESOLVE_FAST_PATH_)this.resolve_(goog.Promise.State_.FULFILLED,t);else try{var o=this;e.call(t,function(e){o.resolve_(goog.Promise.State_.FULFILLED,e)},function(e){if(goog.DEBUG&&!(e instanceof goog.Promise.CancellationError))try{throw e instanceof Error?e:new Error("Promise rejected.")}catch(e){}o.resolve_(goog.Promise.State_.REJECTED,e)})}catch(e){this.resolve_(goog.Promise.State_.REJECTED,e)}},goog.define("goog.Promise.LONG_STACK_TRACES",!1),goog.define("goog.Promise.UNHANDLED_REJECTION_DELAY",0),goog.Promise.State_={PENDING:0,BLOCKED:1,FULFILLED:2,REJECTED:3},goog.Promise.CallbackEntry_,goog.Promise.RESOLVE_FAST_PATH_=function(){},goog.Promise.resolve=function(e){return new goog.Promise(goog.Promise.RESOLVE_FAST_PATH_,e)},goog.Promise.reject=function(e){return new goog.Promise(function(t,o){o(e)})},goog.Promise.race=function(e){return new goog.Promise(function(t,o){e.length||t(void 0);for(var r,n=0;r=e[n];n++)r.then(t,o)})},goog.Promise.all=function(e){return new goog.Promise(function(t,o){var r=e.length,n=[];if(!r)return void t(n);for(var i,a=function(e,o){r--,n[e]=o,0==r&&t(n)},s=function(e){o(e)},l=0;i=e[l];l++)i.then(goog.partial(a,l),s)})},goog.Promise.firstFulfilled=function(e){return new goog.Promise(function(t,o){var r=e.length,n=[];if(!r)return void t(void 0);for(var i,a=function(e){t(e)},s=function(e,t){r--,n[e]=t,0==r&&o(n)},l=0;i=e[l];l++)i.then(a,goog.partial(s,l))})},goog.Promise.withResolver=function(){var e,t,o=new goog.Promise(function(o,r){e=o,t=r});return new goog.Promise.Resolver_(o,e,t)},goog.Promise.prototype.then=function(e,t,o){return null!=e&&goog.asserts.assertFunction(e,"opt_onFulfilled should be a function."),null!=t&&goog.asserts.assertFunction(t,"opt_onRejected should be a function. Did you pass opt_context as the second argument instead of the third?"),goog.Promise.LONG_STACK_TRACES&&this.addStackTrace_(new Error("then")),this.addChildPromise_(goog.isFunction(e)?e:null,goog.isFunction(t)?t:null,o)},goog.Thenable.addImplementation(goog.Promise),goog.Promise.prototype.thenAlways=function(e,t){goog.Promise.LONG_STACK_TRACES&&this.addStackTrace_(new Error("thenAlways"));var o=function(){try{e.call(t)}catch(e){goog.Promise.handleRejection_.call(null,e)}};return this.addCallbackEntry_({child:null,onRejected:o,onFulfilled:o}),this},goog.Promise.prototype.thenCatch=function(e,t){return goog.Promise.LONG_STACK_TRACES&&this.addStackTrace_(new Error("thenCatch")),this.addChildPromise_(null,e,t)},goog.Promise.prototype.cancel=function(e){this.state_==goog.Promise.State_.PENDING&&goog.async.run(function(){var t=new goog.Promise.CancellationError(e);this.cancelInternal_(t)},this)},goog.Promise.prototype.cancelInternal_=function(e){this.state_==goog.Promise.State_.PENDING&&(this.parent_?(this.parent_.cancelChild_(this,e),this.parent_=null):this.resolve_(goog.Promise.State_.REJECTED,e))},goog.Promise.prototype.cancelChild_=function(e,t){if(this.callbackEntries_){for(var o,r=0,n=-1,i=0;o=this.callbackEntries_[i];i++){var a=o.child;if(a&&(r++,a==e&&(n=i),n>=0&&r>1))break}if(n>=0)if(this.state_==goog.Promise.State_.PENDING&&1==r)this.cancelInternal_(t);else{var s=this.callbackEntries_.splice(n,1)[0];this.executeCallback_(s,goog.Promise.State_.REJECTED,t)}}},goog.Promise.prototype.addCallbackEntry_=function(e){this.callbackEntries_&&this.callbackEntries_.length||this.state_!=goog.Promise.State_.FULFILLED&&this.state_!=goog.Promise.State_.REJECTED||this.scheduleCallbacks_(),this.callbackEntries_||(this.callbackEntries_=[]),this.callbackEntries_.push(e)},goog.Promise.prototype.addChildPromise_=function(e,t,o){var r={child:null,onFulfilled:null,onRejected:null};return r.child=new goog.Promise(function(n,i){r.onFulfilled=e?function(t){try{var r=e.call(o,t);n(r)}catch(e){i(e)}}:n,r.onRejected=t?function(e){try{var r=t.call(o,e);!goog.isDef(r)&&e instanceof goog.Promise.CancellationError?i(e):n(r)}catch(e){i(e)}}:i}),r.child.parent_=this,this.addCallbackEntry_(r),r.child},goog.Promise.prototype.unblockAndFulfill_=function(e){goog.asserts.assert(this.state_==goog.Promise.State_.BLOCKED),this.state_=goog.Promise.State_.PENDING,this.resolve_(goog.Promise.State_.FULFILLED,e)},goog.Promise.prototype.unblockAndReject_=function(e){goog.asserts.assert(this.state_==goog.Promise.State_.BLOCKED),this.state_=goog.Promise.State_.PENDING,this.resolve_(goog.Promise.State_.REJECTED,e)},goog.Promise.prototype.resolve_=function(e,t){if(this.state_==goog.Promise.State_.PENDING){if(this==t)e=goog.Promise.State_.REJECTED,t=new TypeError("Promise cannot resolve to itself");else{if(goog.Thenable.isImplementedBy(t))return t=t,this.state_=goog.Promise.State_.BLOCKED,void t.then(this.unblockAndFulfill_,this.unblockAndReject_,this);if(goog.isObject(t))try{var o=t.then;if(goog.isFunction(o))return void this.tryThen_(t,o)}catch(o){e=goog.Promise.State_.REJECTED,t=o}}this.result_=t,this.state_=e,this.parent_=null,this.scheduleCallbacks_(),e!=goog.Promise.State_.REJECTED||t instanceof goog.Promise.CancellationError||goog.Promise.addUnhandledRejection_(this,t)}},goog.Promise.prototype.tryThen_=function(e,t){this.state_=goog.Promise.State_.BLOCKED;var o=this,r=!1,n=function(e){r||(r=!0,o.unblockAndFulfill_(e))},i=function(e){r||(r=!0,o.unblockAndReject_(e))};try{t.call(e,n,i)}catch(e){i(e)}},goog.Promise.prototype.scheduleCallbacks_=function(){this.executing_||(this.executing_=!0,goog.async.run(this.executeCallbacks_,this))},goog.Promise.prototype.executeCallbacks_=function(){for(;this.callbackEntries_&&this.callbackEntries_.length;){var e=this.callbackEntries_;this.callbackEntries_=null;for(var t=0;t<e.length;t++)goog.Promise.LONG_STACK_TRACES&&this.currentStep_++,this.executeCallback_(e[t],this.state_,this.result_)}this.executing_=!1},goog.Promise.prototype.executeCallback_=function(e,t,o){t==goog.Promise.State_.FULFILLED?e.onFulfilled(o):(e.child&&this.removeUnhandledRejection_(),e.onRejected(o))},goog.Promise.prototype.addStackTrace_=function(e){if(goog.Promise.LONG_STACK_TRACES&&goog.isString(e.stack)){var t=e.stack.split("\n",4)[3],o=e.message;o+=Array(11-o.length).join(" "),this.stack_.push(o+t)}},goog.Promise.prototype.appendLongStack_=function(e){if(goog.Promise.LONG_STACK_TRACES&&e&&goog.isString(e.stack)&&this.stack_.length){for(var t=["Promise trace:"],o=this;o;o=o.parent_){for(var r=this.currentStep_;r>=0;r--)t.push(o.stack_[r]);t.push("Value: ["+(o.state_==goog.Promise.State_.REJECTED?"REJECTED":"FULFILLED")+"] <"+String(o.result_)+">")}e.stack+="\n\n"+t.join("\n")}},goog.Promise.prototype.removeUnhandledRejection_=function(){if(goog.Promise.UNHANDLED_REJECTION_DELAY>0)for(var e=this;e&&e.unhandledRejectionId_;e=e.parent_)goog.global.clearTimeout(e.unhandledRejectionId_),e.unhandledRejectionId_=0;else if(0==goog.Promise.UNHANDLED_REJECTION_DELAY)for(var e=this;e&&e.hadUnhandledRejection_;e=e.parent_)e.hadUnhandledRejection_=!1},goog.Promise.addUnhandledRejection_=function(e,t){goog.Promise.UNHANDLED_REJECTION_DELAY>0?e.unhandledRejectionId_=goog.global.setTimeout(function(){e.appendLongStack_(t),goog.Promise.handleRejection_.call(null,t)},goog.Promise.UNHANDLED_REJECTION_DELAY):0==goog.Promise.UNHANDLED_REJECTION_DELAY&&(e.hadUnhandledRejection_=!0,goog.async.run(function(){e.hadUnhandledRejection_&&(e.appendLongStack_(t),goog.Promise.handleRejection_.call(null,t))}))},goog.Promise.handleRejection_=goog.async.throwException,goog.Promise.setUnhandledRejectionHandler=function(e){goog.Promise.handleRejection_=e},goog.Promise.CancellationError=function(e){goog.Promise.CancellationError.base(this,"constructor",e)};goog.inherits(goog.Promise.CancellationError,goog.debug.Error);goog.Promise.CancellationError.prototype.name="cancel",goog.Promise.Resolver_=function(e,t,o){this.promise=e,this.resolve=t,this.reject=o},goog.provide("fb.constants");var NODE_CLIENT=!1;fb.constants.NODE_CLIENT=NODE_CLIENT;var CLIENT_VERSION_DEFINE="0.0.0",CLIENT_VERSION=CLIENT_VERSION||CLIENT_VERSION_DEFINE;fb.constants.CLIENT_VERSION=CLIENT_VERSION,goog.provide("fb.util.obj"),fb.util.obj.contains=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},fb.util.obj.get=function(e,t){if(Object.prototype.hasOwnProperty.call(e,t))return e[t]},fb.util.obj.foreach=function(e,t){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t(o,e[o])},fb.util.obj.clone=function(e){var t={};return fb.util.obj.foreach(e,function(e,o){t[e]=o}),t},fb.util.obj.isNonNullObject=function(e){return"object"==typeof e&&null!==e},goog.provide("fb.util"),goog.require("fb.util.obj"),fb.util.querystring=function(e){var t=[];return fb.util.obj.foreach(e,function(e,o){goog.isArray(o)?goog.array.forEach(o,function(o){t.push(encodeURIComponent(e)+"="+encodeURIComponent(o))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(o))}),t.length?"&"+t.join("&"):""},fb.util.querystringDecode=function(e){var t={},o=e.replace(/^\?/,"").split("&");return goog.array.forEach(o,function(e){if(e){var o=e.split("=");t[o[0]]=o[1]}}),t},goog.provide("fb.util.assert"),goog.provide("fb.util.assertionError"),goog.require("fb.constants"),fb.util.assert=function(e,t){if(!e)throw fb.util.assertionError(t)},fb.util.assertionError=function(e){return new Error("Firebase ("+fb.constants.CLIENT_VERSION+") INTERNAL ASSERT FAILED: "+e)},goog.provide("fb.util.promise"),goog.provide("fb.util.promise.Deferred"),goog.provide("fb.util.promise.Promise"),goog.require("goog.Promise"),goog.scope(function(){fb.util.promise.Promise=goog.global.Promise||goog.Promise,goog.exportProperty(goog.Promise.prototype,"catch",goog.Promise.prototype.thenCatch),fb.util.promise.Deferred=goog.defineClass(null,{constructor:function(){var e=this;this.resolve=null,this.reject=null,this.promise=new fb.util.promise.Promise(function(t,o){e.resolve=t,e.reject=o})},wrapCallback:function(e){function t(t,r){t?o.reject(t):o.resolve(r),goog.isFunction(e)&&(fb.util.promise.attachDummyErrorHandler(o.promise),1===e.length?e(t):e(t,r))}var o=this;return t}}),fb.util.promise.attachDummyErrorHandler=function(e){e.then(void 0,goog.nullFunction)}}),goog.provide("fb.util.utf8"),goog.require("fb.util.assert"),fb.util.utf8.stringToByteArray=function(e){for(var t=[],o=0,r=0;r<e.length;r++){var n=e.charCodeAt(r);if(n>=55296&&n<=56319){var i=n-55296;r++,fb.util.assert(r<e.length,"Surrogate pair missing trail surrogate.");var a=e.charCodeAt(r)-56320;n=65536+(i<<10)+a}n<128?t[o++]=n:n<2048?(t[o++]=n>>6|192,t[o++]=63&n|128):n<65536?(t[o++]=n>>12|224,t[o++]=n>>6&63|128,t[o++]=63&n|128):(t[o++]=n>>18|240,t[o++]=n>>12&63|128,t[o++]=n>>6&63|128,t[o++]=63&n|128)}return t},fb.util.utf8.stringLength=function(e){for(var t=0,o=0;o<e.length;o++){var r=e.charCodeAt(o);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,o++):t+=3}return t},goog.provide("fb.util.validation"),fb.util.validation.validateArgCount=function(e,t,o,r){var n;if(r<t?n="at least "+t:r>o&&(n=0===o?"none":"no more than "+o),n){var i=e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+n+".";throw new Error(i)}},fb.util.validation.errorPrefix=function(e,t,o){var r="";switch(t){case 1:r=o?"first":"First";break;case 2:r=o?"second":"Second";break;case 3:r=o?"third":"Third";break;case 4:r=o?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var n=e+" failed: ";return n+=r+" argument "},fb.util.validation.validateNamespace=function(e,t,o,r){if((!r||goog.isDef(o))&&!goog.isString(o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"must be a valid firebase namespace.")},fb.util.validation.validateCallback=function(e,t,o,r){if((!r||goog.isDef(o))&&!goog.isFunction(o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"must be a valid function.")},fb.util.validation.validateContextObject=function(e,t,o,r){if((!r||goog.isDef(o))&&(!goog.isObject(o)||null===o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"must be a valid context object.")},goog.provide("fb.util.json"),goog.require("goog.json"),fb.util.json.eval=function(e){return"undefined"!=typeof JSON&&goog.isDef(JSON.parse)?JSON.parse(e):goog.json.parse(e)},fb.util.json.stringify=function(e){return"undefined"!=typeof JSON&&goog.isDef(JSON.stringify)?JSON.stringify(e):goog.json.serialize(e)},goog.provide("fb.core.SnapshotHolder"),fb.core.SnapshotHolder=function(){this.rootNode_=fb.core.snap.EMPTY_NODE},fb.core.SnapshotHolder.prototype.getNode=function(e){return this.rootNode_.getChild(e)},fb.core.SnapshotHolder.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},goog.DEBUG&&(fb.core.SnapshotHolder.prototype.toString=function(){return this.rootNode_.toString()}),goog.provide("fb.core.view.CompleteChildSource"),fb.core.view.CompleteChildSource=function(){},fb.core.view.CompleteChildSource.prototype.getCompleteChild=function(e){},fb.core.view.CompleteChildSource.prototype.getChildAfterChild=function(e,t,o){},fb.core.view.NoCompleteChildSource_=function(){},fb.core.view.NoCompleteChildSource_.prototype.getCompleteChild=function(){return null},fb.core.view.NoCompleteChildSource_.prototype.getChildAfterChild=function(){return null},fb.core.view.NO_COMPLETE_CHILD_SOURCE=new fb.core.view.NoCompleteChildSource_,fb.core.view.WriteTreeCompleteChildSource=function(e,t,o){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=o},fb.core.view.WriteTreeCompleteChildSource.prototype.getCompleteChild=function(e){var t=this.viewCache_.getEventCache();if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var o=null!=this.optCompleteServerCache_?new fb.core.view.CacheNode(this.optCompleteServerCache_,(!0),(!1)):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(e,o)},fb.core.view.WriteTreeCompleteChildSource.prototype.getChildAfterChild=function(e,t,o){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),n=this.writes_.calcIndexedSlice(r,t,1,o,e);return 0===n.length?null:n[0]},goog.provide("fb.core.view.EventQueue"),fb.core.view.EventQueue=function(){this.eventLists_=[],this.recursionDepth_=0},fb.core.view.EventQueue.prototype.queueEvents=function(e){for(var t=null,o=0;o<e.length;o++){var r=e[o],n=r.getPath();null===t||n.equals(t.getPath())||(this.eventLists_.push(t),t=null),null===t&&(t=new fb.core.view.EventList(n)),t.add(r)}t&&this.eventLists_.push(t)},fb.core.view.EventQueue.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.equals(e)})},fb.core.view.EventQueue.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_(function(t){return t.contains(e)||e.contains(t)})},fb.core.view.EventQueue.prototype.raiseQueuedEventsMatchingPredicate_=function(e){this.recursionDepth_++;for(var t=!0,o=0;o<this.eventLists_.length;o++){var r=this.eventLists_[o];if(r){var n=r.getPath();e(n)?(this.eventLists_[o].raise(),this.eventLists_[o]=null):t=!1}}t&&(this.eventLists_=[]),this.recursionDepth_--},fb.core.view.EventList=function(e){this.path_=e,this.events_=[]},fb.core.view.EventList.prototype.add=function(e){this.events_.push(e)},fb.core.view.EventList.prototype.raise=function(){for(var e=0;e<this.events_.length;e++){var t=this.events_[e];if(null!==t){this.events_[e]=null;var o=t.getEventRunner();fb.core.util.logger&&fb.core.util.log("event: "+t.toString()),fb.core.util.exceptionGuard(o)}}},fb.core.view.EventList.prototype.getPath=function(){return this.path_},goog.provide("fb.core.view.Change"),goog.provide("fb.core.view.Change.CHILD_ADDED"),goog.provide("fb.core.view.Change.CHILD_CHANGED"),goog.provide("fb.core.view.Change.CHILD_MOVED"),goog.provide("fb.core.view.Change.CHILD_REMOVED"),goog.provide("fb.core.view.Change.VALUE"),fb.core.view.Change=function(e,t,o,r,n){this.type=e,this.snapshotNode=t,this.childName=o,this.oldSnap=r,this.prevName=n},fb.core.view.Change.valueChange=function(e){return new fb.core.view.Change(fb.core.view.Change.VALUE,e)},fb.core.view.Change.childAddedChange=function(e,t){return new fb.core.view.Change(fb.core.view.Change.CHILD_ADDED,t,e)},fb.core.view.Change.childRemovedChange=function(e,t){return new fb.core.view.Change(fb.core.view.Change.CHILD_REMOVED,t,e)},fb.core.view.Change.childChangedChange=function(e,t,o){return new fb.core.view.Change(fb.core.view.Change.CHILD_CHANGED,t,e,o)},fb.core.view.Change.childMovedChange=function(e,t){return new fb.core.view.Change(fb.core.view.Change.CHILD_MOVED,t,e)},fb.core.view.Change.prototype.changeWithPrevName=function(e){return new fb.core.view.Change(this.type,this.snapshotNode,this.childName,this.oldSnap,e)},fb.core.view.Change.CHILD_ADDED="child_added",fb.core.view.Change.CHILD_REMOVED="child_removed",fb.core.view.Change.CHILD_CHANGED="child_changed",fb.core.view.Change.CHILD_MOVED="child_moved",fb.core.view.Change.VALUE="value",goog.provide("fb.core.view.CancelEvent"),goog.provide("fb.core.view.DataEvent"),goog.provide("fb.core.view.Event"),goog.require("fb.util.json"),fb.core.view.Event=function(){},fb.core.view.Event.prototype.getPath=goog.abstractMethod,fb.core.view.Event.prototype.getEventType=goog.abstractMethod,fb.core.view.Event.prototype.getEventRunner=goog.abstractMethod,fb.core.view.Event.prototype.toString=goog.abstractMethod,fb.core.view.DataEvent=function(e,t,o,r){this.eventRegistration=t,this.snapshot=o,this.prevName=r,this.eventType=e},fb.core.view.DataEvent.prototype.getPath=function(){var e=this.snapshot.ref();
return"value"===this.eventType?e.path:e.parent().path},fb.core.view.DataEvent.prototype.getEventType=function(){return this.eventType},fb.core.view.DataEvent.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},fb.core.view.DataEvent.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+fb.util.json.stringify(this.snapshot.exportVal())},fb.core.view.CancelEvent=function(e,t,o){this.eventRegistration=e,this.error=t,this.path=o},fb.core.view.CancelEvent.prototype.getPath=function(){return this.path},fb.core.view.CancelEvent.prototype.getEventType=function(){return"cancel"},fb.core.view.CancelEvent.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},fb.core.view.CancelEvent.prototype.toString=function(){return this.path.toString()+":cancel"},goog.provide("fb.core.view.CacheNode"),fb.core.view.CacheNode=function(e,t,o){this.node_=e,this.fullyInitialized_=t,this.filtered_=o},fb.core.view.CacheNode.prototype.isFullyInitialized=function(){return this.fullyInitialized_},fb.core.view.CacheNode.prototype.isFiltered=function(){return this.filtered_},fb.core.view.CacheNode.prototype.isCompleteForPath=function(e){if(e.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var t=e.getFront();return this.isCompleteForChild(t)},fb.core.view.CacheNode.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},fb.core.view.CacheNode.prototype.getNode=function(){return this.node_},goog.provide("fb.core.stats.StatsListener"),fb.core.stats.StatsListener=function(e){this.collection_=e,this.last_=null},fb.core.stats.StatsListener.prototype.get=function(){var e=this.collection_.get(),t=goog.object.clone(e);if(this.last_)for(var o in this.last_)t[o]=t[o]-this.last_[o];return this.last_=e,t},goog.provide("fb.core.stats.StatsReporter");var FIRST_STATS_MIN_TIME=1e4,FIRST_STATS_MAX_TIME=3e4,REPORT_STATS_INTERVAL=3e5;fb.core.stats.StatsReporter=function(e,t){this.statsToReport_={},this.statsListener_=new fb.core.stats.StatsListener(e),this.server_=t;var o=FIRST_STATS_MIN_TIME+(FIRST_STATS_MAX_TIME-FIRST_STATS_MIN_TIME)*Math.random();setTimeout(goog.bind(this.reportStats_,this),Math.floor(o))},fb.core.stats.StatsReporter.prototype.includeStat=function(e){this.statsToReport_[e]=!0},fb.core.stats.StatsReporter.prototype.reportStats_=function(){var e=this.statsListener_.get(),t={},o=!1;for(var r in e)e[r]>0&&fb.util.obj.contains(this.statsToReport_,r)&&(t[r]=e[r],o=!0);o&&this.server_.reportStats(t),setTimeout(goog.bind(this.reportStats_,this),Math.floor(2*Math.random()*REPORT_STATS_INTERVAL))},goog.provide("fb.core.stats.StatsCollection"),goog.require("fb.util.obj"),goog.require("goog.array"),goog.require("goog.object"),fb.core.stats.StatsCollection=function(){this.counters_={}},fb.core.stats.StatsCollection.prototype.incrementCounter=function(e,t){goog.isDef(t)||(t=1),fb.util.obj.contains(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},fb.core.stats.StatsCollection.prototype.get=function(){return goog.object.clone(this.counters_)},goog.provide("fb.core.stats.StatsManager"),goog.require("fb.core.stats.StatsCollection"),goog.require("fb.core.stats.StatsListener"),goog.require("fb.core.stats.StatsReporter"),fb.core.stats.StatsManager={},fb.core.stats.StatsManager.collections_={},fb.core.stats.StatsManager.reporters_={},fb.core.stats.StatsManager.getCollection=function(e){var t=e.toString();return fb.core.stats.StatsManager.collections_[t]||(fb.core.stats.StatsManager.collections_[t]=new fb.core.stats.StatsCollection),fb.core.stats.StatsManager.collections_[t]},fb.core.stats.StatsManager.getOrCreateReporter=function(e,t){var o=e.toString();return fb.core.stats.StatsManager.reporters_[o]||(fb.core.stats.StatsManager.reporters_[o]=t()),fb.core.stats.StatsManager.reporters_[o]},goog.provide("fb.core.ServerActions"),fb.core.ServerActions=goog.defineClass(null,{listen:goog.abstractMethod,unlisten:goog.abstractMethod,put:goog.abstractMethod,merge:goog.abstractMethod,auth:goog.abstractMethod,unauth:goog.abstractMethod,onDisconnectPut:goog.abstractMethod,onDisconnectMerge:goog.abstractMethod,onDisconnectCancel:goog.abstractMethod,reportStats:goog.abstractMethod}),goog.provide("fb.core.snap.Node"),goog.provide("fb.core.snap.NamedNode"),fb.core.snap.Node=function(){},fb.core.snap.Node.prototype.isLeafNode,fb.core.snap.Node.prototype.getPriority,fb.core.snap.Node.prototype.updatePriority,fb.core.snap.Node.prototype.getImmediateChild,fb.core.snap.Node.prototype.getChild,fb.core.snap.Node.prototype.getPredecessorChildName,fb.core.snap.Node.prototype.updateImmediateChild,fb.core.snap.Node.prototype.updateChild,fb.core.snap.Node.prototype.hasChild,fb.core.snap.Node.prototype.isEmpty,fb.core.snap.Node.prototype.numChildren,fb.core.snap.Node.prototype.forEachChild,fb.core.snap.Node.prototype.val,fb.core.snap.Node.prototype.hash,fb.core.snap.Node.prototype.compareTo,fb.core.snap.Node.prototype.equals,fb.core.snap.Node.prototype.withIndex,fb.core.snap.Node.prototype.isIndexed,fb.core.snap.NamedNode=function(e,t){this.name=e,this.node=t},fb.core.snap.NamedNode.Wrap=function(e,t){return new fb.core.snap.NamedNode(e,t)},goog.provide("fb.core.snap.comparators"),fb.core.snap.NAME_ONLY_COMPARATOR=function(e,t){return fb.core.util.nameCompare(e.name,t.name)},fb.core.snap.NAME_COMPARATOR=function(e,t){return fb.core.util.nameCompare(e,t)},goog.provide("fb.core.operation.Overwrite"),fb.core.operation.Overwrite=function(e,t,o){this.type=fb.core.OperationType.OVERWRITE,this.source=e,this.path=t,this.snap=o},fb.core.operation.Overwrite.prototype.operationForChild=function(e){return this.path.isEmpty()?new fb.core.operation.Overwrite(this.source,fb.core.util.Path.Empty,this.snap.getImmediateChild(e)):new fb.core.operation.Overwrite(this.source,this.path.popFront(),this.snap)},goog.DEBUG&&(fb.core.operation.Overwrite.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" overwrite: "+this.snap.toString()+")"}),goog.provide("fb.core.operation.ListenComplete"),fb.core.operation.ListenComplete=function(e,t){this.type=fb.core.OperationType.LISTEN_COMPLETE,this.source=e,this.path=t},fb.core.operation.ListenComplete.prototype.operationForChild=function(e){return this.path.isEmpty()?new fb.core.operation.ListenComplete(this.source,fb.core.util.Path.Empty):new fb.core.operation.ListenComplete(this.source,this.path.popFront())},goog.DEBUG&&(fb.core.operation.ListenComplete.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" listen_complete)"}),goog.provide("fb.core.util.SortedMap"),goog.require("goog.array"),fb.Comparator,fb.core.util.SortedMap=goog.defineClass(null,{constructor:function(e,t){this.comparator_=e,this.root_=t?t:fb.core.util.SortedMap.EMPTY_NODE_},insert:function(e,t){return new fb.core.util.SortedMap(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,fb.LLRBNode.BLACK,null,null))},remove:function(e){return new fb.core.util.SortedMap(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,fb.LLRBNode.BLACK,null,null))},get:function(e){for(var t,o=this.root_;!o.isEmpty();){if(t=this.comparator_(e,o.key),0===t)return o.value;t<0?o=o.left:t>0&&(o=o.right)}return null},getPredecessorKey:function(e){for(var t,o=this.root_,r=null;!o.isEmpty();){if(t=this.comparator_(e,o.key),0===t){if(o.left.isEmpty())return r?r.key:null;for(o=o.left;!o.right.isEmpty();)o=o.right;return o.key}t<0?o=o.left:t>0&&(r=o,o=o.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},isEmpty:function(){return this.root_.isEmpty()},count:function(){return this.root_.count()},minKey:function(){return this.root_.minKey()},maxKey:function(){return this.root_.maxKey()},inorderTraversal:function(e){return this.root_.inorderTraversal(e)},reverseTraversal:function(e){return this.root_.reverseTraversal(e)},getIterator:function(e){return new fb.core.util.SortedMapIterator(this.root_,null,this.comparator_,(!1),e)},getIteratorFrom:function(e,t){return new fb.core.util.SortedMapIterator(this.root_,e,this.comparator_,(!1),t)},getReverseIteratorFrom:function(e,t){return new fb.core.util.SortedMapIterator(this.root_,e,this.comparator_,(!0),t)},getReverseIterator:function(e){return new fb.core.util.SortedMapIterator(this.root_,null,this.comparator_,(!0),e)}}),fb.core.util.SortedMapIterator=goog.defineClass(null,{constructor:function(e,t,o,r,n){this.resultGenerator_=n||null,this.isReverse_=r,this.nodeStack_=[];for(var i=1;!e.isEmpty();)if(i=t?o(e.key,t):1,r&&(i*=-1),i<0)e=this.isReverse_?e.left:e.right;else{if(0===i){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}},getNext:function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e},hasNext:function(){return this.nodeStack_.length>0},peek:function(){if(0===this.nodeStack_.length)return null;var e=goog.array.peek(this.nodeStack_);return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}),fb.LLRBNode=goog.defineClass(null,{constructor:function(e,t,o,r,n){this.key=e,this.value=t,this.color=null!=o?o:fb.LLRBNode.RED,this.left=null!=r?r:fb.core.util.SortedMap.EMPTY_NODE_,this.right=null!=n?n:fb.core.util.SortedMap.EMPTY_NODE_},statics:{RED:!0,BLACK:!1},copy:function(e,t,o,r,n){return new fb.LLRBNode(null!=e?e:this.key,null!=t?t:this.value,null!=o?o:this.color,null!=r?r:this.left,null!=n?n:this.right)},count:function(){return this.left.count()+1+this.right.count()},isEmpty:function(){return!1},inorderTraversal:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)},reverseTraversal:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},min_:function(){return this.left.isEmpty()?this:this.left.min_()},minKey:function(){return this.min_().key},maxKey:function(){return this.right.isEmpty()?this.key:this.right.maxKey()},insert:function(e,t,o){var r,n;return n=this,r=o(e,n.key),n=r<0?n.copy(null,null,null,n.left.insert(e,t,o),null):0===r?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,o)),n.fixUp_()},removeMin_:function(){var e;return this.left.isEmpty()?fb.core.util.SortedMap.EMPTY_NODE_:(e=this,e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_())},remove:function(e,t){var o,r;if(o=this,t(e,o.key)<0)o.left.isEmpty()||o.left.isRed_()||o.left.left.isRed_()||(o=o.moveRedLeft_()),o=o.copy(null,null,null,o.left.remove(e,t),null);else{if(o.left.isRed_()&&(o=o.rotateRight_()),o.right.isEmpty()||o.right.isRed_()||o.right.left.isRed_()||(o=o.moveRedRight_()),0===t(e,o.key)){if(o.right.isEmpty())return fb.core.util.SortedMap.EMPTY_NODE_;r=o.right.min_(),o=o.copy(r.key,r.value,null,null,o.right.removeMin_())}o=o.copy(null,null,null,null,o.right.remove(e,t))}return o.fixUp_()},isRed_:function(){return this.color},fixUp_:function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},moveRedLeft_:function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e},moveRedRight_:function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e},rotateLeft_:function(){var e;return e=this.copy(null,null,fb.LLRBNode.RED,null,this.right.left),this.right.copy(null,null,this.color,e,null)},rotateRight_:function(){var e;return e=this.copy(null,null,fb.LLRBNode.RED,this.left.right,null),this.left.copy(null,null,this.color,null,e)},colorFlip_:function(){var e,t;return e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null),this.copy(null,null,!this.color,e,t)},checkMaxDepth_:function(){var e;return e=this.check_(),Math.pow(2,e)<=this.count()+1},check_:function(){var e;if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");if(e=this.left.check_(),e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}),fb.LLRBEmptyNode=goog.defineClass(null,{constructor:function(){},copy:function(){return this},insert:function(e,t,o){return new fb.LLRBNode(e,t,null)},remove:function(e,t){return this},count:function(){return 0},isEmpty:function(){return!0},inorderTraversal:function(e){return!1},reverseTraversal:function(e){return!1},minKey:function(){return null},maxKey:function(){return null},check_:function(){return 0},isRed_:function(){return!1}}),fb.core.util.SortedMap.EMPTY_NODE_=new fb.LLRBEmptyNode,goog.provide("fb.core.util.NodePatches"),function(){function e(e,t,o){var r=new Error("write after end");e.emit("error",r),process.nextTick(function(){o(r)})}function t(e,t,o,r){var n=!0;if(!Buffer.isBuffer(o)&&"string"!=typeof o&&null!==o&&void 0!==o&&!t.objectMode){var i=new TypeError("Invalid non-string/buffer chunk");e.emit("error",i),process.nextTick(function(){r(i)}),n=!1}return n}function o(e,t,o,a,s){o=r(t,o,a),Buffer.isBuffer(o)&&(a="buffer");var l=t.objectMode?1:o.length;t.length+=l;var g=t.length<t.highWaterMark;return g||(t.needDrain=!0),t.writing?t.buffer.push(new n(o,a,s)):i(e,t,l,o,a,s),g}function r(e,t,o){return e.objectMode||e.decodeStrings===!1||"string"!=typeof t||(t=new Buffer(t,o)),t}function n(e,t,o){this.chunk=e,this.encoding=t,this.callback=o}function i(e,t,o,r,n,i){t.writelen=o,t.writecb=i,t.writing=!0,t.sync=!0,e._write(r,n,t.onwrite),t.sync=!1}if(NODE_CLIENT){var a=process.version;if("v0.10.22"===a||"v0.10.23"===a||"v0.10.24"===a){var s=require("_stream_writable");s.prototype.write=function(r,n,i){var a=this._writableState,s=!1;return"function"==typeof n&&(i=n,n=null),Buffer.isBuffer(r)?n="buffer":n||(n=a.defaultEncoding),"function"!=typeof i&&(i=function(){}),a.ended?e(this,a,i):t(this,a,r,i)&&(s=o(this,a,r,n,i)),s};var l=require("_stream_duplex");l.prototype.write=s.prototype.write}}}(),goog.provide("fb.core.util.ServerValues"),fb.core.util.ServerValues.generateWithValues=function(e){return e=e||{},e.timestamp=e.timestamp||(new Date).getTime(),e},fb.core.util.ServerValues.resolveDeferredValue=function(e,t){return e&&"object"==typeof e?(fb.core.util.assert(".sv"in e,"Unexpected leaf node or priority contents"),t[e[".sv"]]):e},fb.core.util.ServerValues.resolveDeferredValueTree=function(e,t){var o=new fb.core.SparseSnapshotTree;return e.forEachTree(new fb.core.util.Path(""),function(e,r){o.remember(e,fb.core.util.ServerValues.resolveDeferredValueSnapshot(r,t))}),o},fb.core.util.ServerValues.resolveDeferredValueSnapshot=function(e,t){var o,r=e.getPriority().val(),n=fb.core.util.ServerValues.resolveDeferredValue(r,t);if(e.isLeafNode()){var i=e,a=fb.core.util.ServerValues.resolveDeferredValue(i.getValue(),t);return a!==i.getValue()||n!==i.getPriority().val()?new fb.core.snap.LeafNode(a,fb.core.snap.NodeFromJSON(n)):e}var s=e;return o=s,n!==s.getPriority().val()&&(o=o.updatePriority(new fb.core.snap.LeafNode(n))),s.forEachChild(fb.core.snap.PriorityIndex,function(e,r){var n=fb.core.util.ServerValues.resolveDeferredValueSnapshot(r,t);n!==r&&(o=o.updateImmediateChild(e,n))}),o},goog.provide("fb.core.storage.MemoryStorage"),goog.require("fb.util.obj"),goog.scope(function(){var e=fb.util.obj;fb.core.storage.MemoryStorage=function(){this.cache_={}};var t=fb.core.storage.MemoryStorage;t.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},t.prototype.get=function(t){return e.contains(this.cache_,t)?this.cache_[t]:null},t.prototype.remove=function(e){delete this.cache_[e]},t.prototype.isInMemoryStorage=!0}),goog.provide("fb.core.storage.DOMStorageWrapper"),goog.require("fb.util.obj"),goog.scope(function(){fb.core.storage.DOMStorageWrapper=function(e){this.domStorage_=e,this.prefix_="firebase:"};var e=fb.core.storage.DOMStorageWrapper;e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),fb.util.json.stringify(t))},e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:fb.util.json.eval(t)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.isInMemoryStorage=!1,e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()}}),goog.provide("fb.core.storage"),goog.provide("fb.core.storage.PersistentStorage"),goog.provide("fb.core.storage.SessionStorage"),goog.require("fb.core.storage.DOMStorageWrapper"),goog.require("fb.core.storage.MemoryStorage"),fb.core.storage.createStoragefor=function(e){try{if("undefined"!=typeof window&&"undefined"!=typeof window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new fb.core.storage.DOMStorageWrapper(t)}}catch(e){}return new fb.core.storage.MemoryStorage},fb.core.storage.PersistentStorage=fb.core.storage.createStoragefor("localStorage"),fb.core.storage.SessionStorage=fb.core.storage.createStoragefor("sessionStorage"),goog.provide("fb.core.RepoInfo"),goog.require("fb.core.storage"),fb.core.RepoInfo=function(e,t,o,r,n){this.host=e.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.secure=t,this.namespace=o,this.webSocketOnly=r,this.persistenceKey=n||"",this.internalHost=fb.core.storage.PersistentStorage.get("host:"+e)||this.host},fb.core.RepoInfo.prototype.needsQueryParam=function(){return this.host!==this.internalHost},fb.core.RepoInfo.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},fb.core.RepoInfo.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},fb.core.RepoInfo.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},fb.core.RepoInfo.prototype.updateHost=function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&fb.core.storage.PersistentStorage.set("host:"+this.host,this.internalHost))},fb.core.RepoInfo.prototype.connectionURL=function(e,t){fb.core.util.assert("string"==typeof e,"typeof type must == string"),fb.core.util.assert("object"==typeof t,"typeof params must == object");var o;if(e===fb.realtime.Constants.WEBSOCKET)o=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(e!==fb.realtime.Constants.LONG_POLLING)throw new Error("Unknown connection type: "+e);o=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(t.ns=this.namespace);var r=[];return goog.object.forEach(t,function(e,t,o){r.push(t+"="+e)}),o+r.join("&")},fb.core.RepoInfo.prototype.toString=function(){var e=(this.secure?"https://":"http://")+this.host;return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},goog.provide("fb.core.util"),goog.provide("fb.core.util.LUIDGenerator"),goog.provide("fb.core.util.ObjectToUniqueKey"),goog.provide("fb.core.util.enableLogging"),goog.require("fb.constants"),goog.require("fb.core.RepoInfo"),goog.require("fb.core.storage.SessionStorage"),goog.require("fb.util.assert"),goog.require("fb.util.assertionError"),goog.require("fb.util.json"),goog.require("fb.util.utf8"),goog.require("goog.crypt.Sha1"),goog.require("goog.crypt.base64"),goog.require("goog.object"),goog.require("goog.string"),goog.forwardDeclare("fb.core.util.Path"),fb.core.util.LUIDGenerator=function(){var e=1;return function(){return e++}}(),fb.core.util.assert=fb.util.assert,fb.core.util.assertionError=fb.util.assertionError,fb.core.util.assertWeak=function(e,t){e||fb.core.util.error(t)},fb.core.util.base64Encode=function(e){var t=fb.util.utf8.stringToByteArray(e);return goog.crypt.base64.encodeByteArray(t,!0)},fb.core.util.base64Decode=function(e){try{return fb.constants.NODE_CLIENT?new Buffer(e,"base64").toString("utf8"):"undefined"!=typeof atob?atob(e):goog.crypt.base64.decodeString(e,!0)}catch(e){fb.core.util.log("base64Decode failed: ",e)}return null},fb.core.util.sha1=function(e){var t=fb.util.utf8.stringToByteArray(e),o=new goog.crypt.Sha1;o.update(t);var r=o.digest();return goog.crypt.base64.encodeByteArray(r)},fb.core.util.buildLogMessage_=function(e){for(var t="",o=0;o<arguments.length;o++)t+=goog.isArrayLike(arguments[o])?fb.core.util.buildLogMessage_.apply(null,arguments[o]):"object"==typeof arguments[o]?fb.util.json.stringify(arguments[o]):arguments[o],t+=" ";return t},fb.core.util.logger=null,fb.core.util.firstLog_=!0,fb.core.util.enableLogging=function(e,t){fb.util.assert(!t||e===!0||e===!1,"Can't turn on custom loggers persistently."),e===!0?("undefined"!=typeof console&&("function"==typeof console.log?fb.core.util.logger=goog.bind(console.log,console):"object"==typeof console.log&&(fb.core.util.logger=function(e){console.log(e)})),t&&fb.core.storage.SessionStorage.set("logging_enabled",!0)):goog.isFunction(e)?fb.core.util.logger=e:(fb.core.util.logger=null,fb.core.storage.SessionStorage.remove("logging_enabled"))},fb.core.util.log=function(e){if(fb.core.util.firstLog_===!0&&(fb.core.util.firstLog_=!1,null===fb.core.util.logger&&fb.core.storage.SessionStorage.get("logging_enabled")===!0&&fb.core.util.enableLogging(!0)),fb.core.util.logger){var t=fb.core.util.buildLogMessage_.apply(null,arguments);fb.core.util.logger(t)}},fb.core.util.logWrapper=function(e){return function(){fb.core.util.log(e,arguments)}},fb.core.util.error=function(e){if("undefined"!=typeof console){var t="FIREBASE INTERNAL ERROR: "+fb.core.util.buildLogMessage_.apply(null,arguments);"undefined"!=typeof console.error?console.error(t):console.log(t)}},fb.core.util.fatal=function(e){var t=fb.core.util.buildLogMessage_.apply(null,arguments);throw new Error("FIREBASE FATAL ERROR: "+t)},fb.core.util.warn=function(e){if("undefined"!=typeof console){var t="FIREBASE WARNING: "+fb.core.util.buildLogMessage_.apply(null,arguments);"undefined"!=typeof console.warn?console.warn(t):console.log(t)}},fb.core.util.warnIfPageIsSecure=function(){"undefined"!=typeof window&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&fb.core.util.warn("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},fb.core.util.warnAboutUnsupportedMethod=function(e){fb.core.util.warn(e+" is unsupported and will likely change soon.  Please do not use.")},fb.core.util.parseRepoInfo=function(e){var t=fb.core.util.parseURL(e),o=t.subdomain;"firebase"===t.domain&&fb.core.util.fatal(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),o&&"undefined"!=o||fb.core.util.fatal("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||fb.core.util.warnIfPageIsSecure();var r="ws"===t.scheme||"wss"===t.scheme;return{repoInfo:new fb.core.RepoInfo(t.host,t.secure,o,r),path:new fb.core.util.Path(t.pathString)}},fb.core.util.parseURL=function(e){var t="",o="",r="",n="",i=!0,a="https",s=443;if(goog.isString(e)){var l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));var g=e.indexOf("/");g===-1&&(g=e.length),t=e.substring(0,g),n=fb.core.util.decodePath(e.substring(g));var u=t.split(".");3===u.length?(o=u[1],r=u[0].toLowerCase()):2===u.length&&(o=u[0]),l=t.indexOf(":"),l>=0&&(i="https"===a||"wss"===a,s=goog.string.parseInt(t.substring(l+1)))}return{host:t,port:s,domain:o,subdomain:r,secure:i,scheme:a,pathString:n}},fb.core.util.decodePath=function(e){for(var t="",o=e.split("/"),r=0;r<o.length;r++)if(o[r].length>0){var n=o[r];try{n=goog.string.urlDecode(n)}catch(e){}t+="/"+n}return t},fb.core.util.isInvalidJSONNumber=function(e){return goog.isNumber(e)&&(e!=e||e==Number.POSITIVE_INFINITY||e==Number.NEGATIVE_INFINITY)},fb.core.util.executeWhenDOMReady=function(e){if(NODE_CLIENT||"complete"===document.readyState)e();else{var t=!1,o=function(){return document.body?void(t||(t=!0,e())):void setTimeout(o,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",o,!1),window.addEventListener("load",o,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&o()}),window.attachEvent("onload",o))}},fb.core.util.MIN_NAME="[MIN_NAME]",fb.core.util.MAX_NAME="[MAX_NAME]",fb.core.util.nameCompare=function(e,t){if(e===t)return 0;if(e===fb.core.util.MIN_NAME||t===fb.core.util.MAX_NAME)return-1;if(t===fb.core.util.MIN_NAME||e===fb.core.util.MAX_NAME)return 1;var o=fb.core.util.tryParseInt(e),r=fb.core.util.tryParseInt(t);return null!==o?null!==r?o-r==0?e.length-t.length:o-r:-1:null!==r?1:e<t?-1:1},fb.core.util.stringCompare=function(e,t){return e===t?0:e<t?-1:1},fb.core.util.requireKey=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+fb.util.json.stringify(t))},fb.core.util.ObjectToUniqueKey=function(e){if("object"!=typeof e||null===e)return fb.util.json.stringify(e);var t=[];for(var o in e)t.push(o);t.sort();for(var r="{",n=0;n<t.length;n++)0!==n&&(r+=","),r+=fb.util.json.stringify(t[n]),r+=":",r+=fb.core.util.ObjectToUniqueKey(e[t[n]]);return r+="}"},fb.core.util.splitStringBySize=function(e,t){if(e.length<=t)return[e];for(var o=[],r=0;r<e.length;r+=t)r+t>e?o.push(e.substring(r,e.length)):o.push(e.substring(r,r+t));return o},fb.core.util.each=function(e,t){if(goog.isArray(e))for(var o=0;o<e.length;++o)t(o,e[o]);else goog.object.forEach(e,t)},fb.core.util.bindCallback=function(e,t){return t?goog.bind(e,t):e},fb.core.util.doubleToIEEE754String=function(e){fb.core.util.assert(!fb.core.util.isInvalidJSONNumber(e),"Invalid JSON number");var t,o,r,n,i,a,s,l=11,g=52,u=(1<<l-1)-1;for(0===e?(o=0,r=0,t=1/e===-(1/0)?1:0):(t=e<0,e=Math.abs(e),e>=Math.pow(2,1-u)?(n=Math.min(Math.floor(Math.log(e)/Math.LN2),u),o=n+u,r=Math.round(e*Math.pow(2,g-n)-Math.pow(2,g))):(o=0,r=Math.round(e/Math.pow(2,1-u-g)))),a=[],i=g;i;i-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(i=l;i;i-=1)a.push(o%2?1:0),o=Math.floor(o/2);a.push(t?1:0),a.reverse(),s=a.join("");var c="";for(i=0;i<64;i+=8){var f=parseInt(s.substr(i,8),2).toString(16);1===f.length&&(f="0"+f),c+=f}return c.toLowerCase()},fb.core.util.isChromeExtensionContentScript=function(){return!("object"!=typeof window||!window.chrome||!window.chrome.extension||/^chrome/.test(window.location.href))},fb.core.util.isWindowsStoreApp=function(){return"object"==typeof Windows&&"object"==typeof Windows.UI},fb.core.util.errorForServerCode=function(e,t){var o="Unknown Error";"too_big"===e?o="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"==e?o="Client doesn't have permission to access the desired data.":"unavailable"==e&&(o="The service is unavailable");var r=new Error(e+" at "+t.path.toString()+": "+o);return r.code=e.toUpperCase(),r},fb.core.util.INTEGER_REGEXP_=new RegExp("^-?\\d{1,10}$"),fb.core.util.tryParseInt=function(e){if(fb.core.util.INTEGER_REGEXP_.test(e)){var t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},fb.core.util.exceptionGuard=function(e){try{e()}catch(e){setTimeout(function(){var t=e.stack||"";throw fb.core.util.warn("Exception was thrown by user callback.",t),e},Math.floor(0))}},fb.core.util.callUserCallback=function(e,t){if(goog.isFunction(e)){var o=Array.prototype.slice.call(arguments,1),r=o.slice();fb.core.util.exceptionGuard(function(){e.apply(null,r)})}},fb.core.util.beingCrawled=function(){var e="object"==typeof window&&window.navigator&&window.navigator.userAgent||"";return e.search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},goog.provide("fb.util.jwt"),goog.require("fb.core.util"),goog.require("fb.util.json"),goog.require("fb.util.obj"),goog.require("goog.crypt.base64"),goog.require("goog.json"),fb.util.jwt.decode=function(e){var t={},o={},r={},n="";try{var i=e.split(".");t=fb.util.json.eval(fb.core.util.base64Decode(i[0])||""),o=fb.util.json.eval(fb.core.util.base64Decode(i[1])||""),n=i[2],r=o.d||{},delete o.d}catch(e){}return{header:t,claims:o,data:r,signature:n}},fb.util.jwt.isValidTimestamp=function(e){var t,o,r=fb.util.jwt.decode(e).claims,n=Math.floor((new Date).getTime()/1e3);return"object"==typeof r&&(r.hasOwnProperty("nbf")?t=fb.util.obj.get(r,"nbf"):r.hasOwnProperty("iat")&&(t=fb.util.obj.get(r,"iat")),o=r.hasOwnProperty("exp")?fb.util.obj.get(r,"exp"):t+86400),n&&t&&o&&n>=t&&n<=o},fb.util.jwt.issuedAtTime=function(e){var t=fb.util.jwt.decode(e).claims;return"object"==typeof t&&t.hasOwnProperty("iat")?fb.util.obj.get(t,"iat"):null},fb.util.jwt.isValidFormat=function(e){var t=fb.util.jwt.decode(e),o=t.claims;return!!t.signature&&!!o&&"object"==typeof o&&o.hasOwnProperty("iat")},fb.util.jwt.isAdmin=function(e){var t=fb.util.jwt.decode(e).claims;return"object"==typeof t&&fb.util.obj.get(t,"admin")===!0},goog.provide("fb.core.view.EventGenerator"),goog.require("fb.core.snap.NamedNode"),goog.require("fb.core.util"),fb.core.view.EventGenerator=function(e){this.query_=e,this.index_=e.getQueryParams().getIndex()},fb.core.view.EventGenerator.prototype.generateEventsForChanges=function(e,t,o){var r=[],n=this,i=[];return goog.array.forEach(e,function(e){e.type===fb.core.view.Change.CHILD_CHANGED&&n.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&i.push(fb.core.view.Change.childMovedChange(e.childName,e.snapshotNode))}),this.generateEventsForType_(r,fb.core.view.Change.CHILD_REMOVED,e,o,t),this.generateEventsForType_(r,fb.core.view.Change.CHILD_ADDED,e,o,t),this.generateEventsForType_(r,fb.core.view.Change.CHILD_MOVED,i,o,t),this.generateEventsForType_(r,fb.core.view.Change.CHILD_CHANGED,e,o,t),this.generateEventsForType_(r,fb.core.view.Change.VALUE,e,o,t),r},fb.core.view.EventGenerator.prototype.generateEventsForType_=function(e,t,o,r,n){var i=goog.array.filter(o,function(e){return e.type===t}),a=this;goog.array.sort(i,goog.bind(this.compareChanges_,this)),goog.array.forEach(i,function(t){var o=a.materializeSingleChange_(t,n);goog.array.forEach(r,function(r){r.respondsTo(t.type)&&e.push(r.createEvent(o,a.query_))})})},fb.core.view.EventGenerator.prototype.materializeSingleChange_=function(e,t){return"value"===e.type||"child_removed"===e.type?e:(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,this.index_),e)},fb.core.view.EventGenerator.prototype.compareChanges_=function(e,t){if(null==e.childName||null==t.childName)throw fb.core.util.assertionError("Should only compare child_ events.");var o=new fb.core.snap.NamedNode(e.childName,e.snapshotNode),r=new fb.core.snap.NamedNode(t.childName,t.snapshotNode);return this.index_.compare(o,r)},goog.provide("fb.core.view.ChildChangeAccumulator"),goog.require("fb.core.util"),goog.require("fb.core.view.Change"),goog.require("fb.util.obj"),goog.require("goog.object"),fb.core.view.ChildChangeAccumulator=function(){this.changeMap_={}},fb.core.view.ChildChangeAccumulator.prototype.trackChildChange=function(e){var t=fb.core.view.Change,o=e.type,r=e.childName;fb.core.util.assert(o==fb.core.view.Change.CHILD_ADDED||o==fb.core.view.Change.CHILD_CHANGED||o==fb.core.view.Change.CHILD_REMOVED,"Only child changes supported for tracking"),fb.core.util.assert(".priority"!==r,"Only non-priority child changes can be tracked.");var n=fb.util.obj.get(this.changeMap_,r);if(n){var i=n.type;if(o==t.CHILD_ADDED&&i==t.CHILD_REMOVED)this.changeMap_[r]=t.childChangedChange(r,e.snapshotNode,n.snapshotNode);else if(o==t.CHILD_REMOVED&&i==t.CHILD_ADDED)delete this.changeMap_[r];else if(o==t.CHILD_REMOVED&&i==t.CHILD_CHANGED)this.changeMap_[r]=t.childRemovedChange(r,n.oldSnap);else if(o==t.CHILD_CHANGED&&i==t.CHILD_ADDED)this.changeMap_[r]=t.childAddedChange(r,e.snapshotNode);else{
if(o!=t.CHILD_CHANGED||i!=t.CHILD_CHANGED)throw fb.core.util.assertionError("Illegal combination of changes: "+e+" occurred after "+n);this.changeMap_[r]=t.childChangedChange(r,e.snapshotNode,n.oldSnap)}}else this.changeMap_[r]=e},fb.core.view.ChildChangeAccumulator.prototype.getChanges=function(){return goog.object.getValues(this.changeMap_)},goog.provide("fb.core.view.filter.IndexedFilter"),goog.require("fb.core.util"),fb.core.view.filter.IndexedFilter=function(e){this.index_=e},fb.core.view.filter.IndexedFilter.prototype.updateChild=function(e,t,o,r,n,i){var a=fb.core.view.Change;fb.core.util.assert(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var s=e.getImmediateChild(t);return s.getChild(r).equals(o.getChild(r))&&s.isEmpty()==o.isEmpty()?e:(null!=i&&(o.isEmpty()?e.hasChild(t)?i.trackChildChange(a.childRemovedChange(t,s)):fb.core.util.assert(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?i.trackChildChange(a.childAddedChange(t,o)):i.trackChildChange(a.childChangedChange(t,o,s))),e.isLeafNode()&&o.isEmpty()?e:e.updateImmediateChild(t,o).withIndex(this.index_))},fb.core.view.filter.IndexedFilter.prototype.updateFullNode=function(e,t,o){var r=fb.core.view.Change;return null!=o&&(e.isLeafNode()||e.forEachChild(fb.core.snap.PriorityIndex,function(e,n){t.hasChild(e)||o.trackChildChange(r.childRemovedChange(e,n))}),t.isLeafNode()||t.forEachChild(fb.core.snap.PriorityIndex,function(t,n){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(n)||o.trackChildChange(r.childChangedChange(t,n,i))}else o.trackChildChange(r.childAddedChange(t,n))})),t.withIndex(this.index_)},fb.core.view.filter.IndexedFilter.prototype.updatePriority=function(e,t){return e.isEmpty()?fb.core.snap.EMPTY_NODE:e.updatePriority(t)},fb.core.view.filter.IndexedFilter.prototype.filtersNodes=function(){return!1},fb.core.view.filter.IndexedFilter.prototype.getIndexedFilter=function(){return this},fb.core.view.filter.IndexedFilter.prototype.getIndex=function(){return this.index_},goog.provide("fb.core.view.filter.RangedFilter"),goog.require("fb.core.view.filter.IndexedFilter"),fb.core.view.filter.RangedFilter=function(e){this.indexedFilter_=new fb.core.view.filter.IndexedFilter(e.getIndex()),this.index_=e.getIndex(),this.startPost_=this.getStartPost_(e),this.endPost_=this.getEndPost_(e)},fb.core.view.filter.RangedFilter.prototype.getStartPost=function(){return this.startPost_},fb.core.view.filter.RangedFilter.prototype.getEndPost=function(){return this.endPost_},fb.core.view.filter.RangedFilter.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},fb.core.view.filter.RangedFilter.prototype.updateChild=function(e,t,o,r,n,i){return this.matches(new fb.core.snap.NamedNode(t,o))||(o=fb.core.snap.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,o,r,n,i)},fb.core.view.filter.RangedFilter.prototype.updateFullNode=function(e,t,o){t.isLeafNode()&&(t=fb.core.snap.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(fb.core.snap.EMPTY_NODE);var n=this;return t.forEachChild(fb.core.snap.PriorityIndex,function(e,t){n.matches(new fb.core.snap.NamedNode(e,t))||(r=r.updateImmediateChild(e,fb.core.snap.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,o)},fb.core.view.filter.RangedFilter.prototype.updatePriority=function(e,t){return e},fb.core.view.filter.RangedFilter.prototype.filtersNodes=function(){return!0},fb.core.view.filter.RangedFilter.prototype.getIndexedFilter=function(){return this.indexedFilter_},fb.core.view.filter.RangedFilter.prototype.getIndex=function(){return this.index_},fb.core.view.filter.RangedFilter.prototype.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()};fb.core.view.filter.RangedFilter.prototype.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()};goog.provide("fb.core.view.filter.NodeFilter"),goog.require("fb.core.view.ChildChangeAccumulator"),goog.require("fb.core.view.CompleteChildSource"),fb.core.view.filter.NodeFilter=function(){},fb.core.view.filter.NodeFilter.prototype.updateChild=function(e,t,o,r,n,i){},fb.core.view.filter.NodeFilter.prototype.updateFullNode=function(e,t,o){},fb.core.view.filter.NodeFilter.prototype.updatePriority=function(e,t){},fb.core.view.filter.NodeFilter.prototype.filtersNodes=function(){},fb.core.view.filter.NodeFilter.prototype.getIndexedFilter=function(){},fb.core.view.filter.NodeFilter.prototype.getIndex=function(){},goog.provide("fb.core.view.filter.LimitedFilter"),goog.require("fb.core.snap.NamedNode"),goog.require("fb.core.view.filter.RangedFilter"),goog.require("fb.core.util"),fb.core.view.filter.LimitedFilter=function(e){this.rangedFilter_=new fb.core.view.filter.RangedFilter(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()},fb.core.view.filter.LimitedFilter.prototype.updateChild=function(e,t,o,r,n,i){return this.rangedFilter_.matches(new fb.core.snap.NamedNode(t,o))||(o=fb.core.snap.EMPTY_NODE),e.getImmediateChild(t).equals(o)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,o,r,n,i):this.fullLimitUpdateChild_(e,t,o,n,i)},fb.core.view.filter.LimitedFilter.prototype.updateFullNode=function(e,t,o){var r;if(t.isLeafNode()||t.isEmpty())r=fb.core.snap.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=fb.core.snap.EMPTY_NODE.withIndex(this.index_);var n;t=t,n=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var i=0;n.hasNext()&&i<this.limit_;){var a,s=n.getNext();if(a=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),s)<=0:this.index_.compare(s,this.rangedFilter_.getEndPost())<=0,!a)break;r=r.updateImmediateChild(s.name,s.node),i++}}else{r=t.withIndex(this.index_),r=r.updatePriority(fb.core.snap.EMPTY_NODE);var l,g,u;if(this.reverse_){n=r.getReverseIterator(this.index_),l=this.rangedFilter_.getEndPost(),g=this.rangedFilter_.getStartPost();var c=this.index_.getCompare();u=function(e,t){return c(t,e)}}else n=r.getIterator(this.index_),l=this.rangedFilter_.getStartPost(),g=this.rangedFilter_.getEndPost(),u=this.index_.getCompare();i=0;for(var f=!1;n.hasNext();)s=n.getNext(),!f&&u(l,s)<=0&&(f=!0),a=f&&i<this.limit_&&u(s,g)<=0,a?i++:r=r.updateImmediateChild(s.name,fb.core.snap.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,o)},fb.core.view.filter.LimitedFilter.prototype.updatePriority=function(e,t){return e},fb.core.view.filter.LimitedFilter.prototype.filtersNodes=function(){return!0},fb.core.view.filter.LimitedFilter.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},fb.core.view.filter.LimitedFilter.prototype.getIndex=function(){return this.index_},fb.core.view.filter.LimitedFilter.prototype.fullLimitUpdateChild_=function(e,t,o,r,n){var i,a=fb.core.view.Change;if(this.reverse_){var s=this.index_.getCompare();i=function(e,t){return s(t,e)}}else i=this.index_.getCompare();var l=e;fb.core.util.assert(l.numChildren()==this.limit_,"");var g=new fb.core.snap.NamedNode(t,o),u=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),c=this.rangedFilter_.matches(g);if(l.hasChild(t)){for(var f=l.getImmediateChild(t),h=r.getChildAfterChild(this.index_,u,this.reverse_);null!=h&&(h.name==t||l.hasChild(h.name));)h=r.getChildAfterChild(this.index_,h,this.reverse_);var p=null==h?1:i(h,g),d=c&&!o.isEmpty()&&p>=0;if(d)return null!=n&&n.trackChildChange(a.childChangedChange(t,o,f)),l.updateImmediateChild(t,o);null!=n&&n.trackChildChange(a.childRemovedChange(t,f));var b=l.updateImmediateChild(t,fb.core.snap.EMPTY_NODE),_=null!=h&&this.rangedFilter_.matches(h);return _?(null!=n&&n.trackChildChange(a.childAddedChange(h.name,h.node)),b.updateImmediateChild(h.name,h.node)):b}return o.isEmpty()?e:c&&i(u,g)>=0?(null!=n&&(n.trackChildChange(a.childRemovedChange(u.name,u.node)),n.trackChildChange(a.childAddedChange(t,o))),l.updateImmediateChild(t,o).updateImmediateChild(u.name,fb.core.snap.EMPTY_NODE)):e},goog.provide("fb.core.view.ViewProcessor"),goog.require("fb.core.view.CompleteChildSource"),goog.require("fb.core.util"),fb.core.view.ProcessorResult=function(e,t){this.viewCache=e,this.changes=t},fb.core.view.ViewProcessor=function(e){this.filter_=e},fb.core.view.ViewProcessor.prototype.assertIndexed=function(e){fb.core.util.assert(e.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),fb.core.util.assert(e.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},fb.core.view.ViewProcessor.prototype.applyOperation=function(e,t,o,r){var n,i,a=new fb.core.view.ChildChangeAccumulator;if(t.type===fb.core.OperationType.OVERWRITE){var s=t;s.source.fromUser?n=this.applyUserOverwrite_(e,s.path,s.snap,o,r,a):(fb.core.util.assert(s.source.fromServer,"Unknown source."),i=s.source.tagged||e.getServerCache().isFiltered()&&!s.path.isEmpty(),n=this.applyServerOverwrite_(e,s.path,s.snap,o,r,i,a))}else if(t.type===fb.core.OperationType.MERGE){var l=t;l.source.fromUser?n=this.applyUserMerge_(e,l.path,l.children,o,r,a):(fb.core.util.assert(l.source.fromServer,"Unknown source."),i=l.source.tagged||e.getServerCache().isFiltered(),n=this.applyServerMerge_(e,l.path,l.children,o,r,i,a))}else if(t.type===fb.core.OperationType.ACK_USER_WRITE){var g=t;n=g.revert?this.revertUserWrite_(e,g.path,o,r,a):this.ackUserWrite_(e,g.path,g.affectedTree,o,r,a)}else{if(t.type!==fb.core.OperationType.LISTEN_COMPLETE)throw fb.core.util.assertionError("Unknown operation type: "+t.type);n=this.listenComplete_(e,t.path,o,r,a)}var u=a.getChanges();return this.maybeAddValueEvent_(e,n,u),new fb.core.view.ProcessorResult(n,u)},fb.core.view.ViewProcessor.prototype.maybeAddValueEvent_=function(e,t,o){var r=t.getEventCache();if(r.isFullyInitialized()){var n=r.getNode().isLeafNode()||r.getNode().isEmpty(),i=e.getCompleteEventSnap();(o.length>0||!e.getEventCache().isFullyInitialized()||n&&!r.getNode().equals(i)||!r.getNode().getPriority().equals(i.getPriority()))&&o.push(fb.core.view.Change.valueChange(t.getCompleteEventSnap()))}},fb.core.view.ViewProcessor.prototype.generateEventCacheAfterServerEvent_=function(e,t,o,r,n){var i=e.getEventCache();if(null!=o.shadowingWrite(t))return e;var a,s;if(t.isEmpty())if(fb.core.util.assert(e.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),e.getServerCache().isFiltered()){var l=e.getCompleteServerSnap(),g=l instanceof fb.core.snap.ChildrenNode?l:fb.core.snap.EMPTY_NODE,u=o.calcCompleteEventChildren(g);a=this.filter_.updateFullNode(e.getEventCache().getNode(),u,n)}else{var c=o.calcCompleteEventCache(e.getCompleteServerSnap());a=this.filter_.updateFullNode(e.getEventCache().getNode(),c,n)}else{var f=t.getFront();if(".priority"==f){fb.core.util.assert(1==t.getLength(),"Can't have a priority with additional path components");var h=i.getNode();s=e.getServerCache().getNode();var p=o.calcEventCacheAfterServerOverwrite(t,h,s);a=null!=p?this.filter_.updatePriority(h,p):i.getNode()}else{var d,b=t.popFront();if(i.isCompleteForChild(f)){s=e.getServerCache().getNode();var _=o.calcEventCacheAfterServerOverwrite(t,i.getNode(),s);d=null!=_?i.getNode().getImmediateChild(f).updateChild(b,_):i.getNode().getImmediateChild(f)}else d=o.calcCompleteChild(f,e.getServerCache());a=null!=d?this.filter_.updateChild(i.getNode(),f,d,b,r,n):i.getNode()}}return e.updateEventSnap(a,i.isFullyInitialized()||t.isEmpty(),this.filter_.filtersNodes())},fb.core.view.ViewProcessor.prototype.applyServerOverwrite_=function(e,t,o,r,n,i,a){var s,l=e.getServerCache(),g=i?this.filter_:this.filter_.getIndexedFilter();if(t.isEmpty())s=g.updateFullNode(l.getNode(),o,null);else if(g.filtersNodes()&&!l.isFiltered()){var u=l.getNode().updateChild(t,o);s=g.updateFullNode(l.getNode(),u,null)}else{var c=t.getFront();if(!l.isCompleteForPath(t)&&t.getLength()>1)return e;var f=t.popFront(),h=l.getNode().getImmediateChild(c),p=h.updateChild(f,o);s=".priority"==c?g.updatePriority(l.getNode(),p):g.updateChild(l.getNode(),c,p,f,fb.core.view.NO_COMPLETE_CHILD_SOURCE,null)}var d=e.updateServerSnap(s,l.isFullyInitialized()||t.isEmpty(),g.filtersNodes()),b=new fb.core.view.WriteTreeCompleteChildSource(r,d,n);return this.generateEventCacheAfterServerEvent_(d,t,r,b,a)},fb.core.view.ViewProcessor.prototype.applyUserOverwrite_=function(e,t,o,r,n,i){var a,s,l=e.getEventCache(),g=new fb.core.view.WriteTreeCompleteChildSource(r,e,n);if(t.isEmpty())s=this.filter_.updateFullNode(e.getEventCache().getNode(),o,i),a=e.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var u=t.getFront();if(".priority"===u)s=this.filter_.updatePriority(e.getEventCache().getNode(),o),a=e.updateEventSnap(s,l.isFullyInitialized(),l.isFiltered());else{var c,f=t.popFront(),h=l.getNode().getImmediateChild(u);if(f.isEmpty())c=o;else{var p=g.getCompleteChild(u);c=null!=p?".priority"===f.getBack()&&p.getChild(f.parent()).isEmpty()?p:p.updateChild(f,o):fb.core.snap.EMPTY_NODE}if(h.equals(c))a=e;else{var d=this.filter_.updateChild(l.getNode(),u,c,f,g,i);a=e.updateEventSnap(d,l.isFullyInitialized(),this.filter_.filtersNodes())}}}return a},fb.core.view.ViewProcessor.cacheHasChild_=function(e,t){return e.getEventCache().isCompleteForChild(t)},fb.core.view.ViewProcessor.prototype.applyUserMerge_=function(e,t,o,r,n,i){var a=this,s=e;return o.foreach(function(o,l){var g=t.child(o);fb.core.view.ViewProcessor.cacheHasChild_(e,g.getFront())&&(s=a.applyUserOverwrite_(s,g,l,r,n,i))}),o.foreach(function(o,l){var g=t.child(o);fb.core.view.ViewProcessor.cacheHasChild_(e,g.getFront())||(s=a.applyUserOverwrite_(s,g,l,r,n,i))}),s},fb.core.view.ViewProcessor.prototype.applyMerge_=function(e,t){return t.foreach(function(t,o){e=e.updateChild(t,o)}),e},fb.core.view.ViewProcessor.prototype.applyServerMerge_=function(e,t,o,r,n,i,a){if(e.getServerCache().getNode().isEmpty()&&!e.getServerCache().isFullyInitialized())return e;var s,l=e;s=t.isEmpty()?o:fb.core.util.ImmutableTree.Empty.setTree(t,o);var g=e.getServerCache().getNode(),u=this;return s.children.inorderTraversal(function(t,o){if(g.hasChild(t)){var s=e.getServerCache().getNode().getImmediateChild(t),c=u.applyMerge_(s,o);l=u.applyServerOverwrite_(l,new fb.core.util.Path(t),c,r,n,i,a)}}),s.children.inorderTraversal(function(t,o){var s=!e.getServerCache().isCompleteForChild(t)&&null==o.value;if(!g.hasChild(t)&&!s){var c=e.getServerCache().getNode().getImmediateChild(t),f=u.applyMerge_(c,o);l=u.applyServerOverwrite_(l,new fb.core.util.Path(t),f,r,n,i,a)}}),l},fb.core.view.ViewProcessor.prototype.ackUserWrite_=function(e,t,o,r,n,i){if(null!=r.shadowingWrite(t))return e;var a=e.getServerCache().isFiltered(),s=e.getServerCache();if(null!=o.value){if(t.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(t))return this.applyServerOverwrite_(e,t,s.getNode().getChild(t),r,n,a,i);if(t.isEmpty()){var l=fb.core.util.ImmutableTree.Empty;return s.getNode().forEachChild(fb.core.snap.KeyIndex,function(e,t){l=l.set(new fb.core.util.Path(e),t)}),this.applyServerMerge_(e,t,l,r,n,a,i)}return e}var l=fb.core.util.ImmutableTree.Empty;return o.foreach(function(e,o){var r=t.child(e);s.isCompleteForPath(r)&&(l=l.set(e,s.getNode().getChild(r)))}),this.applyServerMerge_(e,t,l,r,n,a,i)},fb.core.view.ViewProcessor.prototype.revertUserWrite_=function(e,t,o,r,n){var i;if(null!=o.shadowingWrite(t))return e;var a,s=new fb.core.view.WriteTreeCompleteChildSource(o,e,r),l=e.getEventCache().getNode();if(t.isEmpty()||".priority"===t.getFront()){var g;if(e.getServerCache().isFullyInitialized())g=o.calcCompleteEventCache(e.getCompleteServerSnap());else{var u=e.getServerCache().getNode();fb.core.util.assert(u instanceof fb.core.snap.ChildrenNode,"serverChildren would be complete if leaf node"),g=o.calcCompleteEventChildren(u)}g=g,a=this.filter_.updateFullNode(l,g,n)}else{var c=t.getFront(),f=o.calcCompleteChild(c,e.getServerCache());null==f&&e.getServerCache().isCompleteForChild(c)&&(f=l.getImmediateChild(c)),a=null!=f?this.filter_.updateChild(l,c,f,t.popFront(),s,n):e.getEventCache().getNode().hasChild(c)?this.filter_.updateChild(l,c,fb.core.snap.EMPTY_NODE,t.popFront(),s,n):l,a.isEmpty()&&e.getServerCache().isFullyInitialized()&&(i=o.calcCompleteEventCache(e.getCompleteServerSnap()),i.isLeafNode()&&(a=this.filter_.updateFullNode(a,i,n)))}return i=e.getServerCache().isFullyInitialized()||null!=o.shadowingWrite(fb.core.util.Path.Empty),e.updateEventSnap(a,i,this.filter_.filtersNodes())},fb.core.view.ViewProcessor.prototype.listenComplete_=function(e,t,o,r,n){var i=e.getServerCache(),a=e.updateServerSnap(i.getNode(),i.isFullyInitialized()||t.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(a,t,o,fb.core.view.NO_COMPLETE_CHILD_SOURCE,n)},goog.provide("fb.core.snap.Index"),goog.provide("fb.core.snap.KeyIndex"),goog.provide("fb.core.snap.PathIndex"),goog.provide("fb.core.snap.PriorityIndex"),goog.provide("fb.core.snap.ValueIndex"),goog.require("fb.core.util"),fb.core.snap.Index=function(){},fb.core.snap.Index.FallbackType,fb.core.snap.Index.Fallback={},fb.core.snap.Index.prototype.compare=goog.abstractMethod,fb.core.snap.Index.prototype.isDefinedOn=goog.abstractMethod,fb.core.snap.Index.prototype.getCompare=function(){return goog.bind(this.compare,this)},fb.core.snap.Index.prototype.indexedValueChanged=function(e,t){var o=new fb.core.snap.NamedNode(fb.core.util.MIN_NAME,e),r=new fb.core.snap.NamedNode(fb.core.util.MIN_NAME,t);return 0!==this.compare(o,r)},fb.core.snap.Index.prototype.minPost=function(){return fb.core.snap.NamedNode.MIN},fb.core.snap.Index.prototype.maxPost=goog.abstractMethod,fb.core.snap.Index.prototype.makePost=goog.abstractMethod,fb.core.snap.Index.prototype.toString=goog.abstractMethod,fb.core.snap.PathIndex=function(e){fb.core.snap.Index.call(this),fb.core.util.assert(!e.isEmpty()&&".priority"!==e.getFront(),"Can't create PathIndex with empty path or .priority key"),this.indexPath_=e},goog.inherits(fb.core.snap.PathIndex,fb.core.snap.Index),fb.core.snap.PathIndex.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},fb.core.snap.PathIndex.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},fb.core.snap.PathIndex.prototype.compare=function(e,t){var o=this.extractChild(e.node),r=this.extractChild(t.node),n=o.compareTo(r);return 0===n?fb.core.util.nameCompare(e.name,t.name):n},fb.core.snap.PathIndex.prototype.makePost=function(e,t){var o=fb.core.snap.NodeFromJSON(e),r=fb.core.snap.EMPTY_NODE.updateChild(this.indexPath_,o);return new fb.core.snap.NamedNode(t,r)},fb.core.snap.PathIndex.prototype.maxPost=function(){var e=fb.core.snap.EMPTY_NODE.updateChild(this.indexPath_,fb.core.snap.MAX_NODE);return new fb.core.snap.NamedNode(fb.core.util.MAX_NAME,e)},fb.core.snap.PathIndex.prototype.toString=function(){return this.indexPath_.slice().join("/")},fb.core.snap.PriorityIndex_=function(){fb.core.snap.Index.call(this)},goog.inherits(fb.core.snap.PriorityIndex_,fb.core.snap.Index),fb.core.snap.PriorityIndex_.prototype.compare=function(e,t){var o=e.node.getPriority(),r=t.node.getPriority(),n=o.compareTo(r);return 0===n?fb.core.util.nameCompare(e.name,t.name):n},fb.core.snap.PriorityIndex_.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},fb.core.snap.PriorityIndex_.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},fb.core.snap.PriorityIndex_.prototype.minPost=function(){return fb.core.snap.NamedNode.MIN},fb.core.snap.PriorityIndex_.prototype.maxPost=function(){return new fb.core.snap.NamedNode(fb.core.util.MAX_NAME,new fb.core.snap.LeafNode("[PRIORITY-POST]",fb.core.snap.MAX_NODE))},fb.core.snap.PriorityIndex_.prototype.makePost=function(e,t){var o=fb.core.snap.NodeFromJSON(e);return new fb.core.snap.NamedNode(t,new fb.core.snap.LeafNode("[PRIORITY-POST]",o))},fb.core.snap.PriorityIndex_.prototype.toString=function(){return".priority"},fb.core.snap.PriorityIndex=new fb.core.snap.PriorityIndex_,fb.core.snap.KeyIndex_=function(){fb.core.snap.Index.call(this)},goog.inherits(fb.core.snap.KeyIndex_,fb.core.snap.Index),fb.core.snap.KeyIndex_.prototype.compare=function(e,t){return fb.core.util.nameCompare(e.name,t.name)},fb.core.snap.KeyIndex_.prototype.isDefinedOn=function(e){throw fb.core.util.assertionError("KeyIndex.isDefinedOn not expected to be called.")},fb.core.snap.KeyIndex_.prototype.indexedValueChanged=function(e,t){return!1},fb.core.snap.KeyIndex_.prototype.minPost=function(){return fb.core.snap.NamedNode.MIN},fb.core.snap.KeyIndex_.prototype.maxPost=function(){return new fb.core.snap.NamedNode(fb.core.util.MAX_NAME,fb.core.snap.EMPTY_NODE)},fb.core.snap.KeyIndex_.prototype.makePost=function(e,t){return fb.core.util.assert(goog.isString(e),"KeyIndex indexValue must always be a string."),new fb.core.snap.NamedNode(e,fb.core.snap.EMPTY_NODE)},fb.core.snap.KeyIndex_.prototype.toString=function(){return".key"},fb.core.snap.KeyIndex=new fb.core.snap.KeyIndex_,fb.core.snap.ValueIndex_=function(){fb.core.snap.Index.call(this)},goog.inherits(fb.core.snap.ValueIndex_,fb.core.snap.Index),fb.core.snap.ValueIndex_.prototype.compare=function(e,t){var o=e.node.compareTo(t.node);return 0===o?fb.core.util.nameCompare(e.name,t.name):o},fb.core.snap.ValueIndex_.prototype.isDefinedOn=function(e){return!0},fb.core.snap.ValueIndex_.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},fb.core.snap.ValueIndex_.prototype.minPost=function(){return fb.core.snap.NamedNode.MIN},fb.core.snap.ValueIndex_.prototype.maxPost=function(){return fb.core.snap.NamedNode.MAX},fb.core.snap.ValueIndex_.prototype.makePost=function(e,t){var o=fb.core.snap.NodeFromJSON(e);return new fb.core.snap.NamedNode(t,o)},fb.core.snap.ValueIndex_.prototype.toString=function(){return".value"},fb.core.snap.ValueIndex=new fb.core.snap.ValueIndex_,goog.provide("fb.core.view.QueryParams"),goog.require("fb.core.snap.Index"),goog.require("fb.core.snap.PriorityIndex"),goog.require("fb.core.util"),goog.require("fb.core.view.filter.IndexedFilter"),goog.require("fb.core.view.filter.LimitedFilter"),goog.require("fb.core.view.filter.NodeFilter"),goog.require("fb.core.view.filter.RangedFilter"),fb.core.view.QueryParams=function(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=fb.core.snap.PriorityIndex},fb.core.view.QueryParams.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},fb.core.view.QueryParams.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},fb.core.view.QueryParams.DEFAULT=new fb.core.view.QueryParams,fb.core.view.QueryParams.prototype.hasStart=function(){return this.startSet_},fb.core.view.QueryParams.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===fb.core.view.QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},fb.core.view.QueryParams.prototype.getIndexStartValue=function(){return fb.core.util.assert(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},fb.core.view.QueryParams.prototype.getIndexStartName=function(){return fb.core.util.assert(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:fb.core.util.MIN_NAME},fb.core.view.QueryParams.prototype.hasEnd=function(){return this.endSet_},fb.core.view.QueryParams.prototype.getIndexEndValue=function(){return fb.core.util.assert(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},fb.core.view.QueryParams.prototype.getIndexEndName=function(){return fb.core.util.assert(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:fb.core.util.MAX_NAME},fb.core.view.QueryParams.prototype.hasLimit=function(){return this.limitSet_},fb.core.view.QueryParams.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},fb.core.view.QueryParams.prototype.getLimit=function(){return fb.core.util.assert(this.limitSet_,"Only valid if limit has been set"),this.limit_},fb.core.view.QueryParams.prototype.getIndex=function(){return this.index_},fb.core.view.QueryParams.prototype.copy_=function(){var e=new fb.core.view.QueryParams;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e},fb.core.view.QueryParams.prototype.limit=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="",t},fb.core.view.QueryParams.prototype.limitToFirst=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_=fb.core.view.QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,t},fb.core.view.QueryParams.prototype.limitToLast=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_=fb.core.view.QueryParams.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,t},fb.core.view.QueryParams.prototype.startAt=function(e,t){var o=this.copy_();return o.startSet_=!0,goog.isDef(e)||(e=null),o.indexStartValue_=e,null!=t?(o.startNameSet_=!0,o.indexStartName_=t):(o.startNameSet_=!1,o.indexStartName_=""),o},fb.core.view.QueryParams.prototype.endAt=function(e,t){var o=this.copy_();return o.endSet_=!0,goog.isDef(e)||(e=null),o.indexEndValue_=e,goog.isDef(t)?(o.endNameSet_=!0,o.indexEndName_=t):(o.startEndSet_=!1,o.indexEndName_=""),o},fb.core.view.QueryParams.prototype.orderBy=function(e){var t=this.copy_();return t.index_=e,t},fb.core.view.QueryParams.prototype.getQueryObject=function(){var e=fb.core.view.QueryParams.WIRE_PROTOCOL_CONSTANTS_,t={};if(this.startSet_&&(t[e.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(t[e.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(t[e.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(t[e.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){t[e.LIMIT]=this.limit_;var o=this.viewFrom_;""===o&&(o=this.isViewFromLeft()?e.VIEW_FROM_LEFT:e.VIEW_FROM_RIGHT),t[e.VIEW_FROM]=o}return this.index_!==fb.core.snap.PriorityIndex&&(t[e.INDEX]=this.index_.toString()),t},fb.core.view.QueryParams.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},fb.core.view.QueryParams.prototype.isDefault=function(){return this.loadsAllData()&&this.index_==fb.core.snap.PriorityIndex},fb.core.view.QueryParams.prototype.getNodeFilter=function(){return this.loadsAllData()?new fb.core.view.filter.IndexedFilter(this.getIndex()):this.hasLimit()?new fb.core.view.filter.LimitedFilter(this):new fb.core.view.filter.RangedFilter(this)},fb.core.view.QueryParams.prototype.toRestQueryStringParameters=function(){var e=fb.core.view.QueryParams.REST_QUERY_CONSTANTS_,t={};if(this.isDefault())return t;var o;return this.index_===fb.core.snap.PriorityIndex?o=e.PRIORITY_INDEX:this.index_===fb.core.snap.ValueIndex?o=e.VALUE_INDEX:this.index_===fb.core.snap.KeyIndex?o=e.KEY_INDEX:(fb.core.util.assert(this.index_ instanceof fb.core.snap.PathIndex,"Unrecognized index type!"),o=this.index_.toString()),t[e.ORDER_BY]=fb.util.json.stringify(o),this.startSet_&&(t[e.START_AT]=fb.util.json.stringify(this.indexStartValue_),this.startNameSet_&&(t[e.START_AT]+=","+fb.util.json.stringify(this.indexStartName_))),this.endSet_&&(t[e.END_AT]=fb.util.json.stringify(this.indexEndValue_),this.endNameSet_&&(t[e.END_AT]+=","+fb.util.json.stringify(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?t[e.LIMIT_TO_FIRST]=this.limit_:t[e.LIMIT_TO_LAST]=this.limit_),t},goog.DEBUG&&(fb.core.view.QueryParams.prototype.toString=function(){return fb.util.json.stringify(this.getQueryObject())}),goog.provide("fb.core.snap.IndexMap"),goog.require("fb.core.snap.Index"),goog.require("fb.core.util"),fb.core.snap.IndexMap=function(e,t){this.indexes_=e,this.indexSet_=t},fb.core.snap.IndexMap.prototype.get=function(e){var t=fb.util.obj.get(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t===fb.core.snap.Index.Fallback?null:t},fb.core.snap.IndexMap.prototype.hasIndex=function(e){return goog.object.contains(this.indexSet_,e.toString())},fb.core.snap.IndexMap.prototype.addIndex=function(e,t){fb.core.util.assert(e!==fb.core.snap.KeyIndex,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var o=[],r=!1,n=t.getIterator(fb.core.snap.NamedNode.Wrap),i=n.getNext();i;)r=r||e.isDefinedOn(i.node),o.push(i),i=n.getNext();var a;a=r?fb.core.snap.buildChildSet(o,e.getCompare()):fb.core.snap.Index.Fallback;var s=e.toString(),l=goog.object.clone(this.indexSet_);l[s]=e;var g=goog.object.clone(this.indexes_);return g[s]=a,new fb.core.snap.IndexMap(g,l)},fb.core.snap.IndexMap.prototype.addToIndexes=function(e,t){var o=this,r=goog.object.map(this.indexes_,function(r,n){var i=fb.util.obj.get(o.indexSet_,n);if(fb.core.util.assert(i,"Missing index implementation for "+n),r===fb.core.snap.Index.Fallback){if(i.isDefinedOn(e.node)){for(var a=[],s=t.getIterator(fb.core.snap.NamedNode.Wrap),l=s.getNext();l;)l.name!=e.name&&a.push(l),l=s.getNext();return a.push(e),fb.core.snap.buildChildSet(a,i.getCompare())}return fb.core.snap.Index.Fallback}var g=t.get(e.name),u=r;return g&&(u=u.remove(new fb.core.snap.NamedNode(e.name,g))),u.insert(e,e.node)});return new fb.core.snap.IndexMap(r,this.indexSet_)},fb.core.snap.IndexMap.prototype.removeFromIndexes=function(e,t){var o=goog.object.map(this.indexes_,function(o){if(o===fb.core.snap.Index.Fallback)return o;var r=t.get(e.name);return r?o.remove(new fb.core.snap.NamedNode(e.name,r)):o});return new fb.core.snap.IndexMap(o,this.indexSet_)},fb.core.snap.IndexMap.Default=new fb.core.snap.IndexMap({".priority":fb.core.snap.Index.Fallback},{".priority":fb.core.snap.PriorityIndex}),goog.provide("fb.core.snap.LeafNode"),goog.require("fb.core.snap.Node"),goog.require("fb.core.util"),fb.core.snap.LeafNode=goog.defineClass(null,{constructor:function(e,t){this.value_=e,fb.core.util.assert(goog.isDef(this.value_)&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),this.priorityNode_=t||fb.core.snap.EMPTY_NODE,fb.core.snap.validatePriorityNode(this.priorityNode_),this.lazyHash_=null},statics:{VALUE_TYPE_ORDER:["object","boolean","number","string"]},isLeafNode:function(){return!0},getPriority:function(){return this.priorityNode_},updatePriority:function(e){return new fb.core.snap.LeafNode(this.value_,e)},getImmediateChild:function(e){return".priority"===e?this.priorityNode_:fb.core.snap.EMPTY_NODE},getChild:function(e){return e.isEmpty()?this:".priority"===e.getFront()?this.priorityNode_:fb.core.snap.EMPTY_NODE},hasChild:function(){return!1},getPredecessorChildName:function(e,t){return null},updateImmediateChild:function(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:fb.core.snap.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)},updateChild:function(e,t){var o=e.getFront();return null===o?t:t.isEmpty()&&".priority"!==o?this:(fb.core.util.assert(".priority"!==o||1===e.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(o,fb.core.snap.EMPTY_NODE.updateChild(e.popFront(),t)))},isEmpty:function(){return!1},numChildren:function(){return 0},forEachChild:function(e,t){return!1},val:function(e){return e&&!this.getPriority().isEmpty()?{
".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},hash:function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+fb.core.snap.priorityHashText(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?fb.core.util.doubleToIEEE754String(this.value_):this.value_,this.lazyHash_=fb.core.util.sha1(e)}return this.lazyHash_},getValue:function(){return this.value_},compareTo:function(e){return e===fb.core.snap.EMPTY_NODE?1:e instanceof fb.core.snap.ChildrenNode?-1:(fb.core.util.assert(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},compareToLeafNode_:function(e){var t=typeof e.value_,o=typeof this.value_,r=goog.array.indexOf(fb.core.snap.LeafNode.VALUE_TYPE_ORDER,t),n=goog.array.indexOf(fb.core.snap.LeafNode.VALUE_TYPE_ORDER,o);return fb.core.util.assert(r>=0,"Unknown leaf type: "+t),fb.core.util.assert(n>=0,"Unknown leaf type: "+o),r===n?"object"===o?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:n-r},withIndex:function(){return this},isIndexed:function(){return!0},equals:function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}),goog.DEBUG&&(fb.core.snap.LeafNode.prototype.toString=function(){return fb.util.json.stringify(this.val(!0))}),goog.provide("fb.core.snap.ChildrenNode"),goog.require("fb.core.snap.IndexMap"),goog.require("fb.core.snap.LeafNode"),goog.require("fb.core.snap.NamedNode"),goog.require("fb.core.snap.Node"),goog.require("fb.core.snap.PriorityIndex"),goog.require("fb.core.snap.comparators"),goog.require("fb.core.util"),goog.require("fb.core.util.SortedMap"),fb.core.snap.ChildrenNode=function(e,t,o){this.children_=e,this.priorityNode_=t,this.priorityNode_&&fb.core.snap.validatePriorityNode(this.priorityNode_),e.isEmpty()&&fb.core.util.assert(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority"),this.indexMap_=o,this.lazyHash_=null},fb.core.snap.ChildrenNode.prototype.isLeafNode=function(){return!1},fb.core.snap.ChildrenNode.prototype.getPriority=function(){return this.priorityNode_||fb.core.snap.EMPTY_NODE},fb.core.snap.ChildrenNode.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new fb.core.snap.ChildrenNode(this.children_,e,this.indexMap_)},fb.core.snap.ChildrenNode.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?fb.core.snap.EMPTY_NODE:t},fb.core.snap.ChildrenNode.prototype.getChild=function(e){var t=e.getFront();return null===t?this:this.getImmediateChild(t).getChild(e.popFront())},fb.core.snap.ChildrenNode.prototype.hasChild=function(e){return null!==this.children_.get(e)},fb.core.snap.ChildrenNode.prototype.updateImmediateChild=function(e,t){if(fb.core.util.assert(t,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(t);var o,r,n,i=new fb.core.snap.NamedNode(e,t);return t.isEmpty()?(o=this.children_.remove(e),r=this.indexMap_.removeFromIndexes(i,this.children_)):(o=this.children_.insert(e,t),r=this.indexMap_.addToIndexes(i,this.children_)),n=o.isEmpty()?fb.core.snap.EMPTY_NODE:this.priorityNode_,new fb.core.snap.ChildrenNode(o,n,r)},fb.core.snap.ChildrenNode.prototype.updateChild=function(e,t){var o=e.getFront();if(null===o)return t;fb.core.util.assert(".priority"!==e.getFront()||1===e.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(o).updateChild(e.popFront(),t);return this.updateImmediateChild(o,r)},fb.core.snap.ChildrenNode.prototype.isEmpty=function(){return this.children_.isEmpty()},fb.core.snap.ChildrenNode.prototype.numChildren=function(){return this.children_.count()},fb.core.snap.ChildrenNode.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,fb.core.snap.ChildrenNode.prototype.val=function(e){if(this.isEmpty())return null;var t={},o=0,r=0,n=!0;if(this.forEachChild(fb.core.snap.PriorityIndex,function(i,a){t[i]=a.val(e),o++,n&&fb.core.snap.ChildrenNode.INTEGER_REGEXP_.test(i)?r=Math.max(r,Number(i)):n=!1}),!e&&n&&r<2*o){var i=[];for(var a in t)i[a]=t[a];return i}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t},fb.core.snap.ChildrenNode.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+fb.core.snap.priorityHashText(this.getPriority().val())+":"),this.forEachChild(fb.core.snap.PriorityIndex,function(t,o){var r=o.hash();""!==r&&(e+=":"+t+":"+r)}),this.lazyHash_=""===e?"":fb.core.util.sha1(e)}return this.lazyHash_},fb.core.snap.ChildrenNode.prototype.getPredecessorChildName=function(e,t,o){var r=this.resolveIndex_(o);if(r){var n=r.getPredecessorKey(new fb.core.snap.NamedNode(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)},fb.core.snap.ChildrenNode.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var o=t.minKey();return o&&o.name}return this.children_.minKey()},fb.core.snap.ChildrenNode.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new fb.core.snap.NamedNode(t,this.children_.get(t)):null},fb.core.snap.ChildrenNode.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var o=t.maxKey();return o&&o.name}return this.children_.maxKey()},fb.core.snap.ChildrenNode.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new fb.core.snap.NamedNode(t,this.children_.get(t)):null},fb.core.snap.ChildrenNode.prototype.forEachChild=function(e,t){var o=this.resolveIndex_(e);return o?o.inorderTraversal(function(e){return t(e.name,e.node)}):this.children_.inorderTraversal(t)},fb.core.snap.ChildrenNode.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},fb.core.snap.ChildrenNode.prototype.getIteratorFrom=function(e,t){var o=this.resolveIndex_(t);if(o)return o.getIteratorFrom(e,function(e){return e});for(var r=this.children_.getIteratorFrom(e.name,fb.core.snap.NamedNode.Wrap),n=r.peek();null!=n&&t.compare(n,e)<0;)r.getNext(),n=r.peek();return r},fb.core.snap.ChildrenNode.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},fb.core.snap.ChildrenNode.prototype.getReverseIteratorFrom=function(e,t){var o=this.resolveIndex_(t);if(o)return o.getReverseIteratorFrom(e,function(e){return e});for(var r=this.children_.getReverseIteratorFrom(e.name,fb.core.snap.NamedNode.Wrap),n=r.peek();null!=n&&t.compare(n,e)>0;)r.getNext(),n=r.peek();return r},fb.core.snap.ChildrenNode.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===fb.core.snap.MAX_NODE?-1:0},fb.core.snap.ChildrenNode.prototype.withIndex=function(e){if(e===fb.core.snap.KeyIndex||this.indexMap_.hasIndex(e))return this;var t=this.indexMap_.addIndex(e,this.children_);return new fb.core.snap.ChildrenNode(this.children_,this.priorityNode_,t)},fb.core.snap.ChildrenNode.prototype.isIndexed=function(e){return e===fb.core.snap.KeyIndex||this.indexMap_.hasIndex(e)},fb.core.snap.ChildrenNode.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var o=this.getIterator(fb.core.snap.PriorityIndex),r=t.getIterator(fb.core.snap.PriorityIndex),n=o.getNext(),i=r.getNext();n&&i;){if(n.name!==i.name||!n.node.equals(i.node))return!1;n=o.getNext(),i=r.getNext()}return null===n&&null===i}return!1}return!1},fb.core.snap.ChildrenNode.prototype.resolveIndex_=function(e){return e===fb.core.snap.KeyIndex?null:this.indexMap_.get(e.toString())},goog.DEBUG&&(fb.core.snap.ChildrenNode.prototype.toString=function(){return fb.util.json.stringify(this.val(!0))}),goog.provide("fb.core.snap"),goog.require("fb.core.snap.ChildrenNode"),goog.require("fb.core.snap.IndexMap"),goog.require("fb.core.snap.LeafNode"),goog.require("fb.core.util");var USE_HINZE=!0;fb.core.snap.NodeFromJSON=function(e,t){if(null===e)return fb.core.snap.EMPTY_NODE;var o=null;if("object"==typeof e&&".priority"in e?o=e[".priority"]:"undefined"!=typeof t&&(o=t),fb.core.util.assert(null===o||"string"==typeof o||"number"==typeof o||"object"==typeof o&&".sv"in o,"Invalid priority type found: "+typeof o),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e){var r=e;return new fb.core.snap.LeafNode(r,fb.core.snap.NodeFromJSON(o))}if(e instanceof Array||!USE_HINZE){var n=fb.core.snap.EMPTY_NODE,i=e;return goog.object.forEach(i,function(e,t){if(fb.util.obj.contains(i,t)&&"."!==t.substring(0,1)){var o=fb.core.snap.NodeFromJSON(e);!o.isLeafNode()&&o.isEmpty()||(n=n.updateImmediateChild(t,o))}}),n.updatePriority(fb.core.snap.NodeFromJSON(o))}var a=[],s=!1,l=e;if(fb.util.obj.foreach(l,function(e,t){if("string"!=typeof e||"."!==e.substring(0,1)){var o=fb.core.snap.NodeFromJSON(l[e]);o.isEmpty()||(s=s||!o.getPriority().isEmpty(),a.push(new fb.core.snap.NamedNode(e,o)))}}),0==a.length)return fb.core.snap.EMPTY_NODE;var g=fb.core.snap.buildChildSet(a,fb.core.snap.NAME_ONLY_COMPARATOR,function(e){return e.name},fb.core.snap.NAME_COMPARATOR);if(s){var u=fb.core.snap.buildChildSet(a,fb.core.snap.PriorityIndex.getCompare());return new fb.core.snap.ChildrenNode(g,fb.core.snap.NodeFromJSON(o),new fb.core.snap.IndexMap({".priority":u},{".priority":fb.core.snap.PriorityIndex}))}return new fb.core.snap.ChildrenNode(g,fb.core.snap.NodeFromJSON(o),fb.core.snap.IndexMap.Default)};var LOG_2=Math.log(2);fb.core.snap.Base12Num=function(e){var t=function(e){return parseInt(Math.log(e)/LOG_2,10)},o=function(e){return parseInt(Array(e+1).join("1"),2)};this.count=t(e+1),this.current_=this.count-1;var r=o(this.count);this.bits_=e+1&r},fb.core.snap.Base12Num.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},fb.core.snap.buildChildSet=function(e,t,o,r){e.sort(t);var n=function(t,r){var i=r-t;if(0==i)return null;if(1==i){var a=e[t],s=o?o(a):a;return new fb.LLRBNode(s,a.node,fb.LLRBNode.BLACK,null,null)}var l=parseInt(i/2,10)+t,g=n(t,l),u=n(l+1,r);return a=e[l],s=o?o(a):a,new fb.LLRBNode(s,a.node,fb.LLRBNode.BLACK,g,u)},i=function(t){for(var r=null,i=null,a=e.length,s=function(t,r){var i=a-t,s=a;a-=t;var g=n(i+1,s),u=e[i],c=o?o(u):u;l(new fb.LLRBNode(c,u.node,r,null,g))},l=function(e){r?(r.left=e,r=e):(i=e,r=e)},g=0;g<t.count;++g){var u=t.nextBitIsOne(),c=Math.pow(2,t.count-(g+1));u?s(c,fb.LLRBNode.BLACK):(s(c,fb.LLRBNode.BLACK),s(c,fb.LLRBNode.RED))}return i},a=new fb.core.snap.Base12Num(e.length),s=i(a);return null!==s?new fb.core.util.SortedMap(r||t,s):new fb.core.util.SortedMap(r||t)},fb.core.snap.priorityHashText=function(e){return"number"==typeof e?"number:"+fb.core.util.doubleToIEEE754String(e):"string:"+e},fb.core.snap.validatePriorityNode=function(e){if(e.isLeafNode()){var t=e.val();fb.core.util.assert("string"==typeof t||"number"==typeof t||"object"==typeof t&&fb.util.obj.contains(t,".sv"),"Priority must be a string or number.")}else fb.core.util.assert(e===fb.core.snap.MAX_NODE||e.isEmpty(),"priority of unexpected type.");fb.core.util.assert(e===fb.core.snap.MAX_NODE||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},fb.core.snap.EMPTY_NODE=new fb.core.snap.ChildrenNode(new fb.core.util.SortedMap(fb.core.snap.NAME_COMPARATOR),null,fb.core.snap.IndexMap.Default),fb.core.snap.MAX_NODE_=function(){fb.core.snap.ChildrenNode.call(this,new fb.core.util.SortedMap(fb.core.snap.NAME_COMPARATOR),fb.core.snap.EMPTY_NODE,fb.core.snap.IndexMap.Default)},goog.inherits(fb.core.snap.MAX_NODE_,fb.core.snap.ChildrenNode),fb.core.snap.MAX_NODE_.prototype.compareTo=function(e){return e===this?0:1},fb.core.snap.MAX_NODE_.prototype.equals=function(e){return e===this},fb.core.snap.MAX_NODE_.prototype.getPriority=function(){return this},fb.core.snap.MAX_NODE_.prototype.getImmediateChild=function(e){return fb.core.snap.EMPTY_NODE},fb.core.snap.MAX_NODE_.prototype.isEmpty=function(){return!1},fb.core.snap.MAX_NODE=new fb.core.snap.MAX_NODE_,fb.core.snap.NamedNode.MIN=new fb.core.snap.NamedNode(fb.core.util.MIN_NAME,fb.core.snap.EMPTY_NODE),fb.core.snap.NamedNode.MAX=new fb.core.snap.NamedNode(fb.core.util.MAX_NAME,fb.core.snap.MAX_NODE),goog.provide("fb.core.view.ViewCache"),goog.require("fb.core.view.CacheNode"),goog.require("fb.core.snap"),fb.core.view.ViewCache=function(e,t){this.eventCache_=e,this.serverCache_=t},fb.core.view.ViewCache.Empty=new fb.core.view.ViewCache(new fb.core.view.CacheNode(fb.core.snap.EMPTY_NODE,(!1),(!1)),new fb.core.view.CacheNode(fb.core.snap.EMPTY_NODE,(!1),(!1))),fb.core.view.ViewCache.prototype.updateEventSnap=function(e,t,o){return new fb.core.view.ViewCache(new fb.core.view.CacheNode(e,t,o),this.serverCache_)},fb.core.view.ViewCache.prototype.updateServerSnap=function(e,t,o){return new fb.core.view.ViewCache(this.eventCache_,new fb.core.view.CacheNode(e,t,o))},fb.core.view.ViewCache.prototype.getEventCache=function(){return this.eventCache_},fb.core.view.ViewCache.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},fb.core.view.ViewCache.prototype.getServerCache=function(){return this.serverCache_},fb.core.view.ViewCache.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},goog.provide("fb.core.view.View"),goog.require("fb.core.view.EventGenerator"),goog.require("fb.core.view.ViewCache"),goog.require("fb.core.view.ViewProcessor"),goog.require("fb.core.util"),fb.core.view.View=function(e,t){this.query_=e;var o=e.getQueryParams(),r=new fb.core.view.filter.IndexedFilter(o.getIndex()),n=o.getNodeFilter();this.processor_=new fb.core.view.ViewProcessor(n);var i=t.getServerCache(),a=t.getEventCache(),s=r.updateFullNode(fb.core.snap.EMPTY_NODE,i.getNode(),null),l=n.updateFullNode(fb.core.snap.EMPTY_NODE,a.getNode(),null),g=new fb.core.view.CacheNode(s,i.isFullyInitialized(),r.filtersNodes()),u=new fb.core.view.CacheNode(l,a.isFullyInitialized(),n.filtersNodes());this.viewCache_=new fb.core.view.ViewCache(u,g),this.eventRegistrations_=[],this.eventGenerator_=new fb.core.view.EventGenerator(e)},fb.core.view.View.prototype.getQuery=function(){return this.query_},fb.core.view.View.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},fb.core.view.View.prototype.getCompleteServerCache=function(e){var t=this.viewCache_.getCompleteServerSnap();return t&&(this.query_.getQueryParams().loadsAllData()||!e.isEmpty()&&!t.getImmediateChild(e.getFront()).isEmpty())?t.getChild(e):null},fb.core.view.View.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},fb.core.view.View.prototype.addEventRegistration=function(e){this.eventRegistrations_.push(e)},fb.core.view.View.prototype.removeEventRegistration=function(e,t){var o=[];if(t){fb.core.util.assert(null==e,"A cancel should cancel all event registrations.");var r=this.query_.path;goog.array.forEach(this.eventRegistrations_,function(e){t=t;var n=e.createCancelEvent(t,r);n&&o.push(n)})}if(e){for(var n=[],i=0;i<this.eventRegistrations_.length;++i){var a=this.eventRegistrations_[i];if(a.matches(e)){if(e.hasAnyCallback()){n=n.concat(this.eventRegistrations_.slice(i+1));break}}else n.push(a)}this.eventRegistrations_=n}else this.eventRegistrations_=[];return o},fb.core.view.View.prototype.applyOperation=function(e,t,o){e.type===fb.core.OperationType.MERGE&&null!==e.source.queryId&&(fb.core.util.assert(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),fb.core.util.assert(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,n=this.processor_.applyOperation(r,e,t,o);return this.processor_.assertIndexed(n.viewCache),fb.core.util.assert(n.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=n.viewCache,this.generateEventsForChanges_(n.changes,n.viewCache.getEventCache().getNode(),null)},fb.core.view.View.prototype.getInitialEvents=function(e){var t=this.viewCache_.getEventCache(),o=[];if(!t.getNode().isLeafNode()){var r=t.getNode();r.forEachChild(fb.core.snap.PriorityIndex,function(e,t){o.push(fb.core.view.Change.childAddedChange(e,t))})}return t.isFullyInitialized()&&o.push(fb.core.view.Change.valueChange(t.getNode())),this.generateEventsForChanges_(o,t.getNode(),e)},fb.core.view.View.prototype.generateEventsForChanges_=function(e,t,o){var r=o?[o]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(e,t,r)},goog.provide("fb.core.operation.Merge"),goog.require("fb.core.util"),fb.core.operation.Merge=function(e,t,o){this.type=fb.core.OperationType.MERGE,this.source=e,this.path=t,this.children=o},fb.core.operation.Merge.prototype.operationForChild=function(e){if(this.path.isEmpty()){var t=this.children.subtree(new fb.core.util.Path(e));return t.isEmpty()?null:t.value?new fb.core.operation.Overwrite(this.source,fb.core.util.Path.Empty,t.value):new fb.core.operation.Merge(this.source,fb.core.util.Path.Empty,t)}return fb.core.util.assert(this.path.getFront()===e,"Can't get a merge for a child not on the path of the operation"),new fb.core.operation.Merge(this.source,this.path.popFront(),this.children)},goog.DEBUG&&(fb.core.operation.Merge.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}),goog.provide("fb.core.ReadonlyRestClient"),goog.require("fb.core.util"),goog.require("fb.util"),goog.require("fb.util.json"),goog.require("fb.util.jwt"),goog.require("fb.util.obj"),fb.core.ReadonlyRestClient=goog.defineClass(null,{constructor:function(e,t){this.log_=fb.core.util.logWrapper("p:rest:"),this.repoInfo_=e,this.onDataUpdate_=t,this.credential_=null,this.listens_={}},listen:function(e,t,o,r){var n=e.path.toString();this.log_("Listen called for "+n+" "+e.queryIdentifier());var i=fb.core.ReadonlyRestClient.getListenId_(e,o),a=new Object;this.listens_[i]=a;var s=e.getQueryParams().toRestQueryStringParameters(),l=this;this.restRequest_(n+".json",s,function(e,t){var s=t;if(404===e&&(s=null,e=null),null===e&&l.onDataUpdate_(n,s,!1,o),fb.util.obj.get(l.listens_,i)===a){var g;g=e?401==e?"permission_denied":"rest_error:"+e:"ok",r(g,null)}})},unlisten:function(e,t){var o=fb.core.ReadonlyRestClient.getListenId_(e,t);delete this.listens_[o]},auth:function(e,t,o){this.credential_=e;var r=fb.util.jwt.decode(e),n=r.data,i=r.claims&&r.claims.exp;t&&t("ok",{auth:n,expires:i})},unauth:function(e){this.credential_=null,e("ok",null)},onDisconnectPut:function(e,t,o){},onDisconnectMerge:function(e,t,o){},onDisconnectCancel:function(e,t){},put:function(e,t,o,r){},merge:function(e,t,o,r){},reportStats:function(e){},restRequest_:function(e,t,o){t=t||{},t.format="export",this.credential_&&(t.auth=this.credential_);var r=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?"+fb.util.querystring(t);this.log_("Sending REST request for "+r);var n=new XMLHttpRequest,i=this;n.onreadystatechange=function(){if(o&&4===n.readyState){i.log_("REST Response for "+r+" received. status:",n.status,"response:",n.responseText);var e=null;if(n.status>=200&&n.status<300){try{e=fb.util.json.eval(n.responseText)}catch(e){fb.core.util.warn("Failed to parse JSON response for "+r+": "+n.responseText)}o(null,e)}else 401!==n.status&&404!==n.status&&fb.core.util.warn("Got unsuccessful REST response for "+r+" Status: "+n.status),o(n.status);o=null}},n.open("GET",r,!0),n.send()},statics:{getListenId_:function(e,t){return goog.isDef(t)?"tag$"+t:(fb.core.util.assert(e.getQueryParams().isDefault(),"should have a tag if it's not a default query."),e.path.toString())}}}),goog.provide("fb.core.util.EventEmitter"),goog.require("fb.core.util"),goog.require("goog.array"),fb.core.util.EventEmitter=goog.defineClass(null,{constructor:function(e){fb.core.util.assert(goog.isArray(e)&&e.length>0,"Requires a non-empty array"),this.allowedEvents_=e,this.listeners_={}},getInitialEvent:goog.abstractMethod,trigger:function(e,t){for(var o=goog.array.clone(this.listeners_[e]||[]),r=0;r<o.length;r++)o[r].callback.apply(o[r].context,Array.prototype.slice.call(arguments,1))},on:function(e,t,o){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:o});var r=this.getInitialEvent(e);r&&t.apply(o,r)},off:function(e,t,o){this.validateEventType_(e);for(var r=this.listeners_[e]||[],n=0;n<r.length;n++)if(r[n].callback===t&&(!o||o===r[n].context))return void r.splice(n,1)},validateEventType_:function(e){fb.core.util.assert(goog.array.find(this.allowedEvents_,function(t){return t===e}),"Unknown event: "+e)}}),goog.provide("fb.core.util.nextPushId"),goog.require("fb.core.util"),fb.core.util.nextPushId=function(){var e="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",t=0,o=[];return function(r){var n=r===t;t=r;for(var i=new Array(8),a=7;a>=0;a--)i[a]=e.charAt(r%64),r=Math.floor(r/64);fb.core.util.assert(0===r,"Cannot push at time == 0");var s=i.join("");if(n){for(a=11;a>=0&&63===o[a];a--)o[a]=0;o[a]++}else for(a=0;a<12;a++)o[a]=Math.floor(64*Math.random());for(a=0;a<12;a++)s+=e.charAt(o[a]);return fb.core.util.assert(20===s.length,"nextPushId: Length should be 20."),s}}(),goog.provide("fb.core.util.OnlineMonitor"),goog.require("fb.core.util"),goog.require("fb.core.util.EventEmitter"),fb.core.util.OnlineMonitor=goog.defineClass(fb.core.util.EventEmitter,{constructor:function(){if(fb.core.util.EventEmitter.call(this,["online"]),this.online_=!0,"undefined"!=typeof window&&"undefined"!=typeof window.addEventListener){var e=this;window.addEventListener("online",function(){e.online_||(e.online_=!0,e.trigger("online",!0))},!1),window.addEventListener("offline",function(){e.online_&&(e.online_=!1,e.trigger("online",!1))},!1)}},getInitialEvent:function(e){return fb.core.util.assert("online"===e,"Unknown event type: "+e),[this.online_]},currentlyOnline:function(){return this.online_}}),goog.addSingletonGetter(fb.core.util.OnlineMonitor),goog.provide("fb.core.util.VisibilityMonitor"),goog.require("fb.core.util"),goog.require("fb.core.util.EventEmitter"),fb.core.util.VisibilityMonitor=goog.defineClass(fb.core.util.EventEmitter,{constructor:function(){fb.core.util.EventEmitter.call(this,["visible"]);var e,t;if("undefined"!=typeof document&&"undefined"!=typeof document.addEventListener&&("undefined"!=typeof document.hidden?(t="visibilitychange",e="hidden"):"undefined"!=typeof document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):"undefined"!=typeof document.msHidden?(t="msvisibilitychange",e="msHidden"):"undefined"!=typeof document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t){var o=this;document.addEventListener(t,function(){var t=!document[e];t!==o.visible_&&(o.visible_=t,o.trigger("visible",t))},!1)}},getInitialEvent:function(e){return fb.core.util.assert("visible"===e,"Unknown event type: "+e),[this.visible_]}}),goog.addSingletonGetter(fb.core.util.VisibilityMonitor),goog.provide("fb.core.util.Path"),goog.provide("fb.core.util.ValidationPath"),goog.require("fb.core.util"),goog.require("fb.util.utf8"),goog.require("goog.string"),fb.core.util.Path=goog.defineClass(null,{constructor:function(e,t){if(1==arguments.length){this.pieces_=e.split("/");for(var o=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[o]=this.pieces_[r],o++);this.pieces_.length=o,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t},getFront:function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},getLength:function(){return this.pieces_.length-this.pieceNum_},popFront:function(){var e=this.pieceNum_;return e<this.pieces_.length&&e++,new fb.core.util.Path(this.pieces_,e)},getBack:function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},toString:function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},toUrlEncodedString:function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+goog.string.urlEncode(this.pieces_[t]));return e||"/"},slice:function(e){var t=e||0;return this.pieces_.slice(this.pieceNum_+t)},parent:function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var e=[],t=this.pieceNum_;t<this.pieces_.length-1;t++)e.push(this.pieces_[t]);return new fb.core.util.Path(e,0)},child:function(e){for(var t=[],o=this.pieceNum_;o<this.pieces_.length;o++)t.push(this.pieces_[o]);if(e instanceof fb.core.util.Path)for(o=e.pieceNum_;o<e.pieces_.length;o++)t.push(e.pieces_[o]);else{var r=e.split("/");for(o=0;o<r.length;o++)r[o].length>0&&t.push(r[o])}return new fb.core.util.Path(t,0)},isEmpty:function(){return this.pieceNum_>=this.pieces_.length},statics:{relativePath:function(e,t){var o=e.getFront(),r=t.getFront();if(null===o)return t;if(o===r)return fb.core.util.Path.relativePath(e.popFront(),t.popFront());throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")},comparePaths:function(e,t){for(var o=e.slice(),r=t.slice(),n=0;n<o.length&&n<r.length;n++){var i=fb.core.util.nameCompare(o[n],r[n]);if(0!==i)return i}return o.length===r.length?0:o.length<r.length?-1:1}},equals:function(e){if(this.getLength()!==e.getLength())return!1;for(var t=this.pieceNum_,o=e.pieceNum_;t<=this.pieces_.length;t++,o++)if(this.pieces_[t]!==e.pieces_[o])return!1;return!0},contains:function(e){var t=this.pieceNum_,o=e.pieceNum_;if(this.getLength()>e.getLength())return!1;for(;t<this.pieces_.length;){if(this.pieces_[t]!==e.pieces_[o])return!1;++t,++o}return!0}}),fb.core.util.Path.Empty=new fb.core.util.Path(""),fb.core.util.ValidationPath=goog.defineClass(null,{constructor:function(e,t){this.parts_=e.slice(),this.byteLength_=Math.max(1,this.parts_.length),this.errorPrefix_=t;for(var o=0;o<this.parts_.length;o++)this.byteLength_+=fb.util.utf8.stringLength(this.parts_[o]);this.checkValid_()},statics:{MAX_PATH_DEPTH:32,MAX_PATH_LENGTH_BYTES:768},push:function(e){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(e),this.byteLength_+=fb.util.utf8.stringLength(e),this.checkValid_()},pop:function(){var e=this.parts_.pop();this.byteLength_-=fb.util.utf8.stringLength(e),this.parts_.length>0&&(this.byteLength_-=1)},checkValid_:function(){if(this.byteLength_>fb.core.util.ValidationPath.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+fb.core.util.ValidationPath.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>fb.core.util.ValidationPath.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+fb.core.util.ValidationPath.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},toErrorString:function(){return 0==this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"}}),goog.provide("fb.core.util.ImmutableTree"),goog.require("fb.core.util"),goog.require("fb.core.util.Path"),goog.require("fb.core.util.SortedMap"),goog.require("fb.util.json"),goog.require("fb.util.obj"),goog.require("goog.object"),fb.core.util.ImmutableTree=goog.defineClass(null,{constructor:function(e,t){this.value=e,this.children=t||fb.core.util.ImmutableTree.EmptyChildren_},statics:{EmptyChildren_:new fb.core.util.SortedMap(fb.core.util.stringCompare),fromObject:function(e){var t=fb.core.util.ImmutableTree.Empty;return goog.object.forEach(e,function(e,o){t=t.set(new fb.core.util.Path(o),e)}),t}},isEmpty:function(){return null===this.value&&this.children.isEmpty()},findRootMostMatchingPathAndValue:function(e,t){if(null!=this.value&&t(this.value))return{path:fb.core.util.Path.Empty,value:this.value};if(e.isEmpty())return null;var o=e.getFront(),r=this.children.get(o);if(null!==r){var n=r.findRootMostMatchingPathAndValue(e.popFront(),t);if(null!=n){var i=new fb.core.util.Path(o).child(n.path);return{path:i,value:n.value}}return null}return null},findRootMostValueAndPath:function(e){return this.findRootMostMatchingPathAndValue(e,function(){return!0})},subtree:function(e){if(e.isEmpty())return this;var t=e.getFront(),o=this.children.get(t);return null!==o?o.subtree(e.popFront()):fb.core.util.ImmutableTree.Empty},set:function(e,t){if(e.isEmpty())return new fb.core.util.ImmutableTree(t,this.children);var o=e.getFront(),r=this.children.get(o)||fb.core.util.ImmutableTree.Empty,n=r.set(e.popFront(),t),i=this.children.insert(o,n);return new fb.core.util.ImmutableTree(this.value,i)},remove:function(e){if(e.isEmpty())return this.children.isEmpty()?fb.core.util.ImmutableTree.Empty:new fb.core.util.ImmutableTree(null,this.children);var t=e.getFront(),o=this.children.get(t);if(o){var r,n=o.remove(e.popFront());return r=n.isEmpty()?this.children.remove(t):this.children.insert(t,n),null===this.value&&r.isEmpty()?fb.core.util.ImmutableTree.Empty:new fb.core.util.ImmutableTree(this.value,r)}return this},get:function(e){if(e.isEmpty())return this.value;var t=e.getFront(),o=this.children.get(t);return o?o.get(e.popFront()):null},setTree:function(e,t){if(e.isEmpty())return t;var o,r=e.getFront(),n=this.children.get(r)||fb.core.util.ImmutableTree.Empty,i=n.setTree(e.popFront(),t);return o=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new fb.core.util.ImmutableTree(this.value,o)},fold:function(e){return this.fold_(fb.core.util.Path.Empty,e)},fold_:function(e,t){var o={};return this.children.inorderTraversal(function(r,n){o[r]=n.fold_(e.child(r),t)}),t(e,this.value,o)},findOnPath:function(e,t){return this.findOnPath_(e,fb.core.util.Path.Empty,t)},findOnPath_:function(e,t,o){var r=!!this.value&&o(t,this.value);if(r)return r;if(e.isEmpty())return null;var n=e.getFront(),i=this.children.get(n);return i?i.findOnPath_(e.popFront(),t.child(n),o):null},foreachOnPath:function(e,t){return this.foreachOnPath_(e,fb.core.util.Path.Empty,t)},foreachOnPath_:function(e,t,o){if(e.isEmpty())return this;this.value&&o(t,this.value);var r=e.getFront(),n=this.children.get(r);return n?n.foreachOnPath_(e.popFront(),t.child(r),o):fb.core.util.ImmutableTree.Empty},foreach:function(e){this.foreach_(fb.core.util.Path.Empty,e)},foreach_:function(e,t){this.children.inorderTraversal(function(o,r){r.foreach_(e.child(o),t)}),this.value&&t(e,this.value)},foreachChild:function(e){this.children.inorderTraversal(function(t,o){o.value&&e(t,o.value)})}}),fb.core.util.ImmutableTree.Empty=new fb.core.util.ImmutableTree(null),goog.DEBUG&&(fb.core.util.ImmutableTree.prototype.toString=function(){var e={};return this.foreach(function(t,o){var r=t.toString();e[r]=o.toString()}),fb.util.json.stringify(e)}),goog.provide("fb.core.operation.AckUserWrite"),goog.require("fb.core.util.ImmutableTree"),fb.core.operation.AckUserWrite=function(e,t,o){this.type=fb.core.OperationType.ACK_USER_WRITE,this.source=fb.core.OperationSource.User,this.path=e,this.affectedTree=t,this.revert=o},fb.core.operation.AckUserWrite.prototype.operationForChild=function(e){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return fb.core.util.assert(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var t=this.affectedTree.subtree(new fb.core.util.Path(e));return new fb.core.operation.AckUserWrite(fb.core.util.Path.Empty,t,this.revert)}return fb.core.util.assert(this.path.getFront()===e,"operationForChild called for unrelated child."),new fb.core.operation.AckUserWrite(this.path.popFront(),this.affectedTree,this.revert)},goog.DEBUG&&(fb.core.operation.AckUserWrite.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" ack write revert="+this.revert+" affectedTree="+this.affectedTree+")"}),goog.provide("fb.core.Operation"),goog.require("fb.core.operation.AckUserWrite"),goog.require("fb.core.operation.Merge"),goog.require("fb.core.operation.Overwrite"),
goog.require("fb.core.operation.ListenComplete"),goog.require("fb.core.util"),fb.core.OperationType={OVERWRITE:0,MERGE:1,ACK_USER_WRITE:2,LISTEN_COMPLETE:3},fb.core.Operation=function(){},fb.core.Operation.prototype.source,fb.core.Operation.prototype.type,fb.core.Operation.prototype.path,fb.core.Operation.prototype.operationForChild=goog.abstractMethod,fb.core.OperationSource=function(e,t,o,r){this.fromUser=e,this.fromServer=t,this.queryId=o,this.tagged=r,fb.core.util.assert(!r||t,"Tagged queries must be from server.")},fb.core.OperationSource.User=new fb.core.OperationSource((!0),(!1),null,(!1)),fb.core.OperationSource.Server=new fb.core.OperationSource((!1),(!0),null,(!1)),fb.core.OperationSource.forServerTaggedQuery=function(e){return new fb.core.OperationSource((!1),(!0),e,(!0))},goog.DEBUG&&(fb.core.OperationSource.prototype.toString=function(){return this.fromUser?"user":this.tagged?"server(queryID="+this.queryId+")":"server"}),goog.provide("fb.core.CompoundWrite"),goog.require("fb.core.snap.Node"),goog.require("fb.core.util"),goog.require("fb.core.util.ImmutableTree"),fb.core.CompoundWrite=function(e){this.writeTree_=e},fb.core.CompoundWrite.Empty=new fb.core.CompoundWrite(new fb.core.util.ImmutableTree(null)),fb.core.CompoundWrite.prototype.addWrite=function(e,t){if(e.isEmpty())return new fb.core.CompoundWrite(new fb.core.util.ImmutableTree(t));var o=this.writeTree_.findRootMostValueAndPath(e);if(null!=o){var r=o.path,n=o.value,i=fb.core.util.Path.relativePath(r,e);return n=n.updateChild(i,t),new fb.core.CompoundWrite(this.writeTree_.set(r,n))}var a=new fb.core.util.ImmutableTree(t),s=this.writeTree_.setTree(e,a);return new fb.core.CompoundWrite(s)},fb.core.CompoundWrite.prototype.addWrites=function(e,t){var o=this;return fb.util.obj.foreach(t,function(t,r){o=o.addWrite(e.child(t),r)}),o},fb.core.CompoundWrite.prototype.removeWrite=function(e){if(e.isEmpty())return fb.core.CompoundWrite.Empty;var t=this.writeTree_.setTree(e,fb.core.util.ImmutableTree.Empty);return new fb.core.CompoundWrite(t)},fb.core.CompoundWrite.prototype.hasCompleteWrite=function(e){return null!=this.getCompleteNode(e)},fb.core.CompoundWrite.prototype.getCompleteNode=function(e){var t=this.writeTree_.findRootMostValueAndPath(e);return null!=t?this.writeTree_.get(t.path).getChild(fb.core.util.Path.relativePath(t.path,e)):null},fb.core.CompoundWrite.prototype.getCompleteChildren=function(){var e=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||(t=t,t.forEachChild(fb.core.snap.PriorityIndex,function(t,o){e.push(new fb.core.snap.NamedNode(t,o))})):this.writeTree_.children.inorderTraversal(function(t,o){null!=o.value&&e.push(new fb.core.snap.NamedNode(t,o.value))}),e},fb.core.CompoundWrite.prototype.childCompoundWrite=function(e){if(e.isEmpty())return this;var t=this.getCompleteNode(e);return null!=t?new fb.core.CompoundWrite(new fb.core.util.ImmutableTree(t)):new fb.core.CompoundWrite(this.writeTree_.subtree(e))},fb.core.CompoundWrite.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},fb.core.CompoundWrite.prototype.apply=function(e){return fb.core.CompoundWrite.applySubtreeWrite_(fb.core.util.Path.Empty,this.writeTree_,e)},fb.core.CompoundWrite.applySubtreeWrite_=function(e,t,o){if(null!=t.value)return o.updateChild(e,t.value);var r=null;return t.children.inorderTraversal(function(t,n){".priority"===t?(fb.core.util.assert(null!==n.value,"Priority writes must always be leaf nodes"),r=n.value):o=fb.core.CompoundWrite.applySubtreeWrite_(e.child(t),n,o)}),o.getChild(e).isEmpty()||null===r||(o=o.updateChild(e.child(".priority"),r)),o},goog.provide("fb.core.WriteTree"),goog.require("fb.core.CompoundWrite"),goog.require("fb.core.util"),goog.require("fb.core.view.CacheNode"),fb.core.WriteRecord,fb.core.WriteTree=function(){this.visibleWrites_=fb.core.CompoundWrite.Empty,this.allWrites_=[],this.lastWriteId_=-1},fb.core.WriteTree.prototype.childWrites=function(e){return new fb.core.WriteTreeRef(e,this)},fb.core.WriteTree.prototype.addOverwrite=function(e,t,o,r){fb.core.util.assert(o>this.lastWriteId_,"Stacking an older write on top of newer ones"),goog.isDef(r)||(r=!0),this.allWrites_.push({path:e,snap:t,writeId:o,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(e,t)),this.lastWriteId_=o},fb.core.WriteTree.prototype.addMerge=function(e,t,o){fb.core.util.assert(o>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:e,children:t,writeId:o,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(e,t),this.lastWriteId_=o},fb.core.WriteTree.prototype.getWrite=function(e){for(var t=0;t<this.allWrites_.length;t++){var o=this.allWrites_[t];if(o.writeId===e)return o}return null},fb.core.WriteTree.prototype.removeWrite=function(e){var t=goog.array.findIndex(this.allWrites_,function(t){return t.writeId===e});fb.core.util.assert(t>=0,"removeWrite called with nonexistent writeId.");var o=this.allWrites_[t];this.allWrites_.splice(t,1);for(var r=o.visible,n=!1,i=this.allWrites_.length-1;r&&i>=0;){var a=this.allWrites_[i];a.visible&&(i>=t&&this.recordContainsPath_(a,o.path)?r=!1:o.path.contains(a.path)&&(n=!0)),i--}if(r){if(n)return this.resetTree_(),!0;if(o.snap)this.visibleWrites_=this.visibleWrites_.removeWrite(o.path);else{var s=o.children,l=this;goog.object.forEach(s,function(e,t){l.visibleWrites_=l.visibleWrites_.removeWrite(o.path.child(t))})}return!0}return!1},fb.core.WriteTree.prototype.getCompleteWriteData=function(e){return this.visibleWrites_.getCompleteNode(e)},fb.core.WriteTree.prototype.calcCompleteEventCache=function(e,t,o,r){if(o||r){var n=this.visibleWrites_.childCompoundWrite(e);if(!r&&n.isEmpty())return t;if(r||null!=t||n.hasCompleteWrite(fb.core.util.Path.Empty)){var i=function(t){return(t.visible||r)&&(!o||!goog.array.contains(o,t.writeId))&&(t.path.contains(e)||e.contains(t.path))},a=fb.core.WriteTree.layerTree_(this.allWrites_,i,e);return g=t||fb.core.snap.EMPTY_NODE,a.apply(g)}return null}var s=this.visibleWrites_.getCompleteNode(e);if(null!=s)return s;var l=this.visibleWrites_.childCompoundWrite(e);if(l.isEmpty())return t;if(null!=t||l.hasCompleteWrite(fb.core.util.Path.Empty)){var g=t||fb.core.snap.EMPTY_NODE;return l.apply(g)}return null},fb.core.WriteTree.prototype.calcCompleteEventChildren=function(e,t){var o=fb.core.snap.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(e);if(r)return r.isLeafNode()||r.forEachChild(fb.core.snap.PriorityIndex,function(e,t){o=o.updateImmediateChild(e,t)}),o;if(t){var n=this.visibleWrites_.childCompoundWrite(e);return t.forEachChild(fb.core.snap.PriorityIndex,function(e,t){var r=n.childCompoundWrite(new fb.core.util.Path(e)).apply(t);o=o.updateImmediateChild(e,r)}),goog.array.forEach(n.getCompleteChildren(),function(e){o=o.updateImmediateChild(e.name,e.node)}),o}return n=this.visibleWrites_.childCompoundWrite(e),goog.array.forEach(n.getCompleteChildren(),function(e){o=o.updateImmediateChild(e.name,e.node)}),o},fb.core.WriteTree.prototype.calcEventCacheAfterServerOverwrite=function(e,t,o,r){fb.core.util.assert(o||r,"Either existingEventSnap or existingServerSnap must exist");var n=e.child(t);if(this.visibleWrites_.hasCompleteWrite(n))return null;var i=this.visibleWrites_.childCompoundWrite(n);return i.isEmpty()?r.getChild(t):i.apply(r.getChild(t))},fb.core.WriteTree.prototype.calcCompleteChild=function(e,t,o){var r=e.child(t),n=this.visibleWrites_.getCompleteNode(r);if(null!=n)return n;if(o.isCompleteForChild(t)){var i=this.visibleWrites_.childCompoundWrite(r);return i.apply(o.getNode().getImmediateChild(t))}return null},fb.core.WriteTree.prototype.shadowingWrite=function(e){return this.visibleWrites_.getCompleteNode(e)},fb.core.WriteTree.prototype.calcIndexedSlice=function(e,t,o,r,n,i){var a,s=this.visibleWrites_.childCompoundWrite(e),l=s.getCompleteNode(fb.core.util.Path.Empty);if(null!=l)a=l;else{if(null==t)return[];a=s.apply(t)}if(a=a.withIndex(i),a.isEmpty()||a.isLeafNode())return[];for(var g=[],u=i.getCompare(),c=n?a.getReverseIteratorFrom(o,i):a.getIteratorFrom(o,i),f=c.getNext();f&&g.length<r;)0!==u(f,o)&&g.push(f),f=c.getNext();return g},fb.core.WriteTree.prototype.recordContainsPath_=function(e,t){return e.snap?e.path.contains(t):!!goog.object.findKey(e.children,function(o,r){return e.path.child(r).contains(t)})},fb.core.WriteTree.prototype.resetTree_=function(){this.visibleWrites_=fb.core.WriteTree.layerTree_(this.allWrites_,fb.core.WriteTree.DefaultFilter_,fb.core.util.Path.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},fb.core.WriteTree.DefaultFilter_=function(e){return e.visible},fb.core.WriteTree.layerTree_=function(e,t,o){for(var r=fb.core.CompoundWrite.Empty,n=0;n<e.length;++n){var i=e[n];if(t(i)){var a,s=i.path;if(i.snap)o.contains(s)?(a=fb.core.util.Path.relativePath(o,s),r=r.addWrite(a,i.snap)):s.contains(o)&&(a=fb.core.util.Path.relativePath(s,o),r=r.addWrite(fb.core.util.Path.Empty,i.snap.getChild(a)));else{if(!i.children)throw fb.core.util.assertionError("WriteRecord should have .snap or .children");if(o.contains(s))a=fb.core.util.Path.relativePath(o,s),r=r.addWrites(a,i.children);else if(s.contains(o))if(a=fb.core.util.Path.relativePath(s,o),a.isEmpty())r=r.addWrites(fb.core.util.Path.Empty,i.children);else{var l=fb.util.obj.get(i.children,a.getFront());if(l){var g=l.getChild(a.popFront());r=r.addWrite(fb.core.util.Path.Empty,g)}}}}}return r},fb.core.WriteTreeRef=function(e,t){this.treePath_=e,this.writeTree_=t},fb.core.WriteTreeRef.prototype.calcCompleteEventCache=function(e,t,o){return this.writeTree_.calcCompleteEventCache(this.treePath_,e,t,o)},fb.core.WriteTreeRef.prototype.calcCompleteEventChildren=function(e){return this.writeTree_.calcCompleteEventChildren(this.treePath_,e)},fb.core.WriteTreeRef.prototype.calcEventCacheAfterServerOverwrite=function(e,t,o){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,e,t,o)},fb.core.WriteTreeRef.prototype.shadowingWrite=function(e){return this.writeTree_.shadowingWrite(this.treePath_.child(e))},fb.core.WriteTreeRef.prototype.calcIndexedSlice=function(e,t,o,r,n){return this.writeTree_.calcIndexedSlice(this.treePath_,e,t,o,r,n)},fb.core.WriteTreeRef.prototype.calcCompleteChild=function(e,t){return this.writeTree_.calcCompleteChild(this.treePath_,e,t)},fb.core.WriteTreeRef.prototype.child=function(e){return new fb.core.WriteTreeRef(this.treePath_.child(e),this.writeTree_)},goog.provide("fb.core.util.Tree"),goog.require("fb.core.util"),goog.require("fb.core.util.Path"),goog.require("fb.util.obj"),goog.require("goog.object"),fb.core.util.TreeNode=goog.defineClass(null,{constructor:function(){this.children={},this.childCount=0,this.value=null}}),fb.core.util.Tree=goog.defineClass(null,{constructor:function(e,t,o){this.name_=e?e:"",this.parent_=t?t:null,this.node_=o?o:new fb.core.util.TreeNode},subTree:function(e){for(var t,o=e instanceof fb.core.util.Path?e:new fb.core.util.Path(e),r=this;null!==(t=o.getFront());){var n=fb.util.obj.get(r.node_.children,t)||new fb.core.util.TreeNode;r=new fb.core.util.Tree(t,r,n),o=o.popFront()}return r},getValue:function(){return this.node_.value},setValue:function(e){fb.core.util.assert("undefined"!=typeof e,"Cannot set value to undefined"),this.node_.value=e,this.updateParents_()},clear:function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},hasChildren:function(){return this.node_.childCount>0},isEmpty:function(){return null===this.getValue()&&!this.hasChildren()},forEachChild:function(e){var t=this;goog.object.forEach(this.node_.children,function(o,r){e(new fb.core.util.Tree(r,t,o))})},forEachDescendant:function(e,t,o){t&&!o&&e(this),this.forEachChild(function(t){t.forEachDescendant(e,!0,o)}),t&&o&&e(this)},forEachAncestor:function(e,t){for(var o=t?this:this.parent();null!==o;){if(e(o))return!0;o=o.parent()}return!1},forEachImmediateDescendantWithValue:function(e){this.forEachChild(function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)})},path:function(){return new fb.core.util.Path(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},name:function(){return this.name_},parent:function(){return this.parent_},updateParents_:function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},updateChild_:function(e,t){var o=t.isEmpty(),r=fb.util.obj.contains(this.node_.children,e);o&&r?(delete this.node_.children[e],this.node_.childCount--,this.updateParents_()):o||r||(this.node_.children[e]=t.node_,this.node_.childCount++,this.updateParents_())}}),goog.provide("fb.core.util.validation"),goog.require("fb.core.util"),goog.require("fb.core.util.Path"),goog.require("fb.core.util.ValidationPath"),goog.require("fb.util.obj"),goog.require("fb.util.utf8"),goog.require("fb.util.validation"),fb.core.util.validation={INVALID_KEY_REGEX_:/[\[\].#$\/\u0000-\u001F\u007F]/,INVALID_PATH_REGEX_:/[\[\].#$\u0000-\u001F\u007F]/,VALID_AUTH_PROVIDER:/^[a-zA-Z][a-zA-Z._\-+]+$/,MAX_LEAF_SIZE_:10485760,isValidKey:function(e){return goog.isString(e)&&0!==e.length&&!fb.core.util.validation.INVALID_KEY_REGEX_.test(e)},isValidPathString:function(e){return goog.isString(e)&&0!==e.length&&!fb.core.util.validation.INVALID_PATH_REGEX_.test(e)},isValidRootPathString:function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),fb.core.util.validation.isValidPathString(e)},isValidPriority:function(e){return null===e||goog.isString(e)||goog.isNumber(e)&&!fb.core.util.isInvalidJSONNumber(e)||goog.isObject(e)&&fb.util.obj.contains(e,".sv")},validateFirebaseDataArg:function(e,t,o,r,n){n&&!goog.isDef(o)||fb.core.util.validation.validateFirebaseData(fb.util.validation.errorPrefix(e,t,n),o,r)},validateFirebaseData:function(e,t,o){if(o instanceof fb.core.util.Path&&(o=new fb.core.util.ValidationPath(o,e)),!goog.isDef(t))throw new Error(e+"contains undefined "+o.toErrorString());if(goog.isFunction(t))throw new Error(e+"contains a function "+o.toErrorString()+" with contents: "+t.toString());if(fb.core.util.isInvalidJSONNumber(t))throw new Error(e+"contains "+t.toString()+" "+o.toErrorString());if(goog.isString(t)&&t.length>fb.core.util.validation.MAX_LEAF_SIZE_/3&&fb.util.utf8.stringLength(t)>fb.core.util.validation.MAX_LEAF_SIZE_)throw new Error(e+"contains a string greater than "+fb.core.util.validation.MAX_LEAF_SIZE_+" utf8 bytes "+o.toErrorString()+" ('"+t.substring(0,50)+"...')");if(goog.isObject(t)){var r=!1,n=!1;if(fb.util.obj.foreach(t,function(t,i){if(".value"===t)r=!0;else if(".priority"!==t&&".sv"!==t&&(n=!0,!fb.core.util.validation.isValidKey(t)))throw new Error(e+" contains an invalid key ("+t+") "+o.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');o.push(t),fb.core.util.validation.validateFirebaseData(e,i,o),o.pop()}),r&&n)throw new Error(e+' contains ".value" child '+o.toErrorString()+" in addition to actual children.")}},validateFirebaseMergePaths:function(e,t){var o,r;for(o=0;o<t.length;o++){r=t[o];for(var n=r.slice(),i=0;i<n.length;i++)if(".priority"===n[i]&&i===n.length-1);else if(!fb.core.util.validation.isValidKey(n[i]))throw new Error(e+"contains an invalid key ("+n[i]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"')}t.sort(fb.core.util.Path.comparePaths);var a=null;for(o=0;o<t.length;o++){if(r=t[o],null!==a&&a.contains(r))throw new Error(e+"contains a path "+a.toString()+" that is ancestor of another path "+r.toString());a=r}},validateFirebaseMergeDataArg:function(e,t,o,r,n){if(!n||goog.isDef(o)){var i=fb.util.validation.errorPrefix(e,t,n);if(!goog.isObject(o)||goog.isArray(o))throw new Error(i+" must be an object containing the children to replace.");var a=[];fb.util.obj.foreach(o,function(e,t){var o=new fb.core.util.Path(e);if(fb.core.util.validation.validateFirebaseData(i,t,r.child(o)),".priority"===o.getBack()&&!fb.core.util.validation.isValidPriority(t))throw new Error(i+"contains an invalid value for '"+o.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");a.push(o)}),fb.core.util.validation.validateFirebaseMergePaths(i,a)}},validatePriority:function(e,t,o,r){if(!r||goog.isDef(o)){if(fb.core.util.isInvalidJSONNumber(o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"is "+o.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!fb.core.util.validation.isValidPriority(o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},validateEventType:function(e,t,o,r){if(!r||goog.isDef(o))switch(o){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(fb.util.validation.errorPrefix(e,t,r)+'must be a valid event type: "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},validateKey:function(e,t,o,r){if((!r||goog.isDef(o))&&!fb.core.util.validation.isValidKey(o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+'was an invalid key: "'+o+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},validatePathString:function(e,t,o,r){if((!r||goog.isDef(o))&&!fb.core.util.validation.isValidPathString(o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+'was an invalid path: "'+o+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},validateRootPathString:function(e,t,o,r){o&&(o=o.replace(/^\/*\.info(\/|$)/,"/")),fb.core.util.validation.validatePathString(e,t,o,r)},validateWritablePath:function(e,t){if(".info"===t.getFront())throw new Error(e+" failed: Can't modify data under /.info/")},validateUrl:function(e,t,o){var r=o.path.toString();if(!goog.isString(o.repoInfo.host)||0===o.repoInfo.host.length||!fb.core.util.validation.isValidKey(o.repoInfo.namespace)||0!==r.length&&!fb.core.util.validation.isValidRootPathString(r))throw new Error(fb.util.validation.errorPrefix(e,t,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},validateCredential:function(e,t,o,r){if((!r||goog.isDef(o))&&!goog.isString(o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"must be a valid credential (a string).")},validateBoolean:function(e,t,o,r){if((!r||goog.isDef(o))&&!goog.isBoolean(o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"must be a boolean.")},validateString:function(e,t,o,r){if((!r||goog.isDef(o))&&!goog.isString(o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"must be a valid string.")},validateAuthProvider:function(e,t,o,r){if((!r||goog.isDef(o))&&(fb.core.util.validation.validateString(e,t,o,r),!fb.core.util.validation.VALID_AUTH_PROVIDER.test(o)))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"'"+o+"' is not a valid authentication provider.")},validateObject:function(e,t,o,r){if((!r||goog.isDef(o))&&(!goog.isObject(o)||null===o))throw new Error(fb.util.validation.errorPrefix(e,t,r)+"must be a valid object.")},validateObjectContainsKey:function(e,t,o,r,n,i){var a=goog.isObject(o)&&fb.util.obj.contains(o,r);if(!a){if(n)return;throw new Error(fb.util.validation.errorPrefix(e,t,n)+'must contain the key "'+r+'"')}if(i){var s=fb.util.obj.get(o,r);if("number"===i&&!goog.isNumber(s)||"string"===i&&!goog.isString(s)||"boolean"===i&&!goog.isBoolean(s)||"function"===i&&!goog.isFunction(s)||"object"===i&&!goog.isObject(s))throw n?new Error(fb.util.validation.errorPrefix(e,t,n)+'contains invalid value for key "'+r+'" (must be of type "'+i+'")'):new Error(fb.util.validation.errorPrefix(e,t,n)+'must contain the key "'+r+'" with type "'+i+'"')}}},goog.provide("fb.core.util.CountedSet"),goog.require("fb.core.util"),goog.require("fb.util.obj"),goog.require("goog.object"),fb.core.util.CountedSet=goog.defineClass(null,{constructor:function(){this.set={}},add:function(e,t){this.set[e]=null===t||t},contains:function(e){return fb.util.obj.contains(this.set,e)},get:function(e){return this.contains(e)?this.set[e]:void 0},remove:function(e){delete this.set[e]},clear:function(){this.set={}},isEmpty:function(){return goog.object.isEmpty(this.set)},count:function(){return goog.object.getCount(this.set)},each:function(e){goog.object.forEach(this.set,function(t,o){e(o,t)})},keys:function(){var e=[];return goog.object.forEach(this.set,function(t,o){e.push(o)}),e}}),goog.provide("fb.core.SparseSnapshotTree"),goog.require("fb.core.snap.Node"),goog.require("fb.core.snap.PriorityIndex"),goog.require("fb.core.util.CountedSet"),goog.require("fb.core.util.Path"),fb.core.SparseSnapshotTree=function(){this.value_=null,this.children_=null},fb.core.SparseSnapshotTree.prototype.find=function(e){if(null!=this.value_)return this.value_.getChild(e);if(e.isEmpty()||null==this.children_)return null;var t=e.getFront();if(e=e.popFront(),this.children_.contains(t)){var o=this.children_.get(t);return o.find(e)}return null},fb.core.SparseSnapshotTree.prototype.remember=function(e,t){if(e.isEmpty())this.value_=t,this.children_=null;else if(null!==this.value_)this.value_=this.value_.updateChild(e,t);else{null==this.children_&&(this.children_=new fb.core.util.CountedSet);var o=e.getFront();this.children_.contains(o)||this.children_.add(o,new fb.core.SparseSnapshotTree);var r=this.children_.get(o);e=e.popFront(),r.remember(e,t)}},fb.core.SparseSnapshotTree.prototype.forget=function(e){if(e.isEmpty())return this.value_=null,this.children_=null,!0;if(null!==this.value_){if(this.value_.isLeafNode())return!1;var t=this.value_;this.value_=null;var o=this;return t.forEachChild(fb.core.snap.PriorityIndex,function(e,t){o.remember(new fb.core.util.Path(e),t)}),this.forget(e)}if(null!==this.children_){var r=e.getFront();if(e=e.popFront(),this.children_.contains(r)){var n=this.children_.get(r).forget(e);n&&this.children_.remove(r)}return!!this.children_.isEmpty()&&(this.children_=null,!0)}return!0},fb.core.SparseSnapshotTree.prototype.forEachTree=function(e,t){null!==this.value_?t(e,this.value_):this.forEachChild(function(o,r){var n=new fb.core.util.Path(e.toString()+"/"+o);r.forEachTree(n,t)})},fb.core.SparseSnapshotTree.prototype.forEachChild=function(e){null!==this.children_&&this.children_.each(function(t,o){e(t,o)})},goog.provide("fb.login.Constants"),fb.login.Constants={SESSION_PERSISTENCE_KEY_PREFIX:"session",DEFAULT_SERVER_HOST:"auth.firebase.com",SERVER_HOST:"auth.firebase.com",API_VERSION:"v2",POPUP_PATH_TO_CHANNEL:"/auth/channel",POPUP_RELAY_FRAME_NAME:"__winchan_relay_frame",POPUP_CLOSE_CMD:"die",JSONP_CALLBACK_NAMESPACE:"__firebase_auth_jsonp",REDIR_REQUEST_ID_KEY:"redirect_request_id",REDIR_REQUEST_COMPLETION_KEY:"__firebase_request_key",REDIR_CLIENT_OPTIONS_KEY:"redirect_client_options",INTERNAL_REDIRECT_SENTINAL_PATH:"/blank/page.html",CLIENT_OPTION_SESSION_PERSISTENCE:"remember",CLIENT_OPTION_REDIRECT_TO:"redirectTo"},goog.provide("fb.login.RequestInfo"),goog.require("fb.login.Constants"),fb.login.RequestInfo=function(e,t,o){this.clientOptions=e||{},this.transportOptions=t||{},this.serverParams=o||{},this.clientOptions[fb.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]||(this.clientOptions[fb.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]="default")},fb.login.RequestInfo.CLIENT_OPTIONS=[fb.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE,fb.login.Constants.CLIENT_OPTION_REDIRECT_TO],fb.login.RequestInfo.fromParams=function(e){var t={},o={};return fb.util.obj.foreach(e||{},function(e,r){goog.array.contains(fb.login.RequestInfo.CLIENT_OPTIONS,e)?t[e]=r:o[e]=r}),new fb.login.RequestInfo(t,{},o)},goog.provide("fb.login.SessionManager"),goog.require("fb.core.storage"),goog.require("fb.login.Constants"),goog.require("fb.util.json"),goog.require("fb.util.jwt");fb.login.SessionManager=function(e,t){this.persistenceKey_=[fb.login.Constants.SESSION_PERSISTENCE_KEY_PREFIX,e.persistenceKey,e.namespace].join(":"),this.stores_=t};fb.login.SessionManager.prototype.set=function(e,t){if(!t){if(!this.stores_.length)throw new Error("fb.login.SessionManager : No storage options available!");t=this.stores_[0]}t.set(this.persistenceKey_,e)},fb.login.SessionManager.prototype.get=function(){var e=goog.array.map(this.stores_,goog.bind(this.getFromStore_,this));return e=goog.array.filter(e,function(e){return null!==e}),goog.array.sort(e,function(e,t){return fb.util.jwt.issuedAtTime(t.token)-fb.util.jwt.issuedAtTime(e.token)}),e.length>0?e.shift():null},fb.login.SessionManager.prototype.getFromStore_=function(e){try{var t=e.get(this.persistenceKey_);if(t&&t.token)return t}catch(e){}return null},fb.login.SessionManager.prototype.clear=function(e){var t=(e?[e]:this.stores_,this);goog.array.forEach(this.stores_,function(e){e.remove(t.persistenceKey_)})},goog.provide("fb.login.util.environment"),fb.login.util.environment.getUA=function(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""},fb.login.util.environment.isMobileWrapper=function(){return fb.login.util.environment.isMobileCordova()||fb.login.util.environment.isMobileWindows()||fb.login.util.environment.isIosWebview()},fb.login.util.environment.isMobileCordova=function(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(fb.login.util.environment.getUA())},fb.login.util.environment.isReactNative=function(){return"object"==typeof navigator&&"ReactNative"===navigator.product},fb.login.util.environment.isMobileWindows=function(){return"undefined"!=typeof navigator&&(!!fb.login.util.environment.getUA().match(/Windows Phone/)||!!window.Windows&&/^ms-appx:/.test(location.href))},fb.login.util.environment.isMobileFirefox=function(){var e=fb.login.util.environment.getUA();return e.indexOf("Fennec/")!==-1||e.indexOf("Firefox/")!==-1&&e.indexOf("Android")!==-1},fb.login.util.environment.isIosWebview=function(){var e=fb.login.util.environment.getUA();return"undefined"!=typeof navigator&&"undefined"!=typeof window&&!!(e.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i)||e.match(/CriOS/)||e.match(/Twitter for iPhone/)||e.match(/FBAN\/FBIOS/)||window.navigator.standalone)},fb.login.util.environment.isHeadlessBrowser=function(){return!!fb.login.util.environment.getUA().match(/PhantomJS/)},fb.login.util.environment.isLocalFile=function(){return"undefined"!=typeof location&&/^file:\//.test(location.href)},fb.login.util.environment.isIE=function(){var e=fb.login.util.environment.getUA();return!(!e.match(/MSIE/)&&!e.match(/Trident/))},fb.login.util.environment.isIEVersionAtLeast=function(e){var t,o=fb.login.util.environment.getUA();if(""===o)return!1;if("Microsoft Internet Explorer"===navigator.appName){if(t=o.match(/MSIE ([0-9]{1,}[\.0-9]{0,})/),t&&t.length>1)return parseFloat(t[1])>=e}else if(o.indexOf("Trident")>-1&&(t=o.match(/rv:([0-9]{2,2}[\.0-9]{0,})/),t&&t.length>1))return parseFloat(t[1])>=e;return!1},goog.provide("fb.login.transports.util"),goog.require("fb.login.Constants"),goog.require("fb.util"),fb.login.transports.util.findRelay=function(){var e,t=(window.location,window.opener.frames);for(e=t.length-1;e>=0;e--)try{if(t[e].location.protocol===window.location.protocol&&t[e].location.host===window.location.host&&t[e].name===fb.login.Constants.POPUP_RELAY_FRAME_NAME)return t[e]}catch(e){}return null},fb.login.transports.util.addListener=function(e,t,o){e.attachEvent?e.attachEvent("on"+t,o):e.addEventListener&&e.addEventListener(t,o,!1)},fb.login.transports.util.removeListener=function(e,t,o){e.detachEvent?e.detachEvent("on"+t,o):e.removeEventListener&&e.removeEventListener(t,o,!1)},fb.login.transports.util.extractOrigin=function(e){/^https?:\/\//.test(e)||(e=window.location.href);var t=/^(https?:\/\/[\-_a-zA-Z\.0-9:]+)/.exec(e);return t?t[1]:e},fb.login.transports.util.extractRedirectCompletionHash=function(e){var t="";try{e=e.replace(/.*\?/,"");var o=fb.util.querystringDecode(e);o&&fb.util.obj.contains(o,fb.login.Constants.REDIR_REQUEST_COMPLETION_KEY)&&(t=fb.util.obj.get(o,fb.login.Constants.REDIR_REQUEST_COMPLETION_KEY))}catch(e){}return t},fb.login.transports.util.replaceRedirectCompletionHash=function(){try{var e=new RegExp("&"+fb.login.Constants.REDIR_REQUEST_COMPLETION_KEY+"=([a-zA-z0-9]*)"),t=document.location.hash.replace(e,"");t=t.replace(/\?$/,""),t=t.replace(/^#+$/,""),document.location.hash=t}catch(e){}},fb.login.transports.util.getBaseUrl=function(){var e=fb.core.util.parseURL(fb.login.Constants.SERVER_HOST);return e.scheme+"://"+e.host+"/"+fb.login.Constants.API_VERSION},fb.login.transports.util.getPopupChannelUrl=function(e){return fb.login.transports.util.getBaseUrl()+"/"+e+fb.login.Constants.POPUP_PATH_TO_CHANNEL},goog.provide("fb.login.Transport"),fb.login.Transport=function(e){},fb.login.Transport.isAvailable=function(){},fb.login.Transport.prototype.open=function(e,t,o){},fb.login.Transport.prototype.classification=function(){},goog.provide("fb.login.transports.PopupReceiver"),goog.require("fb.login.Constants"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.util"),goog.require("fb.login.util.environment"),goog.require("fb.util.json"),fb.login.transports.PopupReceiver=function(e){var t=this;if(this.cb=e,this.targetOrigin="*",fb.login.util.environment.isIEVersionAtLeast(8)?this.messageTarget=this.inboundTarget=fb.login.transports.util.findRelay():(this.messageTarget=window.opener,this.inboundTarget=window),!t.messageTarget)throw"Unable to find relay frame";fb.login.transports.util.addListener(this.inboundTarget,"message",goog.bind(this.onMessage_,this)),fb.login.transports.util.addListener(this.inboundTarget,"message",goog.bind(this.onDie_,this));try{this.doPost_({a:"ready"})}catch(e){fb.login.transports.util.addListener(this.messageTarget,"load",function(e){t.doPost_({a:"ready"})})}fb.login.transports.util.addListener(window,"unload",goog.bind(this.onUnload_,this))},fb.login.transports.PopupReceiver.prototype.doPost_=function(e){e=fb.util.json.stringify(e),fb.login.util.environment.isIEVersionAtLeast(8)?this.messageTarget.doPost(e,this.targetOrigin):this.messageTarget.postMessage(e,this.targetOrigin)},fb.login.transports.PopupReceiver.prototype.onMessage_=function(e){var t,o=this;try{t=fb.util.json.eval(e.data)}catch(e){}t&&"request"===t.a&&(fb.login.transports.util.removeListener(window,"message",this.onMessage_),this.targetOrigin=e.origin,this.cb&&setTimeout(function(){o.cb(o.targetOrigin,t.d,function(e,t){o.autoClose=!t,o.cb=void 0,o.doPost_({a:"response",d:e,forceKeepWindowOpen:t})})},0))},fb.login.transports.PopupReceiver.prototype.onUnload_=function(){try{fb.login.transports.util.removeListener(this.inboundTarget,"message",this.onDie_)}catch(e){}this.cb&&(this.doPost_({a:"error",d:"unknown closed window"}),this.cb=void 0);try{window.close()}catch(e){}},fb.login.transports.PopupReceiver.prototype.onDie_=function(e){if(this.autoClose&&e.data===fb.login.Constants.POPUP_CLOSE_CMD)try{window.close()}catch(e){}},goog.provide("fb.login.transports.Redirect"),goog.require("fb.constants"),goog.require("fb.core.storage"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.util"),goog.require("fb.util"),fb.login.transports.Redirect=function(e){this.requestId_=goog.string.getRandomString()+goog.string.getRandomString()+goog.string.getRandomString(),this.options_=e},fb.login.transports.Redirect.prototype.open=function(e,t,o){fb.core.storage.SessionStorage.set(fb.login.Constants.REDIR_REQUEST_ID_KEY,this.requestId_),fb.core.storage.SessionStorage.set(fb.login.Constants.REDIR_REQUEST_ID_KEY,this.requestId_),t.requestId=this.requestId_,t.redirectTo=t.redirectTo||window.location.href,e+=(/\?/.test(e)?"":"?")+fb.util.querystring(t),window.location=e},fb.login.transports.Redirect.isAvailable=function(){return!NODE_CLIENT&&!fb.login.util.environment.isLocalFile()&&!fb.login.util.environment.isMobileCordova()},fb.login.transports.Redirect.prototype.classification=function(){return"redirect"},goog.provide("fb.login.Errors");var errors={
NETWORK_ERROR:"Unable to contact the Firebase server.",SERVER_ERROR:"An unknown server error occurred.",TRANSPORT_UNAVAILABLE:"There are no login transports available for the requested method.",REQUEST_INTERRUPTED:"The browser redirected the page before the login request could complete.",USER_CANCELLED:"The user cancelled authentication."};fb.login.Errors.get=function(e){var t=fb.util.obj.get(errors,e),o=new Error(t,e);return o.code=e,o},goog.provide("fb.login.transports.Popup"),goog.require("fb.core.util"),goog.require("fb.login.Constants"),goog.require("fb.login.Errors"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.util"),goog.require("fb.login.util.environment"),goog.require("fb.util"),goog.require("fb.util.json"),fb.login.transports.Popup=function(e){e.window_features&&!fb.login.util.environment.isMobileFirefox()||(e.window_features=void 0),e.window_name||(e.window_name="_blank"),this.options=e},fb.login.transports.Popup.prototype.open=function(e,t,o){function r(e){if(i&&(document.body.removeChild(i),i=void 0),c&&(c=clearInterval(c)),fb.login.transports.util.removeListener(window,"message",n),fb.login.transports.util.removeListener(window,"unload",r),u&&!e)try{u.close()}catch(e){a.postMessage(fb.login.Constants.POPUP_CLOSE_CMD,g)}u=a=void 0}function n(e){if(e.origin===g)try{var t=fb.util.json.eval(e.data);"ready"===t.a?a.postMessage(f,g):"error"===t.a?(r(!1),o&&(o(t.d),o=null)):"response"===t.a&&(r(t.forceKeepWindowOpen),o&&(o(null,t.d),o=null))}catch(e){}}var i,a,s=this,l=fb.login.util.environment.isIEVersionAtLeast(8);if(!this.options.relay_url)return o(new Error("invalid arguments: origin of url and relay_url must match"));var g=fb.login.transports.util.extractOrigin(e);if(g!==fb.login.transports.util.extractOrigin(s.options.relay_url))return void(o&&setTimeout(function(){o(new Error("invalid arguments: origin of url and relay_url must match"))},0));l&&(i=document.createElement("iframe"),i.setAttribute("src",s.options.relay_url),i.style.display="none",i.setAttribute("name",fb.login.Constants.POPUP_RELAY_FRAME_NAME),document.body.appendChild(i),a=i.contentWindow),e+=(/\?/.test(e)?"":"?")+fb.util.querystring(t);var u=window.open(e,s.options.window_name,s.options.window_features);a||(a=u);var c=setInterval(function(){if(u&&u.closed)return r(!1),void(o&&(o(fb.login.Errors.get("USER_CANCELLED")),o=null))},500),f=fb.util.json.stringify({a:"request",d:t});fb.login.transports.util.addListener(window,"unload",r),fb.login.transports.util.addListener(window,"message",n)},fb.login.transports.Popup.isAvailable=function(){return!NODE_CLIENT&&"postMessage"in window&&!fb.login.util.environment.isLocalFile()&&!fb.login.util.environment.isMobileWrapper()&&!fb.login.util.environment.isHeadlessBrowser()},fb.login.transports.Popup.prototype.classification=function(){return"popup"},goog.provide("fb.login.transports.NodeHttp"),goog.require("fb.login.Constants"),goog.require("fb.login.Errors"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.util"),goog.require("fb.login.util.environment"),goog.require("fb.util"),goog.require("fb.util.json"),fb.login.transports.NodeHttp=function(e){e.method||(e.method="GET"),e.headers||(e.headers={}),e.headers.content_type||(e.headers.content_type="application/json"),e.headers.content_type=e.headers.content_type.toLowerCase(),this.options=e},fb.login.transports.NodeHttp.prototype.open=function(e,t,o){var r,n=fb.core.util.parseURL(e),i="http"===n.scheme?require("http"):require("https"),a=this.options.method,s={Accept:"application/json;text/plain"};goog.object.extend(s,this.options.headers);var l={host:n.host.split(":")[0],port:n.port,path:n.pathString,method:this.options.method.toUpperCase()};if("GET"===a)l.path+=(/\?/.test(l.path)?"":"?")+fb.util.querystring(t),r=null;else{var g=this.options.headers.content_type;"application/json"===g&&(r=fb.util.json.stringify(t)),"application/x-www-form-urlencoded"===g&&(r=fb.util.querystring(t)),s["Content-Length"]=Buffer.byteLength(r,"utf8")}l.headers=s;var u=i.request(l,function(e){var t="";e.setEncoding("utf8"),e.on("data",function(e){t+=e}),e.on("end",function(){try{t=fb.util.json.eval(t+"")}catch(e){}o&&(o(null,t),o=null)})});"GET"!==a&&u.write(r),u.on("error",function(e){o(e&&e.code&&("ENOTFOUND"===e.code||"ENETDOWN"===e.code)?fb.login.Errors.get("NETWORK_ERROR"):fb.login.Errors.get("SERVER_ERROR")),o=null}),u.end()},fb.login.transports.NodeHttp.isAvailable=function(){return NODE_CLIENT},fb.login.transports.NodeHttp.prototype.classification=function(){return"json"},goog.provide("fb.login.transports.XHR"),goog.require("fb.login.Constants"),goog.require("fb.login.Errors"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.util"),goog.require("fb.login.util.environment"),goog.require("fb.util"),goog.require("fb.util.json"),fb.login.transports.XHR=function(e){e.method||(e.method="GET"),e.headers||(e.headers={}),e.headers.content_type||(e.headers.content_type="application/json"),e.headers.content_type=e.headers.content_type.toLowerCase(),this.options=e},fb.login.transports.XHR.prototype.open=function(e,t,o){function r(e){o&&(o(fb.login.Errors.get("REQUEST_INTERRUPTED")),o=null)}var n,i=new XMLHttpRequest,a=this.options.method.toUpperCase();if(fb.login.transports.util.addListener(window,"beforeunload",r),i.onreadystatechange=function(){if(o&&4===i.readyState){var e;if(i.status>=200&&i.status<300){try{e=fb.util.json.eval(i.responseText)}catch(e){}o(null,e)}else o(i.status>=500&&i.status<600?fb.login.Errors.get("SERVER_ERROR"):fb.login.Errors.get("NETWORK_ERROR"));o=null,fb.login.transports.util.removeListener(window,"beforeunload",r)}},"GET"===a)e+=(/\?/.test(e)?"":"?")+fb.util.querystring(t),n=null;else{var s=this.options.headers.content_type;"application/json"===s&&(n=fb.util.json.stringify(t)),"application/x-www-form-urlencoded"===s&&(n=fb.util.querystring(t))}i.open(a,e,!0);var l={"X-Requested-With":"XMLHttpRequest",Accept:"application/json;text/plain"};goog.object.extend(l,this.options.headers);for(var g in l)i.setRequestHeader(g,l[g]);i.send(n)},fb.login.transports.XHR.isAvailable=function(){return!NODE_CLIENT&&!!window.XMLHttpRequest&&(!fb.login.util.environment.isIE()||fb.login.util.environment.isIEVersionAtLeast(10))},fb.login.transports.XHR.prototype.classification=function(){return"json"},goog.provide("fb.login.transports.CordovaInAppBrowser"),goog.require("fb.core.util"),goog.require("fb.login.Constants"),goog.require("fb.login.Errors"),goog.require("fb.login.RequestInfo"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.XHR"),goog.require("fb.login.transports.util"),goog.require("fb.login.util.environment"),goog.require("fb.util"),goog.require("fb.util.json"),fb.login.transports.CordovaInAppBrowser=function(e){this.requestId_=goog.string.getRandomString()+goog.string.getRandomString()+goog.string.getRandomString(),this.options_=e},fb.login.transports.CordovaInAppBrowser.prototype.open=function(e,t,o){function r(e){try{var t=document.createElement("a");return t.href=e,t.host===s.host&&t.pathname===fb.login.Constants.INTERNAL_REDIRECT_SENTINAL_PATH}catch(e){}return!1}function n(e){o&&(o(fb.login.Errors.get("USER_CANCELLED")),o=null)}var i,a=this,s=fb.core.util.parseURL(fb.login.Constants.SERVER_HOST);return t.requestId=this.requestId_,t[fb.login.Constants.CLIENT_OPTION_REDIRECT_TO]=s.scheme+"://"+s.host+fb.login.Constants.INTERNAL_REDIRECT_SENTINAL_PATH,e+=/\?/.test(e)?"":"?",e+=fb.util.querystring(t),i=window.open(e,"_blank","location=no"),i&&goog.isFunction(i.addEventListener)?(i.addEventListener("loadstart",function(e){if(e&&e.url&&r(e.url)){var t=fb.login.transports.util.extractRedirectCompletionHash(e.url);i.removeEventListener("exit",n),i.close();var s="/auth/session",l=new fb.login.RequestInfo(null,null,{requestId:a.requestId_,requestKey:t});a.options_.requestWithCredential(s,l,o),o=null}}),void i.addEventListener("exit",n)):void o(fb.login.Errors.get("TRANSPORT_UNAVAILABLE"))},fb.login.transports.CordovaInAppBrowser.isAvailable=function(){return!NODE_CLIENT&&fb.login.util.environment.isMobileCordova()},fb.login.transports.CordovaInAppBrowser.prototype.classification=function(){return"redirect"},goog.provide("fb.login.transports.JSONP"),goog.require("fb.login.Constants"),goog.require("fb.login.Errors"),goog.require("fb.login.Transport"),goog.require("fb.login.transports.util"),goog.require("fb.util"),goog.require("fb.util.json"),fb.login.transports.JSONP=function(e){e.callback_parameter||(e.callback_parameter="callback"),this.options=e,window[fb.login.Constants.JSONP_CALLBACK_NAMESPACE]=window[fb.login.Constants.JSONP_CALLBACK_NAMESPACE]||{}},fb.login.transports.JSONP.prototype.open=function(e,t,o){function r(e){o&&(o(fb.login.Errors.get("REQUEST_INTERRUPTED")),o=null)}function n(){setTimeout(function(){window[fb.login.Constants.JSONP_CALLBACK_NAMESPACE][a]=void 0,goog.object.isEmpty(window[fb.login.Constants.JSONP_CALLBACK_NAMESPACE])&&(window[fb.login.Constants.JSONP_CALLBACK_NAMESPACE]=void 0);try{var e=document.getElementById(a);e&&e.parentNode.removeChild(e)}catch(e){}},1),fb.login.transports.util.removeListener(window,"beforeunload",r)}function i(e){o&&(o(null,e),o=null),n()}var a="fn"+(new Date).getTime()+Math.floor(99999*Math.random());t[this.options.callback_parameter]=fb.login.Constants.JSONP_CALLBACK_NAMESPACE+"."+a,e+=(/\?/.test(e)?"":"?")+fb.util.querystring(t),fb.login.transports.util.addListener(window,"beforeunload",r),window[fb.login.Constants.JSONP_CALLBACK_NAMESPACE][a]=i,this.writeScriptTag_(a,e,o)},fb.login.transports.JSONP.prototype.writeScriptTag_=function(e,t,o){setTimeout(function(){try{var r=document.createElement("script");r.type="text/javascript",r.id=e,r.async=!0,r.src=t,r.onerror=function(){var t=document.getElementById(e);null!==t&&t.parentNode.removeChild(t),o&&o(fb.login.Errors.get("NETWORK_ERROR"))};var n,i=document.getElementsByTagName("head");n=!i||goog.array.isEmpty(i)?document.documentElement:i[0],n.appendChild(r)}catch(e){o&&o(fb.login.Errors.get("NETWORK_ERROR"))}},0)},fb.login.transports.JSONP.isAvailable=function(){return"undefined"!=typeof document&&goog.isDefAndNotNull(document.createElement)},fb.login.transports.JSONP.prototype.classification=function(){return"json"},goog.provide("fb.login.AuthenticationManager"),goog.require("fb.constants"),goog.require("fb.core.storage"),goog.require("fb.core.util"),goog.require("fb.core.util.EventEmitter"),goog.require("fb.login.Constants"),goog.require("fb.login.Errors"),goog.require("fb.login.RequestInfo"),goog.require("fb.login.SessionManager"),goog.require("fb.login.transports.CordovaInAppBrowser"),goog.require("fb.login.transports.JSONP"),goog.require("fb.login.transports.NodeHttp"),goog.require("fb.login.transports.Popup"),goog.require("fb.login.transports.Redirect"),goog.require("fb.login.transports.XHR"),fb.login.AuthenticationManager=function(e,t,o,r){fb.core.util.EventEmitter.call(this,["auth_status"]),this.repoInfo_=e,this.authConn_=t,this.unauthConn_=o,this.onAuthStatus_=r,this.sessionManager_=new fb.login.SessionManager(e,[fb.core.storage.PersistentStorage,fb.core.storage.SessionStorage]),this.authData_=null,this.redirectRestart_=!1,this.resumeSession()},goog.inherits(fb.login.AuthenticationManager,fb.core.util.EventEmitter),fb.login.AuthenticationManager.prototype.getAuth=function(){return this.authData_||null},fb.login.AuthenticationManager.prototype.resumeSession=function(){var e=fb.core.storage.SessionStorage.get(fb.login.Constants.REDIR_REQUEST_ID_KEY),t=this;e&&this.finishOAuthRedirectLogin_();var o=this.sessionManager_.get();o&&o.token?(this.updateAuthStatus_(o),this.authConn_(o.token,function(e,r){t.authOnComplete_(e,r,!1,o.token,o)},function(e,o){t.authOnCancel_("resumeSession()",e,o)})):this.updateAuthStatus_(null)},fb.login.AuthenticationManager.prototype.authenticate=function(e,t,o,r,n){this.repoInfo_.isDemoHost()&&fb.core.util.warn("Firebase authentication is not supported on demo Firebases (*.firebaseio-demo.com). To secure your Firebase, create a production Firebase at https://www.firebase.com.");var i=this;this.authConn_(e,function(n,a){i.authOnComplete_(n,a,!0,e,t,o||{},r)},function(e,t){i.authOnCancel_("auth()",e,t,n)})},fb.login.AuthenticationManager.prototype.unauthenticate=function(e){var t=this;this.sessionManager_.clear(),t.updateAuthStatus_(null),this.unauthConn_(function(t,o){if("ok"===t)fb.core.util.callUserCallback(e,null);else{var r=(t||"error").toUpperCase(),n=r;o&&(n+=": "+o);var i=new Error(n);i.code=r,fb.core.util.callUserCallback(e,i)}})},fb.login.AuthenticationManager.prototype.authOnComplete_=function(e,t,o,r,n,i,a){if("ok"===e){if(o){var s=t.auth;n.auth=s,n.expires=t.expires,n.token=fb.util.jwt.isValidFormat(r)?r:"";var l=null;s&&fb.util.obj.contains(s,"uid")?l=fb.util.obj.get(s,"uid"):fb.util.obj.contains(n,"uid")&&(l=fb.util.obj.get(n,"uid")),n.uid=l;var g="custom";if(s&&fb.util.obj.contains(s,"provider")?g=fb.util.obj.get(s,"provider"):fb.util.obj.contains(n,"provider")&&(g=fb.util.obj.get(n,"provider")),n.provider=g,this.sessionManager_.clear(),fb.util.jwt.isValidFormat(r)){i=i||{};var u=fb.core.storage.PersistentStorage;"sessionOnly"===i[fb.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]&&(u=fb.core.storage.SessionStorage),"none"!==i[fb.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]&&this.sessionManager_.set(n,u)}this.updateAuthStatus_(n)}return void fb.core.util.callUserCallback(a,null,n)}this.handleBadAuthStatus_();var c=(e||"error").toUpperCase(),f=c;t&&(f+=": "+t);var h=new Error(f);h.code=c,fb.core.util.callUserCallback(a,h)},fb.login.AuthenticationManager.prototype.authOnCancel_=function(e,t,o,r){fb.core.util.warn(e+" was canceled: "+o),this.handleBadAuthStatus_();var n=new Error(o);n.code=t.toUpperCase(),fb.core.util.callUserCallback(r,n)},fb.login.AuthenticationManager.prototype.handleBadAuthStatus_=function(){this.sessionManager_.clear(),this.updateAuthStatus_(null)},fb.login.AuthenticationManager.prototype.authWithCredential=function(e,t,o,r){this.checkServerSettingsOrThrow();var n,i=new fb.login.RequestInfo(o||{},{},t||{});n=NODE_CLIENT?[fb.login.transports.NodeHttp]:[fb.login.transports.XHR,fb.login.transports.JSONP],this.authWithTransports_(n,"/auth/"+e,i,r)},fb.login.AuthenticationManager.prototype.authWithPopup=function(e,t,o){this.checkServerSettingsOrThrow();var r=[fb.login.transports.Popup,fb.login.transports.CordovaInAppBrowser],n=fb.login.RequestInfo.fromParams(t),i=625,a=625;return"anonymous"===e||"password"===e?void setTimeout(function(){fb.core.util.callUserCallback(o,fb.login.Errors.get("TRANSPORT_UNAVAILABLE"))},0):("github"===e&&(i=1025),n.transportOptions.window_features="menubar=yes,modal=yes,alwaysRaised=yeslocation=yes,resizable=yes,scrollbars=yes,status=yes,height="+a+",width="+i+",top="+("object"==typeof screen?.5*(screen.height-a):0)+",left="+("object"==typeof screen?.5*(screen.width-i):0),n.transportOptions.relay_url=fb.login.transports.util.getPopupChannelUrl(this.repoInfo_.namespace),n.transportOptions.requestWithCredential=goog.bind(this.requestWithCredential,this),void this.authWithTransports_(r,"/auth/"+e,n,o))},fb.login.AuthenticationManager.prototype.authWithRedirect=function(e,t,o){this.checkServerSettingsOrThrow();var r=[fb.login.transports.Redirect],n=fb.login.RequestInfo.fromParams(t);return"anonymous"===e||"firebase"===e?void fb.core.util.callUserCallback(o,fb.login.Errors.get("TRANSPORT_UNAVAILABLE")):(fb.core.storage.SessionStorage.set(fb.login.Constants.REDIR_CLIENT_OPTIONS_KEY,n.clientOptions),void this.authWithTransports_(r,"/auth/"+e,n,o))},fb.login.AuthenticationManager.prototype.finishOAuthRedirectLogin_=function(){var e=fb.core.storage.SessionStorage.get(fb.login.Constants.REDIR_REQUEST_ID_KEY);if(e){var t=fb.core.storage.SessionStorage.get(fb.login.Constants.REDIR_CLIENT_OPTIONS_KEY);fb.core.storage.SessionStorage.remove(fb.login.Constants.REDIR_REQUEST_ID_KEY),fb.core.storage.SessionStorage.remove(fb.login.Constants.REDIR_CLIENT_OPTIONS_KEY);var o=[fb.login.transports.XHR,fb.login.transports.JSONP],r={requestId:e,requestKey:fb.login.transports.util.extractRedirectCompletionHash(document.location.hash)},n={},i=new fb.login.RequestInfo(t,n,r);this.redirectRestart_=!0,fb.login.transports.util.replaceRedirectCompletionHash(),this.authWithTransports_(o,"/auth/session",i,function(e){this.redirectRestart_=!1}.bind(this))}},fb.login.AuthenticationManager.prototype.createUser=function(e,t){this.checkServerSettingsOrThrow();var o="/users",r=fb.login.RequestInfo.fromParams(e);r.serverParams._method="POST",this.requestWithCredential(o,r,function(e,o){e?fb.core.util.callUserCallback(t,e):fb.core.util.callUserCallback(t,e,o)})},fb.login.AuthenticationManager.prototype.removeUser=function(e,t){var o=this;this.checkServerSettingsOrThrow();var r="/users/"+encodeURIComponent(e.email),n=fb.login.RequestInfo.fromParams(e);n.serverParams._method="DELETE",this.requestWithCredential(r,n,function(e,r){!e&&r&&r.uid&&o.authData_&&o.authData_.uid&&o.authData_.uid===r.uid&&o.unauthenticate(),fb.core.util.callUserCallback(t,e)})},fb.login.AuthenticationManager.prototype.changePassword=function(e,t){this.checkServerSettingsOrThrow();var o="/users/"+encodeURIComponent(e.email)+"/password",r=fb.login.RequestInfo.fromParams(e);r.serverParams._method="PUT",r.serverParams.password=e.newPassword,this.requestWithCredential(o,r,function(e,o){fb.core.util.callUserCallback(t,e)})},fb.login.AuthenticationManager.prototype.changeEmail=function(e,t){this.checkServerSettingsOrThrow();var o="/users/"+encodeURIComponent(e.oldEmail)+"/email",r=fb.login.RequestInfo.fromParams(e);r.serverParams._method="PUT",r.serverParams.email=e.newEmail,r.serverParams.password=e.password,this.requestWithCredential(o,r,function(e,o){fb.core.util.callUserCallback(t,e)})},fb.login.AuthenticationManager.prototype.resetPassword=function(e,t){this.checkServerSettingsOrThrow();var o="/users/"+encodeURIComponent(e.email)+"/password",r=fb.login.RequestInfo.fromParams(e);r.serverParams._method="POST",this.requestWithCredential(o,r,function(e,o){fb.core.util.callUserCallback(t,e)})},fb.login.AuthenticationManager.prototype.requestWithCredential=function(e,t,o){var r;r=NODE_CLIENT?[fb.login.transports.NodeHttp]:[fb.login.transports.XHR,fb.login.transports.JSONP],this.requestWithTransports_(r,e,t,o)},fb.login.AuthenticationManager.prototype.authWithTransports_=function(e,t,o,r){var n=this;this.requestWithTransports_(e,t,o,function(e,t){e||!(t&&t.token&&t.uid)?fb.core.util.callUserCallback(r,e||fb.login.Errors.get("UNKNOWN_ERROR")):(t=t,n.authenticate(t.token,t,o.clientOptions,function(e,t){e?fb.core.util.callUserCallback(r,e):fb.core.util.callUserCallback(r,null,t)}))})},fb.login.AuthenticationManager.prototype.requestWithTransports_=function(e,t,o,r){var n=goog.array.filter(e,function(e){return"function"==typeof e.isAvailable&&e.isAvailable()});if(0===n.length)return void setTimeout(function(){fb.core.util.callUserCallback(r,fb.login.Errors.get("TRANSPORT_UNAVAILABLE"))},0);var i=n.shift(),a=new i(o.transportOptions),s=fb.util.obj.clone(o.serverParams);s.v=this.versionString(),s.transport=a.classification(),s.suppress_status_codes=!0;var l=fb.login.transports.util.getBaseUrl()+"/"+this.repoInfo_.namespace+t;a.open(l,s,function(e,t){if(e)fb.core.util.callUserCallback(r,e);else if(t&&t.error){var o=new Error(t.error.message);o.code=t.error.code,o.details=t.error.details,fb.core.util.callUserCallback(r,o)}else fb.core.util.callUserCallback(r,null,t)})},fb.login.AuthenticationManager.prototype.updateAuthStatus_=function(e){var t=null!==this.authData_||null!==e;this.authData_=e,t&&this.trigger("auth_status",e),this.onAuthStatus_(null!==e)},fb.login.AuthenticationManager.prototype.getInitialEvent=function(e){return fb.core.util.assert("auth_status"===e,'initial event must be of type "auth_status"'),this.redirectRestart_?null:[this.authData_]},fb.login.AuthenticationManager.prototype.versionString=function(){return(NODE_CLIENT?"node-":"js-")+CLIENT_VERSION},fb.login.AuthenticationManager.prototype.checkServerSettingsOrThrow=function(){if(this.repoInfo_.isCustomHost()&&fb.login.Constants.SERVER_HOST===fb.login.Constants.DEFAULT_SERVER_HOST)throw new Error("This custom Firebase server ('"+this.repoInfo_.domain+"') does not support delegated login.")},goog.provide("fb.realtime.Transport"),goog.require("fb.core.RepoInfo"),fb.realtime.Transport=function(e,t,o){},fb.realtime.Transport.prototype.open=function(e,t){},fb.realtime.Transport.prototype.start=function(){},fb.realtime.Transport.prototype.close=function(){},fb.realtime.Transport.prototype.send=function(e){},fb.realtime.Transport.prototype.bytesReceived,fb.realtime.Transport.prototype.bytesSent,goog.provide("fb.realtime.Constants"),fb.realtime.Constants={PROTOCOL_VERSION:"5",VERSION_PARAM:"v",TRANSPORT_SESSION_PARAM:"s",REFERER_PARAM:"r",FORGE_REF:"f",FORGE_DOMAIN:"firebaseio.com",LAST_SESSION_PARAM:"ls",WEBSOCKET:"websocket",LONG_POLLING:"long_polling"},goog.provide("fb.realtime.polling.PacketReceiver"),fb.realtime.polling.PacketReceiver=function(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null},fb.realtime.polling.PacketReceiver.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},fb.realtime.polling.PacketReceiver.prototype.handleResponse=function(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){var o=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(var r=0;r<o.length;++r)if(o[r]){var n=this;fb.core.util.exceptionGuard(function(){n.onMessage_(o[r])})}if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(clearTimeout(this.onClose),this.onClose(),this.onClose=null);break}this.currentResponseNum++}},goog.provide("fb.realtime.BrowserPollConnection"),goog.require("fb.constants"),goog.require("fb.core.stats.StatsManager"),goog.require("fb.core.util"),goog.require("fb.core.util.CountedSet"),goog.require("fb.realtime.Constants"),goog.require("fb.realtime.Transport"),goog.require("fb.realtime.polling.PacketReceiver"),goog.require("fb.util.json");var FIREBASE_LONGPOLL_START_PARAM="start",FIREBASE_LONGPOLL_CLOSE_COMMAND="close",FIREBASE_LONGPOLL_COMMAND_CB_NAME="pLPCommand",FIREBASE_LONGPOLL_DATA_CB_NAME="pRTLPCB",FIREBASE_LONGPOLL_ID_PARAM="id",FIREBASE_LONGPOLL_PW_PARAM="pw",FIREBASE_LONGPOLL_SERIAL_PARAM="ser",FIREBASE_LONGPOLL_CALLBACK_ID_PARAM="cb",FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM="seg",FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET="ts",FIREBASE_LONGPOLL_DATA_PARAM="d",FIREBASE_LONGPOLL_DISCONN_FRAME_PARAM="disconn",FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM="dframe",MAX_URL_DATA_SIZE=1870,SEG_HEADER_SIZE=30,MAX_PAYLOAD_SIZE=MAX_URL_DATA_SIZE-SEG_HEADER_SIZE,KEEPALIVE_REQUEST_INTERVAL=25e3,LP_CONNECT_TIMEOUT=3e4;fb.realtime.BrowserPollConnection=function(e,t,o,r){this.connId=e,this.log_=fb.core.util.logWrapper(e),this.repoInfo=t,this.bytesSent=0,this.bytesReceived=0,this.stats_=fb.core.stats.StatsManager.getCollection(t),this.transportSessionId=o,this.everConnected_=!1,this.lastSessionId=r,this.urlFn=function(e){return t.connectionURL(fb.realtime.Constants.LONG_POLLING,e)}},fb.realtime.BrowserPollConnection.prototype.open=function(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new fb.realtime.polling.PacketReceiver(e),this.isClosed_=!1;var o=this;this.connectTimeoutTimer_=setTimeout(function(){o.log_("Timed out trying to connect."),o.onClosed_(),o.connectTimeoutTimer_=null},Math.floor(LP_CONNECT_TIMEOUT)),fb.core.util.executeWhenDOMReady(function(){if(!o.isClosed_){o.scriptTagHolder=new FirebaseIFrameScriptHolder(function(e,t,r,n,i){if(o.incrementIncomingBytes_(arguments),o.scriptTagHolder)if(o.connectTimeoutTimer_&&(clearTimeout(o.connectTimeoutTimer_),o.connectTimeoutTimer_=null),o.everConnected_=!0,e==FIREBASE_LONGPOLL_START_PARAM)o.id=t,o.password=r;else{if(e!==FIREBASE_LONGPOLL_CLOSE_COMMAND)throw new Error("Unrecognized command received: "+e);t?(o.scriptTagHolder.sendNewPolls=!1,o.myPacketOrderer.closeAfter(t,function(){o.onClosed_()})):o.onClosed_()}},function(e,t){o.incrementIncomingBytes_(arguments),o.myPacketOrderer.handleResponse(e,t)},function(){o.onClosed_()},o.urlFn);var e={};e[FIREBASE_LONGPOLL_START_PARAM]="t",e[FIREBASE_LONGPOLL_SERIAL_PARAM]=Math.floor(1e8*Math.random()),o.scriptTagHolder.uniqueCallbackIdentifier&&(e[FIREBASE_LONGPOLL_CALLBACK_ID_PARAM]=o.scriptTagHolder.uniqueCallbackIdentifier),e[fb.realtime.Constants.VERSION_PARAM]=fb.realtime.Constants.PROTOCOL_VERSION,o.transportSessionId&&(e[fb.realtime.Constants.TRANSPORT_SESSION_PARAM]=o.transportSessionId),o.lastSessionId&&(e[fb.realtime.Constants.LAST_SESSION_PARAM]=o.lastSessionId),!NODE_CLIENT&&"undefined"!=typeof location&&location.href&&location.href.indexOf(fb.realtime.Constants.FORGE_DOMAIN)!==-1&&(e[fb.realtime.Constants.REFERER_PARAM]=fb.realtime.Constants.FORGE_REF);var t=o.urlFn(e);o.log_("Connecting via long-poll to "+t),o.scriptTagHolder.addTag(t,function(){})}})},fb.realtime.BrowserPollConnection.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},fb.realtime.BrowserPollConnection.forceAllow=function(){fb.realtime.BrowserPollConnection.forceAllow_=!0},fb.realtime.BrowserPollConnection.forceDisallow=function(){fb.realtime.BrowserPollConnection.forceDisallow_=!0},fb.realtime.BrowserPollConnection.isAvailable=function(){return fb.realtime.BrowserPollConnection.forceAllow_||!fb.realtime.BrowserPollConnection.forceDisallow_&&"undefined"!=typeof document&&goog.isDefAndNotNull(document.createElement)&&!fb.core.util.isChromeExtensionContentScript()&&!fb.core.util.isWindowsStoreApp()&&!NODE_CLIENT},fb.realtime.BrowserPollConnection.prototype.markConnectionHealthy=function(){},fb.realtime.BrowserPollConnection.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},fb.realtime.BrowserPollConnection.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},fb.realtime.BrowserPollConnection.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},fb.realtime.BrowserPollConnection.prototype.send=function(e){var t=fb.util.json.stringify(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var o=fb.core.util.base64Encode(t),r=fb.core.util.splitStringBySize(o,MAX_PAYLOAD_SIZE),n=0;n<r.length;n++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[n]),this.curSegmentNum++},fb.realtime.BrowserPollConnection.prototype.addDisconnectPingFrame=function(e,t){if(!NODE_CLIENT){this.myDisconnFrame=document.createElement("iframe");var o={};o[FIREBASE_LONGPOLL_DISCONN_FRAME_REQUEST_PARAM]="t",o[FIREBASE_LONGPOLL_ID_PARAM]=e,o[FIREBASE_LONGPOLL_PW_PARAM]=t,this.myDisconnFrame.src=this.urlFn(o),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},fb.realtime.BrowserPollConnection.prototype.incrementIncomingBytes_=function(e){var t=fb.util.json.stringify(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},FirebaseIFrameScriptHolder.prototype.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{var t=e.contentWindow.document;t||fb.core.util.log("No IE domain setting required")}catch(t){var o=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+o+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},FirebaseIFrameScriptHolder.prototype.close=function(){if(this.alive=!1,this.myIFrame){this.myIFrame.doc.body.innerHTML="";var e=this;setTimeout(function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)},Math.floor(0))}if(NODE_CLIENT&&this.myID){var t={};t[FIREBASE_LONGPOLL_DISCONN_FRAME_PARAM]="t",t[FIREBASE_LONGPOLL_ID_PARAM]=this.myID,t[FIREBASE_LONGPOLL_PW_PARAM]=this.myPW;var o=this.urlFn(t);FirebaseIFrameScriptHolder.nodeRestRequest(o)}var r=this.onDisconnect;r&&(this.onDisconnect=null,r())},FirebaseIFrameScriptHolder.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},FirebaseIFrameScriptHolder.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.count()<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e[FIREBASE_LONGPOLL_ID_PARAM]=this.myID,e[FIREBASE_LONGPOLL_PW_PARAM]=this.myPW,e[FIREBASE_LONGPOLL_SERIAL_PARAM]=this.currentSerial;for(var t=this.urlFn(e),o="",r=0;this.pendingSegs.length>0;){var n=this.pendingSegs[0];if(!(n.d.length+SEG_HEADER_SIZE+o.length<=MAX_URL_DATA_SIZE))break;var i=this.pendingSegs.shift();o=o+"&"+FIREBASE_LONGPOLL_SEGMENT_NUM_PARAM+r+"="+i.seg+"&"+FIREBASE_LONGPOLL_SEGMENTS_IN_PACKET+r+"="+i.ts+"&"+FIREBASE_LONGPOLL_DATA_PARAM+r+"="+i.d,r++}return t+=o,this.addLongPollTag_(t,this.currentSerial),!0}return!1},FirebaseIFrameScriptHolder.prototype.enqueueSegment=function(e,t,o){this.pendingSegs.push({seg:e,ts:t,d:o}),this.alive&&this.newRequest_()},FirebaseIFrameScriptHolder.prototype.addLongPollTag_=function(e,t){var o=this;o.outstandingRequests.add(t,1);var r=function(){o.outstandingRequests.remove(t),o.newRequest_()},n=setTimeout(r,Math.floor(KEEPALIVE_REQUEST_INTERVAL)),i=function(){clearTimeout(n),r()};this.addTag(e,i)},FirebaseIFrameScriptHolder.prototype.addTag=function(e,t){if(NODE_CLIENT)this.doNodeLongPoll(e,t);else{var o=this;setTimeout(function(){try{if(!o.sendNewPolls)return;var r=o.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){fb.core.util.log("Long-poll script failed to load: "+e),o.sendNewPolls=!1,o.close()},o.myIFrame.doc.body.appendChild(r)}catch(e){}},Math.floor(1))}},"undefined"!=typeof NODE_CLIENT&&NODE_CLIENT&&(FirebaseIFrameScriptHolder.request=null,FirebaseIFrameScriptHolder.nodeRestRequest=function(e,t){FirebaseIFrameScriptHolder.request||(FirebaseIFrameScriptHolder.request=require("request")),FirebaseIFrameScriptHolder.request(e,function(o,r,n){if(o)throw"Rest request for "+e.url+" failed.";t&&t(n)})},FirebaseIFrameScriptHolder.prototype.doNodeLongPoll=function(e,t){var o=this;FirebaseIFrameScriptHolder.nodeRestRequest({url:e,forever:!0},function(e){o.evalBody(e),t()})},FirebaseIFrameScriptHolder.prototype.evalBody=function(body){eval("var jsonpCB = function("+FIREBASE_LONGPOLL_COMMAND_CB_NAME+", "+FIREBASE_LONGPOLL_DATA_CB_NAME+") {"+body+"}"),jsonpCB(this.commandCB,this.onMessageCB)}),goog.provide("fb.realtime.WebSocketConnection"),goog.require("fb.constants"),goog.require("fb.core.stats.StatsManager"),goog.require("fb.core.storage"),goog.require("fb.core.util"),goog.require("fb.realtime.Constants"),goog.require("fb.realtime.Transport"),goog.require("fb.util.json");var WEBSOCKET_MAX_FRAME_SIZE=16384,WEBSOCKET_KEEPALIVE_INTERVAL=45e3;fb.WebSocket=null,NODE_CLIENT?(goog.require("fb.core.util.NodePatches"),fb.WebSocket=require("faye-websocket").Client):"undefined"!=typeof MozWebSocket?fb.WebSocket=MozWebSocket:"undefined"!=typeof WebSocket&&(fb.WebSocket=WebSocket),
fb.realtime.WebSocketConnection=function(e,t,o,r){this.connId=e,this.log_=fb.core.util.logWrapper(this.connId),this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.stats_=fb.core.stats.StatsManager.getCollection(t),this.connURL=this.connectionURL_(t,o,r)},fb.realtime.WebSocketConnection.prototype.connectionURL_=function(e,t,o){var r={};return r[fb.realtime.Constants.VERSION_PARAM]=fb.realtime.Constants.PROTOCOL_VERSION,!NODE_CLIENT&&"undefined"!=typeof location&&location.href&&location.href.indexOf(fb.realtime.Constants.FORGE_DOMAIN)!==-1&&(r[fb.realtime.Constants.REFERER_PARAM]=fb.realtime.Constants.FORGE_REF),t&&(r[fb.realtime.Constants.TRANSPORT_SESSION_PARAM]=t),o&&(r[fb.realtime.Constants.LAST_SESSION_PARAM]=o),e.connectionURL(fb.realtime.Constants.WEBSOCKET,r)},fb.realtime.WebSocketConnection.prototype.open=function(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,fb.core.storage.PersistentStorage.set("previous_websocket_failure",!0);try{if(NODE_CLIENT){var o={headers:{"User-Agent":"Firebase/"+fb.realtime.Constants.PROTOCOL_VERSION+"/"+CLIENT_VERSION+"/"+process.platform+"/Node"}};this.mySock=new fb.WebSocket(this.connURL,[],o)}else this.mySock=new fb.WebSocket(this.connURL)}catch(e){this.log_("Error instantiating WebSocket.");var r=e.message||e.data;return r&&this.log_(r),void this.onClosed_()}var n=this;this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(e){n.handleIncomingFrame(e)},this.mySock.onerror=function(e){n.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&n.log_(t),n.onClosed_()}},fb.realtime.WebSocketConnection.prototype.start=function(){},fb.realtime.WebSocketConnection.forceDisallow=function(){fb.realtime.WebSocketConnection.forceDisallow_=!0},fb.realtime.WebSocketConnection.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var t=/Android ([0-9]{0,}\.[0-9]{0,})/,o=navigator.userAgent.match(t);o&&o.length>1&&parseFloat(o[1])<4.4&&(e=!0)}return!e&&null!==fb.WebSocket&&!fb.realtime.WebSocketConnection.forceDisallow_},fb.realtime.WebSocketConnection.responsesRequiredToBeHealthy=2,fb.realtime.WebSocketConnection.healthyTimeout=3e4,fb.realtime.WebSocketConnection.previouslyFailed=function(){return fb.core.storage.PersistentStorage.isInMemoryStorage||fb.core.storage.PersistentStorage.get("previous_websocket_failure")===!0},fb.realtime.WebSocketConnection.prototype.markConnectionHealthy=function(){fb.core.storage.PersistentStorage.remove("previous_websocket_failure")},fb.realtime.WebSocketConnection.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length==this.totalFrames){var t=this.frames.join("");this.frames=null;var o=fb.util.json.eval(t);this.onMessage(o)}},fb.realtime.WebSocketConnection.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},fb.realtime.WebSocketConnection.prototype.extractFrameCount_=function(e){if(fb.core.util.assert(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},fb.realtime.WebSocketConnection.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var o=this.extractFrameCount_(t);null!==o&&this.appendFrame_(o)}}},fb.realtime.WebSocketConnection.prototype.send=function(e){this.resetKeepAlive();var t=fb.util.json.stringify(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var o=fb.core.util.splitStringBySize(t,WEBSOCKET_MAX_FRAME_SIZE);o.length>1&&this.sendString_(String(o.length));for(var r=0;r<o.length;r++)this.sendString_(o[r])},fb.realtime.WebSocketConnection.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},fb.realtime.WebSocketConnection.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},fb.realtime.WebSocketConnection.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},fb.realtime.WebSocketConnection.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()},Math.floor(WEBSOCKET_KEEPALIVE_INTERVAL))},fb.realtime.WebSocketConnection.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(goog.bind(this.onClosed_,this),0)}},goog.require("fb.constants"),goog.require("fb.realtime.BrowserPollConnection"),goog.require("fb.realtime.Transport"),goog.provide("fb.realtime.TransportManager"),goog.require("fb.realtime.WebSocketConnection"),fb.realtime.TransportManager=function(e){this.initTransports_(e)},fb.realtime.TransportManager.ALL_TRANSPORTS=[fb.realtime.BrowserPollConnection,fb.realtime.WebSocketConnection],fb.realtime.TransportManager.prototype.initTransports_=function(e){var t=fb.realtime.WebSocketConnection&&fb.realtime.WebSocketConnection.isAvailable(),o=t&&!fb.realtime.WebSocketConnection.previouslyFailed();if(e.webSocketOnly&&(t||fb.core.util.warn("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[fb.realtime.WebSocketConnection];else{var r=this.transports_=[];fb.core.util.each(fb.realtime.TransportManager.ALL_TRANSPORTS,function(e,t){t&&t.isAvailable()&&r.push(t)})}},fb.realtime.TransportManager.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},fb.realtime.TransportManager.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},goog.provide("fb.realtime.Connection"),goog.require("fb.core.storage"),goog.require("fb.core.util"),goog.require("fb.realtime.Constants"),goog.require("fb.realtime.TransportManager");var UPGRADE_TIMEOUT=6e4,DELAY_BEFORE_SENDING_EXTRA_REQUESTS=5e3,BYTES_SENT_HEALTHY_OVERRIDE=10240,BYTES_RECEIVED_HEALTHY_OVERRIDE=102400,REALTIME_STATE_CONNECTING=0,REALTIME_STATE_CONNECTED=1,REALTIME_STATE_DISCONNECTED=2,MESSAGE_TYPE="t",MESSAGE_DATA="d",CONTROL_SHUTDOWN="s",CONTROL_RESET="r",CONTROL_ERROR="e",CONTROL_PONG="o",SWITCH_ACK="a",END_TRANSMISSION="n",PING="p",SERVER_HELLO="h";fb.realtime.Connection=function(e,t,o,r,n,i,a){this.id=e,this.log_=fb.core.util.logWrapper("c:"+this.id+":"),this.onMessage_=o,this.onReady_=r,this.onDisconnect_=n,this.onKill_=i,this.repoInfo_=t,this.pendingDataMessages=[],this.connectionCount=0,this.transportManager_=new fb.realtime.TransportManager(t),this.state_=REALTIME_STATE_CONNECTING,this.lastSessionId=a,this.log_("Connection created"),this.start_()},fb.realtime.Connection.prototype.start_=function(){var e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,(void 0),this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var t=this.connReceiver_(this.conn_),o=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1;var r=this;setTimeout(function(){r.conn_&&r.conn_.open(t,o)},Math.floor(0));var n=e.healthyTimeout||0;n>0&&(this.healthyTimeout_=setTimeout(function(){r.healthyTimeout_=null,r.isHealthy_||(r.conn_&&r.conn_.bytesReceived>BYTES_RECEIVED_HEALTHY_OVERRIDE?(r.log_("Connection exceeded healthy timeout but has received "+r.conn_.bytesReceived+" bytes.  Marking connection healthy."),r.isHealthy_=!0,r.conn_.markConnectionHealthy()):r.conn_&&r.conn_.bytesSent>BYTES_SENT_HEALTHY_OVERRIDE?r.log_("Connection exceeded healthy timeout but has sent "+r.conn_.bytesSent+" bytes.  Leaving connection alive."):(r.log_("Closing unhealthy connection after timeout."),r.close()))},Math.floor(n)))},fb.realtime.Connection.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},fb.realtime.Connection.prototype.disconnReceiver_=function(e){var t=this;return function(o){e===t.conn_?t.onConnectionLost_(o):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},fb.realtime.Connection.prototype.connReceiver_=function(e){var t=this;return function(o){t.state_!=REALTIME_STATE_DISCONNECTED&&(e===t.rx_?t.onPrimaryMessageReceived_(o):e===t.secondaryConn_?t.onSecondaryMessageReceived_(o):t.log_("message on old connection"))}},fb.realtime.Connection.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)},fb.realtime.Connection.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},fb.realtime.Connection.prototype.onSecondaryControl_=function(e){if(MESSAGE_TYPE in e){var t=e[MESSAGE_TYPE];t===SWITCH_ACK?this.upgradeIfSecondaryHealthy_():t===CONTROL_RESET?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):t===CONTROL_PONG&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},fb.realtime.Connection.prototype.onSecondaryMessageReceived_=function(e){var t=fb.core.util.requireKey("t",e),o=fb.core.util.requireKey("d",e);if("c"==t)this.onSecondaryControl_(o);else{if("d"!=t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(o)}},fb.realtime.Connection.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:PING,d:{}}}))},fb.realtime.Connection.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:SWITCH_ACK,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:END_TRANSMISSION,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},fb.realtime.Connection.prototype.onPrimaryMessageReceived_=function(e){var t=fb.core.util.requireKey("t",e),o=fb.core.util.requireKey("d",e);"c"==t?this.onControl_(o):"d"==t&&this.onDataMessage_(o)},fb.realtime.Connection.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},fb.realtime.Connection.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},fb.realtime.Connection.prototype.onControl_=function(e){var t=fb.core.util.requireKey(MESSAGE_TYPE,e);if(MESSAGE_DATA in e){var o=e[MESSAGE_DATA];if(t===SERVER_HELLO)this.onHandshake_(o);else if(t===END_TRANSMISSION){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===CONTROL_SHUTDOWN?this.onConnectionShutdown_(o):t===CONTROL_RESET?this.onReset_(o):t===CONTROL_ERROR?fb.core.util.error("Server Error: "+o):t===CONTROL_PONG?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):fb.core.util.error("Unknown control packet command: "+t)}},fb.realtime.Connection.prototype.onHandshake_=function(e){var t=e.ts,o=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.updateHost(r),this.state_==REALTIME_STATE_CONNECTING&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),fb.realtime.Constants.PROTOCOL_VERSION!==o&&fb.core.util.warn("Protocol version mismatch detected"),this.tryStartUpgrade_())},fb.realtime.Connection.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},fb.realtime.Connection.prototype.startUpgrade_=function(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var t=this.connReceiver_(this.secondaryConn_),o=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,o);var r=this;setTimeout(function(){r.secondaryConn_&&(r.log_("Timed out trying to upgrade."),r.secondaryConn_.close())},Math.floor(UPGRADE_TIMEOUT))},fb.realtime.Connection.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.updateHost(e),this.state_===REALTIME_STATE_CONNECTED?this.close():(this.closeConnections_(),this.start_())},fb.realtime.Connection.prototype.onConnectionEstablished_=function(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=REALTIME_STATE_CONNECTED,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null);var o=this;0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):setTimeout(function(){o.sendPingOnPrimaryIfNecessary_()},Math.floor(DELAY_BEFORE_SENDING_EXTRA_REQUESTS))},fb.realtime.Connection.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||this.state_!==REALTIME_STATE_CONNECTED||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:PING,d:{}}}))},fb.realtime.Connection.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},fb.realtime.Connection.prototype.onConnectionLost_=function(e){this.conn_=null,e||this.state_!==REALTIME_STATE_CONNECTING?this.state_===REALTIME_STATE_CONNECTED&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(fb.core.storage.PersistentStorage.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},fb.realtime.Connection.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},fb.realtime.Connection.prototype.sendData_=function(e){if(this.state_!==REALTIME_STATE_CONNECTED)throw"Connection is not connected";this.tx_.send(e)},fb.realtime.Connection.prototype.close=function(){this.state_!==REALTIME_STATE_DISCONNECTED&&(this.log_("Closing realtime connection."),this.state_=REALTIME_STATE_DISCONNECTED,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},fb.realtime.Connection.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},goog.provide("fb.core.PersistentConnection"),goog.require("fb.core.ServerActions"),goog.require("fb.core.util"),goog.require("fb.core.util.OnlineMonitor"),goog.require("fb.core.util.VisibilityMonitor"),goog.require("fb.login.util.environment"),goog.require("fb.realtime.Connection"),goog.require("fb.util.json"),goog.require("fb.util.jwt");var RECONNECT_MIN_DELAY=1e3,RECONNECT_MAX_DELAY_DEFAULT=3e5,RECONNECT_MAX_DELAY_FOR_ADMINS=3e4,RECONNECT_DELAY_MULTIPLIER=1.3,RECONNECT_DELAY_RESET_TIMEOUT=3e4;fb.core.PersistentConnection=goog.defineClass(null,{constructor:function(e,t,o,r){this.id=fb.core.PersistentConnection.nextPersistentConnectionId_++,this.log_=fb.core.util.logWrapper("p:"+this.id+":"),this.interrupted_=!1,this.killed_=!1,this.listens_={},this.outstandingPuts_=[],this.outstandingPutCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=RECONNECT_MIN_DELAY,this.maxReconnectDelay_=RECONNECT_MAX_DELAY_DEFAULT,this.onDataUpdate_=t,this.onConnectStatus_=o,this.onServerInfoUpdate_=r,this.repoInfo_=e,this.securityDebugCallback_=null,this.lastSessionId=null,this.realtime_=null,this.credential_=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,this.scheduleConnect_(0),fb.core.util.VisibilityMonitor.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&fb.core.util.OnlineMonitor.getInstance().on("online",this.onOnline_,this)},statics:{nextPersistentConnectionId_:0,nextConnectionId_:0},sendRequest:function(e,t,o){var r=++this.requestNumber_,n={r:r,a:e,b:t};this.log_(fb.util.json.stringify(n)),fb.core.util.assert(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(n),o&&(this.requestCBHash_[r]=o)},listen:function(e,t,o,r){var n=e.queryIdentifier(),i=e.path.toString();this.log_("Listen called for "+i+" "+n),this.listens_[i]=this.listens_[i]||{},fb.core.util.assert(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),fb.core.util.assert(!this.listens_[i][n],"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:t,query:e,tag:o};this.listens_[i][n]=a,this.connected_&&this.sendListen_(a)},sendListen_:function(e){var t=e.query,o=t.path.toString(),r=t.queryIdentifier(),n=this;this.log_("Listen on "+o+" for "+r);var i={p:o},a="q";e.tag&&(i.q=t.queryObject(),i.t=e.tag),i.h=e.hashFn(),this.sendRequest(a,i,function(i){var a=i.d,s=i.s;n.warnOnListenWarnings_(a,t);var l=n.listens_[o]&&n.listens_[o][r];l===e&&(n.log_("listen response",i),"ok"!==s&&n.removeListen_(o,r),e.onComplete&&e.onComplete(s,a))})},warnOnListenWarnings_:function(e,t){if(e&&"object"==typeof e&&fb.util.obj.contains(e,"w")){var o=fb.util.obj.get(e,"w");if(goog.isArray(o)&&goog.array.contains(o,"no_index")){var r='".indexOn": "'+t.getQueryParams().getIndex().toString()+'"',n=t.path.toString();fb.core.util.warn("Using an unspecified index. Consider adding "+r+" at "+n+" to your security rules for better performance")}}},auth:function(e,t,o){this.credential_={cred:e,firstRequestSent:!1,callback:t,cancelCallback:o},this.log_("Authenticating using credential: "+e),this.tryAuth(),this.reduceReconnectDelayIfAdminCredential_(e)},reduceReconnectDelayIfAdminCredential_:function(e){var t=40==e.length;(t||fb.util.jwt.isAdmin(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=RECONNECT_MAX_DELAY_FOR_ADMINS)},unauth:function(e){this.credential_=null,this.connected_&&this.sendRequest("unauth",{},function(t){var o=t.s,r=t.d;e(o,r)})},tryAuth:function(){var e=this.credential_,t=this;if(this.connected_&&e){var o={cred:e.cred};this.sendRequest("auth",o,function(o){var r=o.s,n=o.d||"error";"ok"!==r&&t.credential_===e&&(t.credential_=null),e.firstRequestSent?"ok"!==r&&e.cancelCallback&&e.cancelCallback(r,n):(e.firstRequestSent=!0,e.callback&&e.callback(r,n))})}},unlisten:function(e,t){var o=e.path.toString(),r=e.queryIdentifier();this.log_("Unlisten called for "+o+" "+r),fb.core.util.assert(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query");var n=this.removeListen_(o,r);n&&this.connected_&&this.sendUnlisten_(o,r,e.queryObject(),t)},sendUnlisten_:function(e,t,o,r){this.log_("Unlisten on "+e+" for "+t);var n={p:e},i="n";r&&(n.q=o,n.t=r),this.sendRequest(i,n)},onDisconnectPut:function(e,t,o){this.connected_?this.sendOnDisconnect_("o",e,t,o):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:o})},onDisconnectMerge:function(e,t,o){this.connected_?this.sendOnDisconnect_("om",e,t,o):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:o})},onDisconnectCancel:function(e,t){this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},sendOnDisconnect_:function(e,t,o,r){var n=this,i={p:t,d:o};n.log_("onDisconnect "+e,i),this.sendRequest(e,i,function(e){r&&setTimeout(function(){r(e.s,e.d)},Math.floor(0))})},put:function(e,t,o,r){this.putInternal("p",e,t,o,r)},merge:function(e,t,o,r){this.putInternal("m",e,t,o,r)},putInternal:function(e,t,o,r,n){var i={p:t,d:o};goog.isDef(n)&&(i.h=n),this.outstandingPuts_.push({action:e,request:i,onComplete:r}),this.outstandingPutCount_++;var a=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(a):this.log_("Buffering put: "+t)},sendPut_:function(e){var t=this,o=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,n=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(o,r,function(r){t.log_(o+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),n&&n(r.s,r.d)})},reportStats:function(e){if(this.connected_){var t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,function(e){var t=e.s;if("ok"!==t){var o=e.d;this.log_("reportStats","Error sending stats: "+o)}})}},onDataMessage_:function(e){if("r"in e){this.log_("from server: "+fb.util.json.stringify(e));var t=e.r,o=this.requestCBHash_[t];o&&(delete this.requestCBHash_[t],o(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},onDataPush_:function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):fb.core.util.error("Unrecognized action received from server: "+fb.util.json.stringify(e)+"\nAre you using the latest client?")},onReady_:function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},scheduleConnect_:function(e){fb.core.util.assert(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_);var t=this;this.establishConnectionTimer_=setTimeout(function(){t.establishConnectionTimer_=null,t.establishConnection_()},Math.floor(e))},onVisible_:function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},onOnline_:function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},onRealtimeDisconnect_:function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){var e=(new Date).getTime()-this.lastConnectionEstablishedTime_;e>RECONNECT_DELAY_RESET_TIMEOUT&&(this.reconnectDelay_=RECONNECT_MIN_DELAY),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var t=(new Date).getTime()-this.lastConnectionAttemptTime_,o=Math.max(0,this.reconnectDelay_-t);o=Math.random()*o,this.log_("Trying to reconnect in "+o+"ms"),this.scheduleConnect_(o),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*RECONNECT_DELAY_MULTIPLIER)}this.onConnectStatus_(!1)},establishConnection_:function(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var e=goog.bind(this.onDataMessage_,this),t=goog.bind(this.onReady_,this),o=goog.bind(this.onRealtimeDisconnect_,this),r=this.id+":"+fb.core.PersistentConnection.nextConnectionId_++,n=this,i=this.lastSessionId;this.realtime_=new fb.realtime.Connection(r,this.repoInfo_,e,t,o,function(e){fb.core.util.warn(e+" ("+n.repoInfo_.toString()+")"),n.killed_=!0},i)}},interrupt:function(){this.interrupted_=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},resume:function(){this.interrupted_=!1,this.reconnectDelay_=RECONNECT_MIN_DELAY,this.realtime_||this.scheduleConnect_(0)},handleTimestamp_:function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},cancelSentTransactions_:function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},onListenRevoked_:function(e,t){var o;o=t?goog.array.map(t,function(e){return fb.core.util.ObjectToUniqueKey(e)}).join("$"):"default";var r=this.removeListen_(e,o);r&&r.onComplete&&r.onComplete("permission_denied")},removeListen_:function(e,t){var o,r=new fb.core.util.Path(e).toString();return goog.isDef(this.listens_[r])?(o=this.listens_[r][t],delete this.listens_[r][t],0===goog.object.getCount(this.listens_[r])&&delete this.listens_[r]):o=void 0,o},onAuthRevoked_:function(e,t){var o=this.credential_;this.credential_=null,o&&o.cancelCallback&&o.cancelCallback(e,t)},onSecurityDebugPacket_:function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&"undefined"!=typeof console&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))},restoreState_:function(){this.tryAuth();var e=this;goog.object.forEach(this.listens_,function(t,o){goog.object.forEach(t,function(t){e.sendListen_(t)})});for(var t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){var o=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(o.action,o.pathString,o.data,o.onComplete)}},sendConnectStats_:function(){var e={};e["sdk.js."+CLIENT_VERSION.replace(/\./g,"-")]=1,fb.login.util.environment.isMobileCordova()?e["framework.cordova"]=1:fb.login.util.environment.isReactNative()&&(e["framework.reactnative"]=1),this.reportStats(e)},shouldReconnect_:function(){var e=fb.core.util.OnlineMonitor.getInstance().currentlyOnline();return!this.killed_&&!this.interrupted_&&e}}),goog.provide("fb.api.INTERNAL"),goog.require("fb.core.PersistentConnection"),goog.require("fb.realtime.Connection"),goog.require("fb.login.transports.PopupReceiver"),goog.require("fb.login.Constants"),fb.api.INTERNAL={},fb.api.INTERNAL.forceLongPolling=function(){fb.realtime.WebSocketConnection.forceDisallow(),fb.realtime.BrowserPollConnection.forceAllow()},goog.exportProperty(fb.api.INTERNAL,"forceLongPolling",fb.api.INTERNAL.forceLongPolling),fb.api.INTERNAL.forceWebSockets=function(){fb.realtime.BrowserPollConnection.forceDisallow()},goog.exportProperty(fb.api.INTERNAL,"forceWebSockets",fb.api.INTERNAL.forceWebSockets),fb.api.INTERNAL.isWebSocketsAvailable=function(){return fb.realtime.WebSocketConnection.isAvailable()},goog.exportProperty(fb.api.INTERNAL,"isWebSocketsAvailable",fb.api.INTERNAL.isWebSocketsAvailable),fb.api.INTERNAL.setSecurityDebugCallback=function(e,t){e.repo.persistentConnection_.securityDebugCallback_=t},goog.exportProperty(fb.api.INTERNAL,"setSecurityDebugCallback",fb.api.INTERNAL.setSecurityDebugCallback),fb.api.INTERNAL.stats=function(e,t){e.repo.stats(t)},goog.exportProperty(fb.api.INTERNAL,"stats",fb.api.INTERNAL.stats),fb.api.INTERNAL.statsIncrementCounter=function(e,t){e.repo.statsIncrementCounter(t)},goog.exportProperty(fb.api.INTERNAL,"statsIncrementCounter",fb.api.INTERNAL.statsIncrementCounter),fb.api.INTERNAL.dataUpdateCount=function(e){return e.repo.dataUpdateCount},goog.exportProperty(fb.api.INTERNAL,"dataUpdateCount",fb.api.INTERNAL.dataUpdateCount),fb.api.INTERNAL.interceptServerData=function(e,t){return e.repo.interceptServerData_(t)},goog.exportProperty(fb.api.INTERNAL,"interceptServerData",fb.api.INTERNAL.interceptServerData),fb.api.INTERNAL.onLoginPopupOpen=function(e){new fb.login.transports.PopupReceiver(e)},goog.exportProperty(fb.api.INTERNAL,"onPopupOpen",fb.api.INTERNAL.onLoginPopupOpen),fb.api.INTERNAL.setAuthenticationServer=function(e){fb.login.Constants.SERVER_HOST=e},goog.exportProperty(fb.api.INTERNAL,"setAuthenticationServer",fb.api.INTERNAL.setAuthenticationServer),goog.provide("fb.api.TransactionResult"),fb.api.TransactionResult=function(e,t){this.committed=e,this.snapshot=t},goog.provide("fb.api.OnDisconnect"),goog.require("fb.core.util"),goog.require("fb.core.util.validation"),goog.require("fb.util.promise.Deferred"),goog.require("fb.util.validation"),fb.api.OnDisconnect=function(e,t){this.repo_=e,this.path_=t},fb.api.OnDisconnect.prototype.cancel=function(e){fb.util.validation.validateArgCount("Firebase.onDisconnect().cancel",0,1,arguments.length),fb.util.validation.validateCallback("Firebase.onDisconnect().cancel",1,e,!0);var t=new fb.util.promise.Deferred;return this.repo_.onDisconnectCancel(this.path_,t.wrapCallback(e)),t.promise},goog.exportProperty(fb.api.OnDisconnect.prototype,"cancel",fb.api.OnDisconnect.prototype.cancel),fb.api.OnDisconnect.prototype.remove=function(e){fb.util.validation.validateArgCount("Firebase.onDisconnect().remove",0,1,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.onDisconnect().remove",this.path_),fb.util.validation.validateCallback("Firebase.onDisconnect().remove",1,e,!0);var t=new fb.util.promise.Deferred;return this.repo_.onDisconnectSet(this.path_,null,t.wrapCallback(e)),t.promise},goog.exportProperty(fb.api.OnDisconnect.prototype,"remove",fb.api.OnDisconnect.prototype.remove),fb.api.OnDisconnect.prototype.set=function(e,t){fb.util.validation.validateArgCount("Firebase.onDisconnect().set",1,2,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.onDisconnect().set",this.path_),fb.core.util.validation.validateFirebaseDataArg("Firebase.onDisconnect().set",1,e,this.path_,!1),fb.util.validation.validateCallback("Firebase.onDisconnect().set",2,t,!0);var o=new fb.util.promise.Deferred;return this.repo_.onDisconnectSet(this.path_,e,o.wrapCallback(t)),o.promise},goog.exportProperty(fb.api.OnDisconnect.prototype,"set",fb.api.OnDisconnect.prototype.set),fb.api.OnDisconnect.prototype.setWithPriority=function(e,t,o){fb.util.validation.validateArgCount("Firebase.onDisconnect().setWithPriority",2,3,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.onDisconnect().setWithPriority",this.path_),fb.core.util.validation.validateFirebaseDataArg("Firebase.onDisconnect().setWithPriority",1,e,this.path_,!1),fb.core.util.validation.validatePriority("Firebase.onDisconnect().setWithPriority",2,t,!1),fb.util.validation.validateCallback("Firebase.onDisconnect().setWithPriority",3,o,!0);var r=new fb.util.promise.Deferred;return this.repo_.onDisconnectSetWithPriority(this.path_,e,t,r.wrapCallback(o)),r.promise},goog.exportProperty(fb.api.OnDisconnect.prototype,"setWithPriority",fb.api.OnDisconnect.prototype.setWithPriority),
fb.api.OnDisconnect.prototype.update=function(e,t){if(fb.util.validation.validateArgCount("Firebase.onDisconnect().update",1,2,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.onDisconnect().update",this.path_),goog.isArray(e)){for(var o={},r=0;r<e.length;++r)o[""+r]=e[r];e=o,fb.core.util.warn("Passing an Array to Firebase.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}fb.core.util.validation.validateFirebaseMergeDataArg("Firebase.onDisconnect().update",1,e,this.path_,!1),fb.util.validation.validateCallback("Firebase.onDisconnect().update",2,t,!0);var n=new fb.util.promise.Deferred;return this.repo_.onDisconnectUpdate(this.path_,e,n.wrapCallback(t)),n.promise},goog.exportProperty(fb.api.OnDisconnect.prototype,"update",fb.api.OnDisconnect.prototype.update),goog.provide("fb.api.DataSnapshot"),goog.require("fb.core.snap"),goog.require("fb.core.util.SortedMap"),goog.require("fb.core.util.validation"),fb.api.DataSnapshot=function(e,t,o){this.node_=e,this.query_=t,this.index_=o},fb.api.DataSnapshot.prototype.val=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.val",0,0,arguments.length),this.node_.val()},goog.exportProperty(fb.api.DataSnapshot.prototype,"val",fb.api.DataSnapshot.prototype.val),fb.api.DataSnapshot.prototype.exportVal=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},goog.exportProperty(fb.api.DataSnapshot.prototype,"exportVal",fb.api.DataSnapshot.prototype.exportVal),fb.api.DataSnapshot.prototype.exists=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},goog.exportProperty(fb.api.DataSnapshot.prototype,"exists",fb.api.DataSnapshot.prototype.exists),fb.api.DataSnapshot.prototype.child=function(e){fb.util.validation.validateArgCount("Firebase.DataSnapshot.child",0,1,arguments.length),goog.isNumber(e)&&(e=String(e)),fb.core.util.validation.validatePathString("Firebase.DataSnapshot.child",1,e,!1);var t=new fb.core.util.Path(e),o=this.query_.child(t);return new fb.api.DataSnapshot(this.node_.getChild(t),o,fb.core.snap.PriorityIndex)},goog.exportProperty(fb.api.DataSnapshot.prototype,"child",fb.api.DataSnapshot.prototype.child),fb.api.DataSnapshot.prototype.hasChild=function(e){fb.util.validation.validateArgCount("Firebase.DataSnapshot.hasChild",1,1,arguments.length),fb.core.util.validation.validatePathString("Firebase.DataSnapshot.hasChild",1,e,!1);var t=new fb.core.util.Path(e);return!this.node_.getChild(t).isEmpty()},goog.exportProperty(fb.api.DataSnapshot.prototype,"hasChild",fb.api.DataSnapshot.prototype.hasChild),fb.api.DataSnapshot.prototype.getPriority=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},goog.exportProperty(fb.api.DataSnapshot.prototype,"getPriority",fb.api.DataSnapshot.prototype.getPriority),fb.api.DataSnapshot.prototype.forEach=function(e){if(fb.util.validation.validateArgCount("Firebase.DataSnapshot.forEach",1,1,arguments.length),fb.util.validation.validateCallback("Firebase.DataSnapshot.forEach",1,e,!1),this.node_.isLeafNode())return!1;var t=this.node_,o=this;return!!t.forEachChild(this.index_,function(t,r){return e(new fb.api.DataSnapshot(r,o.query_.child(t),fb.core.snap.PriorityIndex))})},goog.exportProperty(fb.api.DataSnapshot.prototype,"forEach",fb.api.DataSnapshot.prototype.forEach),fb.api.DataSnapshot.prototype.hasChildren=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},goog.exportProperty(fb.api.DataSnapshot.prototype,"hasChildren",fb.api.DataSnapshot.prototype.hasChildren),fb.api.DataSnapshot.prototype.name=function(){return fb.core.util.warn("Firebase.DataSnapshot.name() being deprecated. Please use Firebase.DataSnapshot.key() instead."),fb.util.validation.validateArgCount("Firebase.DataSnapshot.name",0,0,arguments.length),this.key()},goog.exportProperty(fb.api.DataSnapshot.prototype,"name",fb.api.DataSnapshot.prototype.name),fb.api.DataSnapshot.prototype.key=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.key",0,0,arguments.length),this.query_.key()},goog.exportProperty(fb.api.DataSnapshot.prototype,"key",fb.api.DataSnapshot.prototype.key),fb.api.DataSnapshot.prototype.numChildren=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},goog.exportProperty(fb.api.DataSnapshot.prototype,"numChildren",fb.api.DataSnapshot.prototype.numChildren),fb.api.DataSnapshot.prototype.ref=function(){return fb.util.validation.validateArgCount("Firebase.DataSnapshot.ref",0,0,arguments.length),this.query_},goog.exportProperty(fb.api.DataSnapshot.prototype,"ref",fb.api.DataSnapshot.prototype.ref),goog.provide("fb.core.view.ChildEventRegistration"),goog.provide("fb.core.view.EventRegistration"),goog.provide("fb.core.view.ValueEventRegistration"),goog.require("fb.api.DataSnapshot"),goog.require("fb.core.util"),goog.require("fb.core.view.CancelEvent"),goog.require("fb.core.view.DataEvent"),goog.require("goog.object"),fb.core.view.EventRegistration=function(){},fb.core.view.EventRegistration.prototype.respondsTo,fb.core.view.EventRegistration.prototype.createEvent,fb.core.view.EventRegistration.prototype.getEventRunner,fb.core.view.EventRegistration.prototype.createCancelEvent,fb.core.view.EventRegistration.prototype.matches,fb.core.view.EventRegistration.prototype.hasAnyCallback,fb.core.view.ValueEventRegistration=function(e,t,o){this.callback_=e,this.cancelCallback_=t,this.context_=o||null},fb.core.view.ValueEventRegistration.prototype.respondsTo=function(e){return"value"===e},fb.core.view.ValueEventRegistration.prototype.createEvent=function(e,t){var o=t.getQueryParams().getIndex();return new fb.core.view.DataEvent("value",this,new fb.api.DataSnapshot(e.snapshotNode,t.ref(),o))},fb.core.view.ValueEventRegistration.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){fb.core.util.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var o=this.cancelCallback_;return function(){o.call(t,e.error)}}var r=this.callback_;return function(){r.call(t,e.snapshot)}},fb.core.view.ValueEventRegistration.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new fb.core.view.CancelEvent(this,e,t):null},fb.core.view.ValueEventRegistration.prototype.matches=function(e){return e instanceof fb.core.view.ValueEventRegistration&&(!e.callback_||!this.callback_||e.callback_===this.callback_&&e.context_===this.context_)},fb.core.view.ValueEventRegistration.prototype.hasAnyCallback=function(){return null!==this.callback_},fb.core.view.ChildEventRegistration=function(e,t,o){this.callbacks_=e,this.cancelCallback_=t,this.context_=o},fb.core.view.ChildEventRegistration.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,goog.object.containsKey(this.callbacks_,t)},fb.core.view.ChildEventRegistration.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new fb.core.view.CancelEvent(this,e,t):null},fb.core.view.ChildEventRegistration.prototype.createEvent=function(e,t){fb.core.util.assert(null!=e.childName,"Child events should have a childName.");var o=t.ref().child(e.childName),r=t.getQueryParams().getIndex();return new fb.core.view.DataEvent(e.type,this,new fb.api.DataSnapshot(e.snapshotNode,o,r),e.prevName)},fb.core.view.ChildEventRegistration.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){fb.core.util.assert(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var o=this.cancelCallback_;return function(){o.call(t,e.error)}}var r=this.callbacks_[e.eventType];return function(){r.call(t,e.snapshot,e.prevName)}},fb.core.view.ChildEventRegistration.prototype.matches=function(e){if(e instanceof fb.core.view.ChildEventRegistration){if(!this.callbacks_||!e.callbacks_)return!0;if(this.context_===e.context_){var t=goog.object.getCount(e.callbacks_),o=goog.object.getCount(this.callbacks_);if(t===o){if(1===t){var r=goog.object.getAnyKey(e.callbacks_),n=goog.object.getAnyKey(this.callbacks_);return!(n!==r||e.callbacks_[r]&&this.callbacks_[n]&&e.callbacks_[r]!==this.callbacks_[n])}return goog.object.every(this.callbacks_,function(t,o){return e.callbacks_[o]===t})}}}return!1},fb.core.view.ChildEventRegistration.prototype.hasAnyCallback=function(){return null!==this.callbacks_},goog.provide("fb.core.SyncPoint"),goog.require("fb.core.util"),goog.require("fb.core.util.ImmutableTree"),goog.require("fb.core.view.ViewCache"),goog.require("fb.core.view.EventRegistration"),goog.require("fb.core.view.View"),goog.require("goog.array"),fb.core.SyncPoint=function(){this.views_={}},fb.core.SyncPoint.prototype.isEmpty=function(){return goog.object.isEmpty(this.views_)},fb.core.SyncPoint.prototype.applyOperation=function(e,t,o){var r=e.source.queryId;if(null!==r){var n=fb.util.obj.get(this.views_,r);return fb.core.util.assert(null!=n,"SyncTree gave us an op for an invalid query."),n.applyOperation(e,t,o)}var i=[];return goog.object.forEach(this.views_,function(r){i=i.concat(r.applyOperation(e,t,o))}),i},fb.core.SyncPoint.prototype.addEventRegistration=function(e,t,o,r,n){var i=e.queryIdentifier(),a=fb.util.obj.get(this.views_,i);if(!a){var s=o.calcCompleteEventCache(n?r:null),l=!1;s?l=!0:r instanceof fb.core.snap.ChildrenNode?(s=o.calcCompleteEventChildren(r),l=!1):(s=fb.core.snap.EMPTY_NODE,l=!1);var g=new fb.core.view.ViewCache(new fb.core.view.CacheNode(s,l,(!1)),new fb.core.view.CacheNode(r,n,(!1)));a=new fb.core.view.View(e,g),this.views_[i]=a}return a.addEventRegistration(t),a.getInitialEvents(t)},fb.core.SyncPoint.prototype.removeEventRegistration=function(e,t,o){var r=e.queryIdentifier(),n=[],i=[],a=this.hasCompleteView();if("default"===r){var s=this;goog.object.forEach(this.views_,function(e,r){i=i.concat(e.removeEventRegistration(t,o)),e.isEmpty()&&(delete s.views_[r],e.getQuery().getQueryParams().loadsAllData()||n.push(e.getQuery()))})}else{var l=fb.util.obj.get(this.views_,r);l&&(i=i.concat(l.removeEventRegistration(t,o)),l.isEmpty()&&(delete this.views_[r],l.getQuery().getQueryParams().loadsAllData()||n.push(l.getQuery())))}return a&&!this.hasCompleteView()&&n.push(new Firebase(e.repo,e.path)),{removed:n,events:i}},fb.core.SyncPoint.prototype.getQueryViews=function(){return goog.array.filter(goog.object.getValues(this.views_),function(e){return!e.getQuery().getQueryParams().loadsAllData()})},fb.core.SyncPoint.prototype.getCompleteServerCache=function(e){var t=null;return goog.object.forEach(this.views_,function(o){t=t||o.getCompleteServerCache(e)}),t},fb.core.SyncPoint.prototype.viewForQuery=function(e){var t=e.getQueryParams();if(t.loadsAllData())return this.getCompleteView();var o=e.queryIdentifier();return fb.util.obj.get(this.views_,o)},fb.core.SyncPoint.prototype.viewExistsForQuery=function(e){return null!=this.viewForQuery(e)},fb.core.SyncPoint.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},fb.core.SyncPoint.prototype.getCompleteView=function(){var e=goog.object.findValue(this.views_,function(e){return e.getQuery().getQueryParams().loadsAllData()});return e||null},goog.provide("fb.core.SyncTree"),goog.require("fb.core.Operation"),goog.require("fb.core.SyncPoint"),goog.require("fb.core.WriteTree"),goog.require("fb.core.util"),fb.core.ListenProvider,fb.core.SyncTree=function(e){this.syncPointTree_=fb.core.util.ImmutableTree.Empty,this.pendingWriteTree_=new fb.core.WriteTree,this.tagToQueryMap_={},this.queryToTagMap_={},this.listenProvider_=e},fb.core.SyncTree.prototype.applyUserOverwrite=function(e,t,o,r){return this.pendingWriteTree_.addOverwrite(e,t,o,r),r?this.applyOperationToSyncPoints_(new fb.core.operation.Overwrite(fb.core.OperationSource.User,e,t)):[]},fb.core.SyncTree.prototype.applyUserMerge=function(e,t,o){this.pendingWriteTree_.addMerge(e,t,o);var r=fb.core.util.ImmutableTree.fromObject(t);return this.applyOperationToSyncPoints_(new fb.core.operation.Merge(fb.core.OperationSource.User,e,r))},fb.core.SyncTree.prototype.ackUserWrite=function(e,t){t=t||!1;var o=this.pendingWriteTree_.getWrite(e),r=this.pendingWriteTree_.removeWrite(e);if(r){var n=fb.core.util.ImmutableTree.Empty;return null!=o.snap?n=n.set(fb.core.util.Path.Empty,!0):fb.util.obj.foreach(o.children,function(e,t){n=n.set(new fb.core.util.Path(e),t)}),this.applyOperationToSyncPoints_(new fb.core.operation.AckUserWrite(o.path,n,t))}return[]},fb.core.SyncTree.prototype.applyServerOverwrite=function(e,t){return this.applyOperationToSyncPoints_(new fb.core.operation.Overwrite(fb.core.OperationSource.Server,e,t))},fb.core.SyncTree.prototype.applyServerMerge=function(e,t){var o=fb.core.util.ImmutableTree.fromObject(t);return this.applyOperationToSyncPoints_(new fb.core.operation.Merge(fb.core.OperationSource.Server,e,o))},fb.core.SyncTree.prototype.applyListenComplete=function(e){return this.applyOperationToSyncPoints_(new fb.core.operation.ListenComplete(fb.core.OperationSource.Server,e))},fb.core.SyncTree.prototype.applyTaggedQueryOverwrite=function(e,t,o){var r=this.queryKeyForTag_(o);if(null!=r){var n=this.parseQueryKey_(r),i=n.path,a=n.queryId,s=fb.core.util.Path.relativePath(i,e),l=new fb.core.operation.Overwrite(fb.core.OperationSource.forServerTaggedQuery(a),s,t);return this.applyTaggedOperation_(i,a,l)}return[]},fb.core.SyncTree.prototype.applyTaggedQueryMerge=function(e,t,o){var r=this.queryKeyForTag_(o);if(r){var n=this.parseQueryKey_(r),i=n.path,a=n.queryId,s=fb.core.util.Path.relativePath(i,e),l=fb.core.util.ImmutableTree.fromObject(t),g=new fb.core.operation.Merge(fb.core.OperationSource.forServerTaggedQuery(a),s,l);return this.applyTaggedOperation_(i,a,g)}return[]},fb.core.SyncTree.prototype.applyTaggedListenComplete=function(e,t){var o=this.queryKeyForTag_(t);if(o){var r=this.parseQueryKey_(o),n=r.path,i=r.queryId,a=fb.core.util.Path.relativePath(n,e),s=new fb.core.operation.ListenComplete(fb.core.OperationSource.forServerTaggedQuery(i),a);return this.applyTaggedOperation_(n,i,s)}return[]},fb.core.SyncTree.prototype.addEventRegistration=function(e,t){var o=e.path,r=null,n=!1;this.syncPointTree_.foreachOnPath(o,function(e,t){var i=fb.core.util.Path.relativePath(e,o);r=r||t.getCompleteServerCache(i),n=n||t.hasCompleteView()});var i=this.syncPointTree_.get(o);i?(n=n||i.hasCompleteView(),r=r||i.getCompleteServerCache(fb.core.util.Path.Empty)):(i=new fb.core.SyncPoint,this.syncPointTree_=this.syncPointTree_.set(o,i));var a;if(null!=r)a=!0;else{a=!1,r=fb.core.snap.EMPTY_NODE;var s=this.syncPointTree_.subtree(o);s.foreachChild(function(e,t){var o=t.getCompleteServerCache(fb.core.util.Path.Empty);o&&(r=r.updateImmediateChild(e,o))})}var l=i.viewExistsForQuery(e);if(!l&&!e.getQueryParams().loadsAllData()){var g=this.makeQueryKey_(e);fb.core.util.assert(!goog.object.containsKey(this.queryToTagMap_,g),"View does not exist, but we have a tag");var u=fb.core.SyncTree.getNextQueryTag_();this.queryToTagMap_[g]=u,this.tagToQueryMap_["_"+u]=g}var c=this.pendingWriteTree_.childWrites(o),f=i.addEventRegistration(e,t,c,r,a);if(!l&&!n){var h=i.viewForQuery(e);f=f.concat(this.setupListener_(e,h))}return f},fb.core.SyncTree.prototype.removeEventRegistration=function(e,t,o){var r=e.path,n=this.syncPointTree_.get(r),i=[];if(n&&("default"===e.queryIdentifier()||n.viewExistsForQuery(e))){var a=n.removeEventRegistration(e,t,o);n.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(r));var s=a.removed;i=a.events;var l=-1!==goog.array.findIndex(s,function(e){return e.getQueryParams().loadsAllData()}),g=this.syncPointTree_.findOnPath(r,function(e,t){return t.hasCompleteView()});if(l&&!g){var u=this.syncPointTree_.subtree(r);if(!u.isEmpty())for(var c=this.collectDistinctViewsForSubTree_(u),f=0;f<c.length;++f){var h=c[f],p=h.getQuery(),d=this.createListenerForView_(h);this.listenProvider_.startListening(this.queryForListening_(p),this.tagForQuery_(p),d.hashFn,d.onComplete)}}if(!g&&s.length>0&&!o)if(l){var b=null;this.listenProvider_.stopListening(this.queryForListening_(e),b)}else{var _=this;goog.array.forEach(s,function(e){var t=(e.queryIdentifier(),_.queryToTagMap_[_.makeQueryKey_(e)]);_.listenProvider_.stopListening(_.queryForListening_(e),t)})}this.removeTags_(s)}return i},fb.core.SyncTree.prototype.calcCompleteEventCache=function(e,t){var o=!0,r=this.pendingWriteTree_,n=this.syncPointTree_.findOnPath(e,function(t,o){var r=fb.core.util.Path.relativePath(t,e),n=o.getCompleteServerCache(r);if(n)return n});return r.calcCompleteEventCache(e,n,t,o)},fb.core.SyncTree.prototype.collectDistinctViewsForSubTree_=function(e){return e.fold(function(e,t,o){if(t&&t.hasCompleteView()){var r=t.getCompleteView();return[r]}var n=[];return t&&(n=t.getQueryViews()),goog.object.forEach(o,function(e){n=n.concat(e)}),n})},fb.core.SyncTree.prototype.removeTags_=function(e){for(var t=0;t<e.length;++t){var o=e[t];if(!o.getQueryParams().loadsAllData()){var r=this.makeQueryKey_(o),n=this.queryToTagMap_[r];delete this.queryToTagMap_[r],delete this.tagToQueryMap_["_"+n]}}},fb.core.SyncTree.prototype.queryForListening_=function(e){return e.getQueryParams().loadsAllData()&&!e.getQueryParams().isDefault()?e.ref():e},fb.core.SyncTree.prototype.setupListener_=function(e,t){var o=e.path,r=this.tagForQuery_(e),n=this.createListenerForView_(t),i=this.listenProvider_.startListening(this.queryForListening_(e),r,n.hashFn,n.onComplete),a=this.syncPointTree_.subtree(o);if(r)fb.core.util.assert(!a.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var s=a.fold(function(e,t,o){if(!e.isEmpty()&&t&&t.hasCompleteView())return[t.getCompleteView().getQuery()];var r=[];return t&&(r=r.concat(goog.array.map(t.getQueryViews(),function(e){return e.getQuery()}))),goog.object.forEach(o,function(e){r=r.concat(e)}),r}),l=0;l<s.length;++l){var g=s[l];this.listenProvider_.stopListening(this.queryForListening_(g),this.tagForQuery_(g))}return i},fb.core.SyncTree.prototype.createListenerForView_=function(e){var t=this,o=e.getQuery(),r=this.tagForQuery_(o);return{hashFn:function(){var t=e.getServerCache()||fb.core.snap.EMPTY_NODE;return t.hash()},onComplete:function(e,n){if("ok"===e)return r?t.applyTaggedListenComplete(o.path,r):t.applyListenComplete(o.path);var i=fb.core.util.errorForServerCode(e,o);return t.removeEventRegistration(o,null,i)}}},fb.core.SyncTree.prototype.makeQueryKey_=function(e){return e.path.toString()+"$"+e.queryIdentifier()},fb.core.SyncTree.prototype.parseQueryKey_=function(e){var t=e.indexOf("$");return fb.core.util.assert(t!==-1&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new fb.core.util.Path(e.substr(0,t))}},fb.core.SyncTree.prototype.queryKeyForTag_=function(e){return goog.object.get(this.tagToQueryMap_,"_"+e)},fb.core.SyncTree.prototype.tagForQuery_=function(e){var t=this.makeQueryKey_(e);return fb.util.obj.get(this.queryToTagMap_,t)},fb.core.SyncTree.nextQueryTag_=1,fb.core.SyncTree.getNextQueryTag_=function(){return fb.core.SyncTree.nextQueryTag_++},fb.core.SyncTree.prototype.applyTaggedOperation_=function(e,t,o){var r=this.syncPointTree_.get(e);fb.core.util.assert(r,"Missing sync point for query tag that we're tracking");var n=this.pendingWriteTree_.childWrites(e);return r.applyOperation(o,n,null)},fb.core.SyncTree.prototype.applyOperationToSyncPoints_=function(e){return this.applyOperationHelper_(e,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(fb.core.util.Path.Empty))},fb.core.SyncTree.prototype.applyOperationHelper_=function(e,t,o,r){if(e.path.isEmpty())return this.applyOperationDescendantsHelper_(e,t,o,r);var n=t.get(fb.core.util.Path.Empty);null==o&&null!=n&&(o=n.getCompleteServerCache(fb.core.util.Path.Empty));var i=[],a=e.path.getFront(),s=e.operationForChild(a),l=t.children.get(a);if(l&&s){var g=o?o.getImmediateChild(a):null,u=r.child(a);i=i.concat(this.applyOperationHelper_(s,l,g,u))}return n&&(i=i.concat(n.applyOperation(e,r,o))),i},fb.core.SyncTree.prototype.applyOperationDescendantsHelper_=function(e,t,o,r){var n=t.get(fb.core.util.Path.Empty);null==o&&null!=n&&(o=n.getCompleteServerCache(fb.core.util.Path.Empty));var i=[],a=this;return t.children.inorderTraversal(function(t,n){var s=o?o.getImmediateChild(t):null,l=r.child(t),g=e.operationForChild(t);g&&(i=i.concat(a.applyOperationDescendantsHelper_(g,n,s,l)))}),n&&(i=i.concat(n.applyOperation(e,r,o))),i},goog.provide("fb.core.Repo"),goog.require("fb.api.DataSnapshot"),goog.require("fb.core.PersistentConnection"),goog.require("fb.core.ReadonlyRestClient"),goog.require("fb.core.SnapshotHolder"),goog.require("fb.core.SparseSnapshotTree"),goog.require("fb.core.SyncTree"),goog.require("fb.core.stats.StatsCollection"),goog.require("fb.core.stats.StatsListener"),goog.require("fb.core.stats.StatsManager"),goog.require("fb.core.stats.StatsReporter"),goog.require("fb.core.util"),goog.require("fb.core.util.ServerValues"),goog.require("fb.core.util.Tree"),goog.require("fb.core.view.EventQueue"),goog.require("fb.login.AuthenticationManager"),goog.require("fb.util.json"),goog.require("fb.util.jwt"),goog.require("goog.string"),fb.core.Repo=goog.defineClass(null,{constructor:function(e,t){this.repoInfo_=e,this.stats_=fb.core.stats.StatsManager.getCollection(e),this.statsListener_=null,this.eventQueue_=new fb.core.view.EventQueue,this.nextWriteId_=1,this.persistentConnection_=null,this.server_,t||fb.core.util.beingCrawled()?(this.server_=new fb.core.ReadonlyRestClient(this.repoInfo_,goog.bind(this.onDataUpdate_,this)),setTimeout(goog.bind(this.onConnectStatus_,this,!0),0)):(this.persistentConnection_=new fb.core.PersistentConnection(this.repoInfo_,goog.bind(this.onDataUpdate_,this),goog.bind(this.onConnectStatus_,this),goog.bind(this.onServerInfoUpdate_,this)),this.server_=this.persistentConnection_),this.statsReporter_=fb.core.stats.StatsManager.getOrCreateReporter(e,goog.bind(function(){return new fb.core.stats.StatsReporter(this.stats_,this.server_)},this)),this.transactions_init_(),this.infoData_=new fb.core.SnapshotHolder;var o=this;this.infoSyncTree_=new fb.core.SyncTree({startListening:function(e,t,r,n){var i=[],a=o.infoData_.getNode(e.path);return a.isEmpty()||(i=o.infoSyncTree_.applyServerOverwrite(e.path,a),setTimeout(function(){n("ok")},0)),i},stopListening:goog.nullFunction}),this.updateInfo_("connected",!1),this.onDisconnect_=new fb.core.SparseSnapshotTree,this.auth=new fb.login.AuthenticationManager(e,goog.bind(this.server_.auth,this.server_),goog.bind(this.server_.unauth,this.server_),goog.bind(this.onAuthStatus_,this)),this.dataUpdateCount=0,this.interceptServerDataCallback_=null,this.serverSyncTree_=new fb.core.SyncTree({startListening:function(e,t,r,n){return o.server_.listen(e,r,t,function(t,r){var i=n(t,r);o.eventQueue_.raiseEventsForChangedPath(e.path,i)}),[]},stopListening:function(e,t){o.server_.unlisten(e,t)}})},toString:function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},name:function(){return this.repoInfo_.namespace},serverTime:function(){var e=this.infoData_.getNode(new fb.core.util.Path(".info/serverTimeOffset")),t=e.val()||0;return(new Date).getTime()+t},generateServerValues:function(){return fb.core.util.ServerValues.generateWithValues({timestamp:this.serverTime()})},onDataUpdate_:function(e,t,o,r){this.dataUpdateCount++;var n=new fb.core.util.Path(e);t=this.interceptServerDataCallback_?this.interceptServerDataCallback_(e,t):t;var i=[];if(r)if(o){var a=goog.object.map(t,function(e){return fb.core.snap.NodeFromJSON(e)});i=this.serverSyncTree_.applyTaggedQueryMerge(n,a,r)}else{var s=fb.core.snap.NodeFromJSON(t);i=this.serverSyncTree_.applyTaggedQueryOverwrite(n,s,r)}else if(o){var l=goog.object.map(t,function(e){return fb.core.snap.NodeFromJSON(e)});i=this.serverSyncTree_.applyServerMerge(n,l)}else{var g=fb.core.snap.NodeFromJSON(t);i=this.serverSyncTree_.applyServerOverwrite(n,g)}var u=n;i.length>0&&(u=this.rerunTransactions_(n)),this.eventQueue_.raiseEventsForChangedPath(u,i)},interceptServerData_:function(e){this.interceptServerDataCallback_=e},onConnectStatus_:function(e){this.updateInfo_("connected",e),e===!1&&this.runOnDisconnectEvents_()},onServerInfoUpdate_:function(e){var t=this;fb.core.util.each(e,function(e,o){t.updateInfo_(o,e)})},onAuthStatus_:function(e){this.updateInfo_("authenticated",e)},updateInfo_:function(e,t){var o=new fb.core.util.Path("/.info/"+e),r=fb.core.snap.NodeFromJSON(t);this.infoData_.updateSnapshot(o,r);var n=this.infoSyncTree_.applyServerOverwrite(o,r);this.eventQueue_.raiseEventsForChangedPath(o,n)},getNextWriteId_:function(){return this.nextWriteId_++},setWithPriority:function(e,t,o,r){this.log_("set",{path:e.toString(),value:t,priority:o});var n=this.generateServerValues(),i=fb.core.snap.NodeFromJSON(t,o),a=fb.core.util.ServerValues.resolveDeferredValueSnapshot(i,n),s=this.getNextWriteId_(),l=this.serverSyncTree_.applyUserOverwrite(e,a,s,!0);this.eventQueue_.queueEvents(l);var g=this;this.server_.put(e.toString(),i.val(!0),function(t,o){var n="ok"===t;n||fb.core.util.warn("set at "+e+" failed: "+t);var i=g.serverSyncTree_.ackUserWrite(s,!n);g.eventQueue_.raiseEventsForChangedPath(e,i),g.callOnCompleteCallback(r,t,o)});var u=this.abortTransactions_(e);this.rerunTransactions_(u),this.eventQueue_.raiseEventsForChangedPath(u,[])},update:function(e,t,o){this.log_("update",{path:e.toString(),value:t});var r=!0,n=this.generateServerValues(),i={};if(goog.object.forEach(t,function(e,t){r=!1;var o=fb.core.snap.NodeFromJSON(e);i[t]=fb.core.util.ServerValues.resolveDeferredValueSnapshot(o,n)}),r)fb.core.util.log("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(o,"ok");else{var a=this.getNextWriteId_(),s=this.serverSyncTree_.applyUserMerge(e,i,a);this.eventQueue_.queueEvents(s);var l=this;this.server_.merge(e.toString(),t,function(t,r){var n="ok"===t;n||fb.core.util.warn("update at "+e+" failed: "+t);var i=l.serverSyncTree_.ackUserWrite(a,!n),s=e;i.length>0&&(s=l.rerunTransactions_(e)),l.eventQueue_.raiseEventsForChangedPath(s,i),l.callOnCompleteCallback(o,t,r)});var g=this.abortTransactions_(e);this.rerunTransactions_(g),this.eventQueue_.raiseEventsForChangedPath(e,[])}},runOnDisconnectEvents_:function(){this.log_("onDisconnectEvents");var e=this,t=this.generateServerValues(),o=fb.core.util.ServerValues.resolveDeferredValueTree(this.onDisconnect_,t),r=[];o.forEachTree(fb.core.util.Path.Empty,function(t,o){r=r.concat(e.serverSyncTree_.applyServerOverwrite(t,o));var n=e.abortTransactions_(t);e.rerunTransactions_(n)}),this.onDisconnect_=new fb.core.SparseSnapshotTree,this.eventQueue_.raiseEventsForChangedPath(fb.core.util.Path.Empty,r)},onDisconnectCancel:function(e,t){var o=this;this.server_.onDisconnectCancel(e.toString(),function(r,n){"ok"===r&&o.onDisconnect_.forget(e),o.callOnCompleteCallback(t,r,n)})},onDisconnectSet:function(e,t,o){var r=this,n=fb.core.snap.NodeFromJSON(t);this.server_.onDisconnectPut(e.toString(),n.val(!0),function(t,i){"ok"===t&&r.onDisconnect_.remember(e,n),r.callOnCompleteCallback(o,t,i)})},onDisconnectSetWithPriority:function(e,t,o,r){var n=this,i=fb.core.snap.NodeFromJSON(t,o);this.server_.onDisconnectPut(e.toString(),i.val(!0),function(t,o){"ok"===t&&n.onDisconnect_.remember(e,i),n.callOnCompleteCallback(r,t,o)})},onDisconnectUpdate:function(e,t,o){var r=!0;for(var n in t)r=!1;if(r)return fb.core.util.log("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(o,"ok");var i=this;this.server_.onDisconnectMerge(e.toString(),t,function(r,n){if("ok"===r)for(var a in t){var s=fb.core.snap.NodeFromJSON(t[a]);i.onDisconnect_.remember(e.child(a),s)}i.callOnCompleteCallback(o,r,n)})},addEventCallbackForQuery:function(e,t){var o;o=".info"===e.path.getFront()?this.infoSyncTree_.addEventRegistration(e,t):this.serverSyncTree_.addEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,o)},removeEventCallbackForQuery:function(e,t){var o;o=".info"===e.path.getFront()?this.infoSyncTree_.removeEventRegistration(e,t):this.serverSyncTree_.removeEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,o)},interrupt:function(){this.persistentConnection_&&this.persistentConnection_.interrupt()},resume:function(){this.persistentConnection_&&this.persistentConnection_.resume()},stats:function(e){if("undefined"!=typeof console){var t;e?(this.statsListener_||(this.statsListener_=new fb.core.stats.StatsListener(this.stats_)),t=this.statsListener_.get()):t=this.stats_.get();var o=goog.array.reduce(goog.object.getKeys(t),function(e,t,o,r){return Math.max(t.length,e)},0);for(var r in t){for(var n=t[r],i=r.length;i<o+2;i++)r+=" ";console.log(r+n)}}},statsIncrementCounter:function(e){this.stats_.incrementCounter(e),this.statsReporter_.includeStat(e)},log_:function(e){var t="";this.persistentConnection_&&(t=this.persistentConnection_.id+":"),fb.core.util.log(t,arguments)},callOnCompleteCallback:function(e,t,o){e&&fb.core.util.exceptionGuard(function(){if("ok"==t)e(null);else{var r=(t||"error").toUpperCase(),n=r;o&&(n+=": "+o);var i=new Error(n);i.code=r,e(i)}})}}),goog.provide("fb.core.Repo_transaction"),goog.require("fb.core.Repo"),goog.require("fb.core.snap.PriorityIndex"),goog.require("fb.core.util"),fb.core.TransactionStatus={RUN:1,SENT:2,COMPLETED:3,SENT_NEEDS_ABORT:4,NEEDS_ABORT:5},fb.core.Repo.MAX_TRANSACTION_RETRIES_=25,fb.core.Transaction,fb.core.Repo.prototype.transactions_init_=function(){this.transactionQueueTree_=new fb.core.util.Tree},fb.core.Repo.prototype.startTransaction=function(e,t,o,r){this.log_("transaction on "+e);var n=function(){},i=new Firebase(this,e);i.on("value",n);var a=function(){i.off("value",n)},s={path:e,update:t,onComplete:o,status:null,order:fb.core.util.LUIDGenerator(),applyLocally:r,retryCount:0,unwatcher:a,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},l=this.getLatestState_(e);s.currentInputSnapshot=l;var g=s.update(l.val());if(goog.isDef(g)){fb.core.util.validation.validateFirebaseData("transaction failed: Data returned ",g,s.path),s.status=fb.core.TransactionStatus.RUN;var u=this.transactionQueueTree_.subTree(e),c=u.getValue()||[];c.push(s),u.setValue(c);var f;if("object"==typeof g&&null!==g&&fb.util.obj.contains(g,".priority"))f=fb.util.obj.get(g,".priority"),fb.core.util.assert(fb.core.util.validation.isValidPriority(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else{var h=this.serverSyncTree_.calcCompleteEventCache(e)||fb.core.snap.EMPTY_NODE;f=h.getPriority().val()}f=f;var p=this.generateServerValues(),d=fb.core.snap.NodeFromJSON(g,f),b=fb.core.util.ServerValues.resolveDeferredValueSnapshot(d,p);s.currentOutputSnapshotRaw=d,s.currentOutputSnapshotResolved=b,s.currentWriteId=this.getNextWriteId_();var _=this.serverSyncTree_.applyUserOverwrite(e,b,s.currentWriteId,s.applyLocally);this.eventQueue_.raiseEventsForChangedPath(e,_),this.sendReadyTransactions_()}else if(s.unwatcher(),s.currentOutputSnapshotRaw=null,s.currentOutputSnapshotResolved=null,s.onComplete){var v=new fb.api.DataSnapshot(s.currentInputSnapshot,new Firebase(this,s.path),fb.core.snap.PriorityIndex);s.onComplete(null,!1,v)}},fb.core.Repo.prototype.getLatestState_=function(e,t){return this.serverSyncTree_.calcCompleteEventCache(e,t)||fb.core.snap.EMPTY_NODE},fb.core.Repo.prototype.sendReadyTransactions_=function(e){var t=e||this.transactionQueueTree_;if(e||this.pruneCompletedTransactionsBelowNode_(t),null!==t.getValue()){var o=this.buildTransactionQueue_(t);fb.core.util.assert(o.length>0,"Sending zero length transaction queue");
var r=goog.array.every(o,function(e){return e.status===fb.core.TransactionStatus.RUN});r&&this.sendTransactionQueue_(t.path(),o)}else if(t.hasChildren()){var n=this;t.forEachChild(function(e){n.sendReadyTransactions_(e)})}},fb.core.Repo.prototype.sendTransactionQueue_=function(e,t){for(var o=goog.array.map(t,function(e){return e.currentWriteId}),r=this.getLatestState_(e,o),n=r,i=r.hash(),a=0;a<t.length;a++){var s=t[a];fb.core.util.assert(s.status===fb.core.TransactionStatus.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),s.status=fb.core.TransactionStatus.SENT,s.retryCount++;var l=fb.core.util.Path.relativePath(e,s.path);n=n.updateChild(l,s.currentOutputSnapshotRaw)}var g=n.val(!0),u=e,c=this;this.server_.put(u.toString(),g,function(o){c.log_("transaction put response",{path:u.toString(),status:o});var r=[];if("ok"===o){var n=[];for(a=0;a<t.length;a++){if(t[a].status=fb.core.TransactionStatus.COMPLETED,r=r.concat(c.serverSyncTree_.ackUserWrite(t[a].currentWriteId)),t[a].onComplete){var i=t[a].currentOutputSnapshotResolved,s=new Firebase(c,t[a].path),l=new fb.api.DataSnapshot(i,s,fb.core.snap.PriorityIndex);n.push(goog.bind(t[a].onComplete,null,null,!0,l))}t[a].unwatcher()}for(c.pruneCompletedTransactionsBelowNode_(c.transactionQueueTree_.subTree(e)),c.sendReadyTransactions_(),c.eventQueue_.raiseEventsForChangedPath(e,r),a=0;a<n.length;a++)fb.core.util.exceptionGuard(n[a])}else{if("datastale"===o)for(a=0;a<t.length;a++)t[a].status===fb.core.TransactionStatus.SENT_NEEDS_ABORT?t[a].status=fb.core.TransactionStatus.NEEDS_ABORT:t[a].status=fb.core.TransactionStatus.RUN;else for(fb.core.util.warn("transaction at "+u.toString()+" failed: "+o),a=0;a<t.length;a++)t[a].status=fb.core.TransactionStatus.NEEDS_ABORT,t[a].abortReason=o;c.rerunTransactions_(e)}},i)},fb.core.Repo.prototype.rerunTransactions_=function(e){var t=this.getAncestorTransactionNode_(e),o=t.path(),r=this.buildTransactionQueue_(t);return this.rerunTransactionQueue_(r,o),o},fb.core.Repo.prototype.rerunTransactionQueue_=function(e,t){if(0!==e.length){for(var o=[],r=[],n=goog.array.filter(e,function(e){return e.status===fb.core.TransactionStatus.RUN}),i=goog.array.map(n,function(e){return e.currentWriteId}),a=0;a<e.length;a++){var s,l=e[a],g=fb.core.util.Path.relativePath(t,l.path),u=!1;if(fb.core.util.assert(null!==g,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===fb.core.TransactionStatus.NEEDS_ABORT)u=!0,s=l.abortReason,r=r.concat(this.serverSyncTree_.ackUserWrite(l.currentWriteId,!0));else if(l.status===fb.core.TransactionStatus.RUN)if(l.retryCount>=fb.core.Repo.MAX_TRANSACTION_RETRIES_)u=!0,s="maxretry",r=r.concat(this.serverSyncTree_.ackUserWrite(l.currentWriteId,!0));else{var c=this.getLatestState_(l.path,i);l.currentInputSnapshot=c;var f=e[a].update(c.val());if(goog.isDef(f)){fb.core.util.validation.validateFirebaseData("transaction failed: Data returned ",f,l.path);var h=fb.core.snap.NodeFromJSON(f),p="object"==typeof f&&null!=f&&fb.util.obj.contains(f,".priority");p||(h=h.updatePriority(c.getPriority()));var d=l.currentWriteId,b=this.generateServerValues(),_=fb.core.util.ServerValues.resolveDeferredValueSnapshot(h,b);l.currentOutputSnapshotRaw=h,l.currentOutputSnapshotResolved=_,l.currentWriteId=this.getNextWriteId_(),goog.array.remove(i,d),r=r.concat(this.serverSyncTree_.applyUserOverwrite(l.path,_,l.currentWriteId,l.applyLocally)),r=r.concat(this.serverSyncTree_.ackUserWrite(d,!0))}else u=!0,s="nodata",r=r.concat(this.serverSyncTree_.ackUserWrite(l.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(t,r),r=[],u&&(e[a].status=fb.core.TransactionStatus.COMPLETED,function(e){setTimeout(e,Math.floor(0))}(e[a].unwatcher),e[a].onComplete))if("nodata"===s){var v=new Firebase(this,e[a].path),y=e[a].currentInputSnapshot,m=new fb.api.DataSnapshot(y,v,fb.core.snap.PriorityIndex);o.push(goog.bind(e[a].onComplete,null,null,!1,m))}else o.push(goog.bind(e[a].onComplete,null,new Error(s),!1,null))}for(this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_),a=0;a<o.length;a++)fb.core.util.exceptionGuard(o[a]);this.sendReadyTransactions_()}},fb.core.Repo.prototype.getAncestorTransactionNode_=function(e){for(var t,o=this.transactionQueueTree_;null!==(t=e.getFront())&&null===o.getValue();)o=o.subTree(t),e=e.popFront();return o},fb.core.Repo.prototype.buildTransactionQueue_=function(e){var t=[];return this.aggregateTransactionQueuesForNode_(e,t),t.sort(function(e,t){return e.order-t.order}),t},fb.core.Repo.prototype.aggregateTransactionQueuesForNode_=function(e,t){var o=e.getValue();if(null!==o)for(var r=0;r<o.length;r++)t.push(o[r]);var n=this;e.forEachChild(function(e){n.aggregateTransactionQueuesForNode_(e,t)})},fb.core.Repo.prototype.pruneCompletedTransactionsBelowNode_=function(e){var t=e.getValue();if(t){for(var o=0,r=0;r<t.length;r++)t[r].status!==fb.core.TransactionStatus.COMPLETED&&(t[o]=t[r],o++);t.length=o,e.setValue(t.length>0?t:null)}var n=this;e.forEachChild(function(e){n.pruneCompletedTransactionsBelowNode_(e)})},fb.core.Repo.prototype.abortTransactions_=function(e){var t=this.getAncestorTransactionNode_(e).path(),o=this.transactionQueueTree_.subTree(e),r=this;return o.forEachAncestor(function(e){r.abortTransactionsOnNode_(e)}),this.abortTransactionsOnNode_(o),o.forEachDescendant(function(e){r.abortTransactionsOnNode_(e)}),t},fb.core.Repo.prototype.abortTransactionsOnNode_=function(e){var t=e.getValue();if(null!==t){for(var o=[],r=[],n=-1,i=0;i<t.length;i++)if(t[i].status===fb.core.TransactionStatus.SENT_NEEDS_ABORT);else if(t[i].status===fb.core.TransactionStatus.SENT)fb.core.util.assert(n===i-1,"All SENT items should be at beginning of queue."),n=i,t[i].status=fb.core.TransactionStatus.SENT_NEEDS_ABORT,t[i].abortReason="set";else if(fb.core.util.assert(t[i].status===fb.core.TransactionStatus.RUN,"Unexpected transaction status in abort"),t[i].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(t[i].currentWriteId,!0)),t[i].onComplete){var a=null;o.push(goog.bind(t[i].onComplete,null,new Error("set"),!1,a))}for(n===-1?e.setValue(null):t.length=n+1,this.eventQueue_.raiseEventsForChangedPath(e.path(),r),i=0;i<o.length;i++)fb.core.util.exceptionGuard(o[i])}},goog.provide("fb.core.RepoManager"),goog.require("fb.core.Repo"),goog.require("fb.core.Repo_transaction"),goog.require("fb.util.obj"),fb.core.RepoManager=goog.defineClass(null,{constructor:function(){this.repos_={},this.useRestClient_=!1},interrupt:function(){for(var e in this.repos_)this.repos_[e].interrupt()},resume:function(){for(var e in this.repos_)this.repos_[e].resume()},getRepo:function(e){var t=e.toString(),o=fb.util.obj.get(this.repos_,t);return o||(o=new fb.core.Repo(e,this.useRestClient_),this.repos_[t]=o),o},forceRestClient:function(){this.useRestClient_=!0}});goog.addSingletonGetter(fb.core.RepoManager);goog.exportProperty(fb.core.RepoManager.prototype,"interrupt",fb.core.RepoManager.prototype.interrupt),goog.exportProperty(fb.core.RepoManager.prototype,"resume",fb.core.RepoManager.prototype.resume),goog.provide("fb.api.Query"),goog.require("fb.core.snap.KeyIndex"),goog.require("fb.core.snap.PathIndex"),goog.require("fb.core.snap.PriorityIndex"),goog.require("fb.core.snap.ValueIndex"),goog.require("fb.core.util"),goog.require("fb.core.util.ObjectToUniqueKey"),goog.require("fb.core.util.Path"),goog.require("fb.core.util.validation"),goog.require("fb.core.view.ChildEventRegistration"),goog.require("fb.core.view.ValueEventRegistration"),goog.require("fb.util.promise"),goog.require("fb.util.promise.Deferred"),goog.require("fb.util.validation"),fb.api.Query=goog.defineClass(null,{constructor:function(e,t,o,r){this.repo=e,this.path=t,this.queryParams_=o,this.orderByCalled_=r},validateQueryEndpoints_:function(e){var t=null,o=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(o=e.getIndexEndValue()),e.getIndex()===fb.core.snap.KeyIndex){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",n="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(e.hasStart()){var i=e.getIndexStartName();if(i!=fb.core.util.MIN_NAME)throw new Error(r);if("string"!=typeof t)throw new Error(n)}if(e.hasEnd()){var a=e.getIndexEndName();if(a!=fb.core.util.MAX_NAME)throw new Error(r);if("string"!=typeof o)throw new Error(n)}}else if(e.getIndex()===fb.core.snap.PriorityIndex){if(null!=t&&!fb.core.util.validation.isValidPriority(t)||null!=o&&!fb.core.util.validation.isValidPriority(o))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(fb.core.util.assert(e.getIndex()instanceof fb.core.snap.PathIndex||e.getIndex()===fb.core.snap.ValueIndex,"unknown index type."),null!=t&&"object"==typeof t||null!=o&&"object"==typeof o)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},validateLimit_:function(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},validateNoPreviousOrderByCall_:function(e){if(this.orderByCalled_===!0)throw new Error(e+": You can't combine multiple orderBy calls.")},getQueryParams:function(){return this.queryParams_},ref:function(){return fb.util.validation.validateArgCount("Query.ref",0,0,arguments.length),new Firebase(this.repo,this.path)},on:function(e,t,o,r){fb.util.validation.validateArgCount("Query.on",2,4,arguments.length),fb.core.util.validation.validateEventType("Query.on",1,e,!1),fb.util.validation.validateCallback("Query.on",2,t,!1);var n=this.getCancelAndContextArgs_("Query.on",o,r);if("value"===e)this.onValueEvent(t,n.cancel,n.context);else{var i={};i[e]=t,this.onChildEvent(i,n.cancel,n.context)}return t},onValueEvent:function(e,t,o){var r=new fb.core.view.ValueEventRegistration(e,t||null,o||null);this.repo.addEventCallbackForQuery(this,r)},onChildEvent:function(e,t,o){var r=new fb.core.view.ChildEventRegistration(e,t,o);this.repo.addEventCallbackForQuery(this,r)},off:function(e,t,o){fb.util.validation.validateArgCount("Query.off",0,3,arguments.length),fb.core.util.validation.validateEventType("Query.off",1,e,!0),fb.util.validation.validateCallback("Query.off",2,t,!0),fb.util.validation.validateContextObject("Query.off",3,o,!0);var r=null,n=null;if("value"===e){var i=t||null;r=new fb.core.view.ValueEventRegistration(i,null,o||null)}else e&&(t&&(n={},n[e]=t),r=new fb.core.view.ChildEventRegistration(n,null,o||null));this.repo.removeEventCallbackForQuery(this,r)},once:function(e,t){fb.util.validation.validateArgCount("Query.once",1,4,arguments.length),fb.core.util.validation.validateEventType("Query.once",1,e,!1),fb.util.validation.validateCallback("Query.once",2,t,!0);var o=this.getCancelAndContextArgs_("Query.once",arguments[2],arguments[3]),r=this,n=!0,i=new fb.util.promise.Deferred;fb.util.promise.attachDummyErrorHandler(i.promise);var a=function(s){n&&(n=!1,r.off(e,a),t&&goog.bind(t,o.context)(s),i.resolve(s))};return this.on(e,a,function(t){r.off(e,a),o.cancel&&goog.bind(o.cancel,o.context)(t),i.reject(t)}),i.promise},limit:function(e){if(fb.core.util.warn("Query.limit() being deprecated. Please use Query.limitToFirst() or Query.limitToLast() instead."),fb.util.validation.validateArgCount("Query.limit",1,1,arguments.length),!goog.isNumber(e)||Math.floor(e)!==e||e<=0)throw new Error("Query.limit: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limit: Limit was already set (by another call to limit, limitToFirst, orlimitToLast.");var t=this.queryParams_.limit(e);return this.validateLimit_(t),new fb.api.Query(this.repo,this.path,t,this.orderByCalled_)},limitToFirst:function(e){if(fb.util.validation.validateArgCount("Query.limitToFirst",1,1,arguments.length),!goog.isNumber(e)||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new fb.api.Query(this.repo,this.path,this.queryParams_.limitToFirst(e),this.orderByCalled_)},limitToLast:function(e){if(fb.util.validation.validateArgCount("Query.limitToLast",1,1,arguments.length),!goog.isNumber(e)||Math.floor(e)!==e||e<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new fb.api.Query(this.repo,this.path,this.queryParams_.limitToLast(e),this.orderByCalled_)},orderByChild:function(e){if(fb.util.validation.validateArgCount("Query.orderByChild",1,1,arguments.length),"$key"===e)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===e)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===e)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');fb.core.util.validation.validatePathString("Query.orderByChild",1,e,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var t=new fb.core.util.Path(e);if(t.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var o=new fb.core.snap.PathIndex(t),r=this.queryParams_.orderBy(o);return this.validateQueryEndpoints_(r),new fb.api.Query(this.repo,this.path,r,(!0))},orderByKey:function(){fb.util.validation.validateArgCount("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var e=this.queryParams_.orderBy(fb.core.snap.KeyIndex);return this.validateQueryEndpoints_(e),new fb.api.Query(this.repo,this.path,e,(!0))},orderByPriority:function(){fb.util.validation.validateArgCount("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var e=this.queryParams_.orderBy(fb.core.snap.PriorityIndex);return this.validateQueryEndpoints_(e),new fb.api.Query(this.repo,this.path,e,(!0))},orderByValue:function(){fb.util.validation.validateArgCount("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var e=this.queryParams_.orderBy(fb.core.snap.ValueIndex);return this.validateQueryEndpoints_(e),new fb.api.Query(this.repo,this.path,e,(!0))},startAt:function(e,t){fb.util.validation.validateArgCount("Query.startAt",0,2,arguments.length),fb.core.util.validation.validateFirebaseDataArg("Query.startAt",1,e,this.path,!0),fb.core.util.validation.validateKey("Query.startAt",2,t,!0);var o=this.queryParams_.startAt(e,t);if(this.validateLimit_(o),this.validateQueryEndpoints_(o),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return goog.isDef(e)||(e=null,t=null),new fb.api.Query(this.repo,this.path,o,this.orderByCalled_)},endAt:function(e,t){fb.util.validation.validateArgCount("Query.endAt",0,2,arguments.length),fb.core.util.validation.validateFirebaseDataArg("Query.endAt",1,e,this.path,!0),fb.core.util.validation.validateKey("Query.endAt",2,t,!0);var o=this.queryParams_.endAt(e,t);if(this.validateLimit_(o),this.validateQueryEndpoints_(o),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt or equalTo).");return new fb.api.Query(this.repo,this.path,o,this.orderByCalled_)},equalTo:function(e,t){if(fb.util.validation.validateArgCount("Query.equalTo",1,2,arguments.length),fb.core.util.validation.validateFirebaseDataArg("Query.equalTo",1,e,this.path,!1),fb.core.util.validation.validateKey("Query.equalTo",2,t,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to endAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(e,t).endAt(e,t)},toString:function(){return fb.util.validation.validateArgCount("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},queryObject:function(){return this.queryParams_.getQueryObject()},queryIdentifier:function(){var e=this.queryObject(),t=fb.core.util.ObjectToUniqueKey(e);return"{}"===t?"default":t},getCancelAndContextArgs_:function(e,t,o){var r={cancel:null,context:null};if(t&&o)r.cancel=t,fb.util.validation.validateCallback(e,3,r.cancel,!0),r.context=o,fb.util.validation.validateContextObject(e,4,r.context,!0);else if(t)if("object"==typeof t&&null!==t)r.context=t;else{if("function"!=typeof t)throw new Error(fb.util.validation.errorPrefix(e,3,!0)+" must either be a cancel callback or a context object.");r.cancel=t}return r}}),goog.exportProperty(fb.api.Query.prototype,"ref",fb.api.Query.prototype.ref),goog.exportProperty(fb.api.Query.prototype,"on",fb.api.Query.prototype.on),goog.exportProperty(fb.api.Query.prototype,"off",fb.api.Query.prototype.off),goog.exportProperty(fb.api.Query.prototype,"once",fb.api.Query.prototype.once),goog.exportProperty(fb.api.Query.prototype,"limit",fb.api.Query.prototype.limit),goog.exportProperty(fb.api.Query.prototype,"limitToFirst",fb.api.Query.prototype.limitToFirst),goog.exportProperty(fb.api.Query.prototype,"limitToLast",fb.api.Query.prototype.limitToLast),goog.exportProperty(fb.api.Query.prototype,"orderByChild",fb.api.Query.prototype.orderByChild),goog.exportProperty(fb.api.Query.prototype,"orderByKey",fb.api.Query.prototype.orderByKey),goog.exportProperty(fb.api.Query.prototype,"orderByPriority",fb.api.Query.prototype.orderByPriority),goog.exportProperty(fb.api.Query.prototype,"orderByValue",fb.api.Query.prototype.orderByValue),goog.exportProperty(fb.api.Query.prototype,"startAt",fb.api.Query.prototype.startAt),goog.exportProperty(fb.api.Query.prototype,"endAt",fb.api.Query.prototype.endAt),goog.exportProperty(fb.api.Query.prototype,"equalTo",fb.api.Query.prototype.equalTo),goog.exportProperty(fb.api.Query.prototype,"toString",fb.api.Query.prototype.toString),goog.provide("fb.api.TEST_ACCESS"),goog.require("fb.core.PersistentConnection"),fb.api.TEST_ACCESS.DataConnection=fb.core.PersistentConnection,goog.exportProperty(fb.api.TEST_ACCESS,"DataConnection",fb.api.TEST_ACCESS.DataConnection),fb.core.PersistentConnection.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},goog.exportProperty(fb.api.TEST_ACCESS.DataConnection.prototype,"simpleListen",fb.api.TEST_ACCESS.DataConnection.prototype.simpleListen),fb.core.PersistentConnection.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},goog.exportProperty(fb.api.TEST_ACCESS.DataConnection.prototype,"echo",fb.api.TEST_ACCESS.DataConnection.prototype.echo),goog.exportProperty(fb.core.PersistentConnection.prototype,"interrupt",fb.core.PersistentConnection.prototype.interrupt),fb.api.TEST_ACCESS.RealTimeConnection=fb.realtime.Connection,goog.exportProperty(fb.api.TEST_ACCESS,"RealTimeConnection",fb.api.TEST_ACCESS.RealTimeConnection),goog.exportProperty(fb.realtime.Connection.prototype,"sendRequest",fb.realtime.Connection.prototype.sendRequest),goog.exportProperty(fb.realtime.Connection.prototype,"close",fb.realtime.Connection.prototype.close),fb.api.TEST_ACCESS.hijackHash=function(e){var t=fb.core.PersistentConnection.prototype.put;return fb.core.PersistentConnection.prototype.put=function(o,r,n,i){goog.isDef(i)&&(i=e()),t.call(this,o,r,n,i)},function(){fb.core.PersistentConnection.prototype.put=t}},goog.exportProperty(fb.api.TEST_ACCESS,"hijackHash",fb.api.TEST_ACCESS.hijackHash),fb.api.TEST_ACCESS.ConnectionTarget=fb.core.RepoInfo,goog.exportProperty(fb.api.TEST_ACCESS,"ConnectionTarget",fb.api.TEST_ACCESS.ConnectionTarget),fb.api.TEST_ACCESS.queryIdentifier=function(e){return e.queryIdentifier()},goog.exportProperty(fb.api.TEST_ACCESS,"queryIdentifier",fb.api.TEST_ACCESS.queryIdentifier),fb.api.TEST_ACCESS.listens=function(e){return e.repo.persistentConnection_.listens_},goog.exportProperty(fb.api.TEST_ACCESS,"listens",fb.api.TEST_ACCESS.listens),fb.api.TEST_ACCESS.forceRestClient=function(e){e.forceRestClient()},goog.exportProperty(fb.api.TEST_ACCESS,"forceRestClient",fb.api.TEST_ACCESS.forceRestClient),goog.provide("Firebase"),goog.require("fb.api.INTERNAL"),goog.require("fb.api.OnDisconnect"),goog.require("fb.api.Query"),goog.require("fb.api.TEST_ACCESS"),goog.require("fb.api.TransactionResult"),goog.require("fb.constants"),goog.require("fb.core.Repo"),goog.require("fb.core.RepoManager"),goog.require("fb.core.util"),goog.require("fb.core.util.Path"),goog.require("fb.core.util.enableLogging"),goog.require("fb.core.util.nextPushId"),goog.require("fb.core.util.validation"),goog.require("fb.core.view.QueryParams"),goog.require("fb.login.Constants"),goog.require("fb.util.obj"),goog.require("fb.util.promise"),goog.require("fb.util.promise.Deferred"),goog.require("fb.util.validation"),Firebase=goog.defineClass(fb.api.Query,{constructor:function(e,t){var o,r,n;if(e instanceof fb.core.Repo)o=e,r=t;else{fb.util.validation.validateArgCount("new Firebase",1,2,arguments.length);var i=fb.core.util.parseRepoInfo(arguments[0]),a=i.repoInfo;if(fb.core.util.validation.validateUrl("new Firebase",1,i),t)if(t instanceof fb.core.RepoManager)n=t;else{if(!goog.isString(t))throw new Error("Expected a valid Firebase.Context for second argument to new Firebase()");n=fb.core.RepoManager.getInstance(),a.persistenceKey=t}else n=fb.core.RepoManager.getInstance();o=n.getRepo(a),r=i.path}fb.api.Query.call(this,o,r,fb.core.view.QueryParams.DEFAULT,!1),this.then=void 0,this.catch=void 0},statics:{goOffline:function(){fb.util.validation.validateArgCount("Firebase.goOffline",0,0,arguments.length),fb.core.RepoManager.getInstance().interrupt()},goOnline:function(){fb.util.validation.validateArgCount("Firebase.goOnline",0,0,arguments.length),fb.core.RepoManager.getInstance().resume()},enableLogging:fb.core.util.enableLogging,ServerValue:{TIMESTAMP:{".sv":"timestamp"}},SDK_VERSION:fb.constants.CLIENT_VERSION,INTERNAL:fb.api.INTERNAL,Context:fb.core.RepoManager,TEST_ACCESS:fb.api.TEST_ACCESS},name:function(){return fb.core.util.warn("Firebase.name() being deprecated. Please use Firebase.key() instead."),fb.util.validation.validateArgCount("Firebase.name",0,0,arguments.length),this.key()},key:function(){return fb.util.validation.validateArgCount("Firebase.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},child:function(e){return fb.util.validation.validateArgCount("Firebase.child",1,1,arguments.length),goog.isNumber(e)?e=String(e):e instanceof fb.core.util.Path||(null===this.path.getFront()?fb.core.util.validation.validateRootPathString("Firebase.child",1,e,!1):fb.core.util.validation.validatePathString("Firebase.child",1,e,!1)),new Firebase(this.repo,this.path.child(e))},parent:function(){fb.util.validation.validateArgCount("Firebase.parent",0,0,arguments.length);var e=this.path.parent();return null===e?null:new Firebase(this.repo,e)},root:function(){fb.util.validation.validateArgCount("Firebase.ref",0,0,arguments.length);for(var e=this;null!==e.parent();)e=e.parent();return e},set:function(e,t){fb.util.validation.validateArgCount("Firebase.set",1,2,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.set",this.path),fb.core.util.validation.validateFirebaseDataArg("Firebase.set",1,e,this.path,!1),fb.util.validation.validateCallback("Firebase.set",2,t,!0);var o=new fb.util.promise.Deferred;return this.repo.setWithPriority(this.path,e,null,o.wrapCallback(t)),o.promise},update:function(e,t){if(fb.util.validation.validateArgCount("Firebase.update",1,2,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.update",this.path),goog.isArray(e)){for(var o={},r=0;r<e.length;++r)o[""+r]=e[r];e=o,fb.core.util.warn("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}fb.core.util.validation.validateFirebaseMergeDataArg("Firebase.update",1,e,this.path,!1),fb.util.validation.validateCallback("Firebase.update",2,t,!0);var n=new fb.util.promise.Deferred;return this.repo.update(this.path,e,n.wrapCallback(t)),n.promise},setWithPriority:function(e,t,o){if(fb.util.validation.validateArgCount("Firebase.setWithPriority",2,3,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.setWithPriority",this.path),fb.core.util.validation.validateFirebaseDataArg("Firebase.setWithPriority",1,e,this.path,!1),fb.core.util.validation.validatePriority("Firebase.setWithPriority",2,t,!1),fb.util.validation.validateCallback("Firebase.setWithPriority",3,o,!0),".length"===this.key()||".keys"===this.key())throw"Firebase.setWithPriority failed: "+this.key()+" is a read-only object.";var r=new fb.util.promise.Deferred;return this.repo.setWithPriority(this.path,e,t,r.wrapCallback(o)),r.promise},remove:function(e){return fb.util.validation.validateArgCount("Firebase.remove",0,1,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.remove",this.path),fb.util.validation.validateCallback("Firebase.remove",1,e,!0),this.set(null,e)},transaction:function(e,t,o){if(fb.util.validation.validateArgCount("Firebase.transaction",1,3,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.transaction",this.path),fb.util.validation.validateCallback("Firebase.transaction",1,e,!1),fb.util.validation.validateCallback("Firebase.transaction",2,t,!0),fb.core.util.validation.validateBoolean("Firebase.transaction",3,o,!0),".length"===this.key()||".keys"===this.key())throw"Firebase.transaction failed: "+this.key()+" is a read-only object.";"undefined"==typeof o&&(o=!0);var r=new fb.util.promise.Deferred;goog.isFunction(t)&&fb.util.promise.attachDummyErrorHandler(r.promise);var n=function(e,o,n){e?r.reject(e):r.resolve(new fb.api.TransactionResult(o,n)),goog.isFunction(t)&&t(e,o,n)};return this.repo.startTransaction(this.path,e,n,o),r.promise},setPriority:function(e,t){fb.util.validation.validateArgCount("Firebase.setPriority",1,2,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.setPriority",this.path),fb.core.util.validation.validatePriority("Firebase.setPriority",1,e,!1),fb.util.validation.validateCallback("Firebase.setPriority",2,t,!0);var o=new fb.util.promise.Deferred;return this.repo.setWithPriority(this.path.child(".priority"),e,null,o.wrapCallback(t)),o.promise},push:function(e,t){fb.util.validation.validateArgCount("Firebase.push",0,2,arguments.length),fb.core.util.validation.validateWritablePath("Firebase.push",this.path),fb.core.util.validation.validateFirebaseDataArg("Firebase.push",1,e,this.path,!0),fb.util.validation.validateCallback("Firebase.push",2,t,!0);var o=this.repo.serverTime(),r=fb.core.util.nextPushId(o),n=this.child(r);if(goog.isDefAndNotNull(e)){var i=this,a=n.set(e,t).then(function(){return i.child(r)});n.then=goog.bind(a.then,a),n.catch=goog.bind(a.then,a,void 0),goog.isFunction(t)&&fb.util.promise.attachDummyErrorHandler(a)}return n},onDisconnect:function(){return fb.core.util.validation.validateWritablePath("Firebase.onDisconnect",this.path),new fb.api.OnDisconnect(this.repo,this.path)},auth:function(e,t,o){fb.core.util.warn("FirebaseRef.auth() being deprecated. Please use FirebaseRef.authWithCustomToken() instead."),fb.util.validation.validateArgCount("Firebase.auth",1,3,arguments.length),fb.core.util.validation.validateCredential("Firebase.auth",1,e,!1),fb.util.validation.validateCallback("Firebase.auth",2,t,!0),fb.util.validation.validateCallback("Firebase.auth",3,t,!0);var r={};r[fb.login.Constants.CLIENT_OPTION_SESSION_PERSISTENCE]="none";var n=this,i=new fb.util.promise.Deferred;return n.repo.auth.authenticate(e,{},r,i.wrapCallback(t),o),i.promise},unauth:function(e){fb.util.validation.validateArgCount("Firebase.unauth",0,1,arguments.length),fb.util.validation.validateCallback("Firebase.unauth",1,e,!0);var t=new fb.util.promise.Deferred;return this.repo.auth.unauthenticate(t.wrapCallback(e)),t.promise},getAuth:function(){return fb.util.validation.validateArgCount("Firebase.getAuth",0,0,arguments.length),this.repo.auth.getAuth()},onAuth:function(e,t){fb.util.validation.validateArgCount("Firebase.onAuth",1,2,arguments.length),fb.util.validation.validateCallback("Firebase.onAuth",1,e,!1),fb.util.validation.validateContextObject("Firebase.onAuth",2,t,!0),this.repo.auth.on("auth_status",e,t)},offAuth:function(e,t){fb.util.validation.validateArgCount("Firebase.offAuth",1,2,arguments.length),fb.util.validation.validateCallback("Firebase.offAuth",1,e,!1),fb.util.validation.validateContextObject("Firebase.offAuth",2,t,!0),this.repo.auth.off("auth_status",e,t)},authWithCustomToken:function(e,t,o){fb.util.validation.validateArgCount("Firebase.authWithCustomToken",1,3,arguments.length),2===arguments.length&&fb.util.obj.isNonNullObject(t)&&(o=t,t=void 0),fb.core.util.validation.validateCredential("Firebase.authWithCustomToken",1,e,!1),fb.util.validation.validateCallback("Firebase.authWithCustomToken",2,t,!0),fb.core.util.validation.validateObject("Firebase.authWithCustomToken",3,o,!0);var r=new fb.util.promise.Deferred;return this.repo.auth.authenticate(e,{},o||{},r.wrapCallback(t)),r.promise},authWithOAuthPopup:function(e,t,o){fb.util.validation.validateArgCount("Firebase.authWithOAuthPopup",1,3,arguments.length),2===arguments.length&&fb.util.obj.isNonNullObject(t)&&(o=t,t=void 0),fb.core.util.validation.validateAuthProvider("Firebase.authWithOAuthPopup",1,e,!1),fb.util.validation.validateCallback("Firebase.authWithOAuthPopup",2,t,!0),fb.core.util.validation.validateObject("Firebase.authWithOAuthPopup",3,o,!0);var r=new fb.util.promise.Deferred;return this.repo.auth.authWithPopup(e,o,r.wrapCallback(t)),r.promise},authWithOAuthRedirect:function(e,t,o){fb.util.validation.validateArgCount("Firebase.authWithOAuthRedirect",1,3,arguments.length),2===arguments.length&&fb.util.obj.isNonNullObject(t)&&(o=t,t=void 0),fb.core.util.validation.validateAuthProvider("Firebase.authWithOAuthRedirect",1,e,!1),fb.util.validation.validateCallback("Firebase.authWithOAuthRedirect",2,t,!1),fb.core.util.validation.validateObject("Firebase.authWithOAuthRedirect",3,o,!0);var r=new fb.util.promise.Deferred;return this.repo.auth.authWithRedirect(e,o,r.wrapCallback(t)),r.promise},authWithOAuthToken:function(e,t,o,r){fb.util.validation.validateArgCount("Firebase.authWithOAuthToken",2,4,arguments.length),3===arguments.length&&fb.util.obj.isNonNullObject(o)&&(r=o,o=void 0),fb.core.util.validation.validateAuthProvider("Firebase.authWithOAuthToken",1,e,!1),fb.util.validation.validateCallback("Firebase.authWithOAuthToken",3,o,!0),fb.core.util.validation.validateObject("Firebase.authWithOAuthToken",4,r,!0);var n=new fb.util.promise.Deferred;return goog.isString(t)?(fb.core.util.validation.validateString("Firebase.authWithOAuthToken",2,t,!1),this.repo.auth.authWithCredential(e+"/token",{access_token:t},r,n.wrapCallback(o))):(fb.core.util.validation.validateObject("Firebase.authWithOAuthToken",2,t,!1),this.repo.auth.authWithCredential(e+"/token",t,r,n.wrapCallback(o))),n.promise},authAnonymously:function(e,t){fb.util.validation.validateArgCount("Firebase.authAnonymously",0,2,arguments.length),1===arguments.length&&fb.util.obj.isNonNullObject(e)&&(t=e,e=void 0),fb.util.validation.validateCallback("Firebase.authAnonymously",1,e,!0),fb.core.util.validation.validateObject("Firebase.authAnonymously",2,t,!0);var o=new fb.util.promise.Deferred;return this.repo.auth.authWithCredential("anonymous",{},t,o.wrapCallback(e)),o.promise},authWithPassword:function(e,t,o){fb.util.validation.validateArgCount("Firebase.authWithPassword",1,3,arguments.length),2===arguments.length&&fb.util.obj.isNonNullObject(t)&&(o=t,
t=void 0),fb.core.util.validation.validateObject("Firebase.authWithPassword",1,e,!1),fb.core.util.validation.validateObjectContainsKey("Firebase.authWithPassword",1,e,"email",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.authWithPassword",1,e,"password",!1,"string"),fb.util.validation.validateCallback("Firebase.authWithPassword",2,t,!0),fb.core.util.validation.validateObject("Firebase.authWithPassword",3,o,!0);var r=new fb.util.promise.Deferred;return this.repo.auth.authWithCredential("password",e,o,r.wrapCallback(t)),r.promise},createUser:function(e,t){fb.util.validation.validateArgCount("Firebase.createUser",1,2,arguments.length),fb.core.util.validation.validateObject("Firebase.createUser",1,e,!1),fb.core.util.validation.validateObjectContainsKey("Firebase.createUser",1,e,"email",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.createUser",1,e,"password",!1,"string"),fb.util.validation.validateCallback("Firebase.createUser",2,t,!0);var o=new fb.util.promise.Deferred;return this.repo.auth.createUser(e,o.wrapCallback(t)),o.promise},removeUser:function(e,t){fb.util.validation.validateArgCount("Firebase.removeUser",1,2,arguments.length),fb.core.util.validation.validateObject("Firebase.removeUser",1,e,!1),fb.core.util.validation.validateObjectContainsKey("Firebase.removeUser",1,e,"email",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.removeUser",1,e,"password",!1,"string"),fb.util.validation.validateCallback("Firebase.removeUser",2,t,!0);var o=new fb.util.promise.Deferred;return this.repo.auth.removeUser(e,o.wrapCallback(t)),o.promise},changePassword:function(e,t){fb.util.validation.validateArgCount("Firebase.changePassword",1,2,arguments.length),fb.core.util.validation.validateObject("Firebase.changePassword",1,e,!1),fb.core.util.validation.validateObjectContainsKey("Firebase.changePassword",1,e,"email",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.changePassword",1,e,"oldPassword",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.changePassword",1,e,"newPassword",!1,"string"),fb.util.validation.validateCallback("Firebase.changePassword",2,t,!0);var o=new fb.util.promise.Deferred;return this.repo.auth.changePassword(e,o.wrapCallback(t)),o.promise},changeEmail:function(e,t){fb.util.validation.validateArgCount("Firebase.changeEmail",1,2,arguments.length),fb.core.util.validation.validateObject("Firebase.changeEmail",1,e,!1),fb.core.util.validation.validateObjectContainsKey("Firebase.changeEmail",1,e,"oldEmail",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.changeEmail",1,e,"newEmail",!1,"string"),fb.core.util.validation.validateObjectContainsKey("Firebase.changeEmail",1,e,"password",!1,"string"),fb.util.validation.validateCallback("Firebase.changeEmail",2,t,!0);var o=new fb.util.promise.Deferred;return this.repo.auth.changeEmail(e,o.wrapCallback(t)),o.promise},resetPassword:function(e,t){fb.util.validation.validateArgCount("Firebase.resetPassword",1,2,arguments.length),fb.core.util.validation.validateObject("Firebase.resetPassword",1,e,!1),fb.core.util.validation.validateObjectContainsKey("Firebase.resetPassword",1,e,"email",!1,"string"),fb.util.validation.validateCallback("Firebase.resetPassword",2,t,!0);var o=new fb.util.promise.Deferred;return this.repo.auth.resetPassword(e,o.wrapCallback(t)),o.promise}}),NODE_CLIENT&&(module.exports=Firebase)},ns.wrapper(ns.goog,ns.fb)}({goog:{},fb:{}});