<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../google-apis/google-legacy-loader.html">


</head><body><dom-module id="google-feeds">
  <template>
    <div id="content"></div>
  </template>
</dom-module>
<script>!function(){Polymer({is:"google-feeds",properties:{feed:{type:String,observer:"_feedChanged"},feeds:{type:Array,value:function(){return[]},observer:"_feedsChanged"},results:{type:Object,value:null,notify:!0},query:{type:String,observer:"_queryChanged"},count:{type:Number,value:32},loading:{type:Boolean,notify:!0},format:{type:String,value:"json"}},attached:function(){this.pendingFeeds=[]},_feedChanged:function(){this.feed?(this.loading=!0,this._withFeedsApi(this._fetchFeeds.bind(this))):this.results=null},_fetchFeeds:function(){var e=new google.feeds.Feed(this.feed);e.setResultFormat(this._format()),e.includeHistoricalEntries(),e.setNumEntries(this.count),e.load(this._fetchFeedsDone.bind(this))},_fetchFeedsDone:function(e){this.loading=!1,e.error?(this.results={},this.fire("google-feeds-error",{status:e.status})):(e.m===google.feeds.Feed.MIXED_FORMAT&&(e.feed.xmlDocument=e.xmlDocument),this.results=e.m===google.feeds.Feed.XML_FORMAT?e.xmlDocument:e.feed,this.fire("google-feeds-response",{feed:this.results}))},_feedsChanged:function(){this._withFeedsApi(function(e){this._fetchMultipleFeeds(this.feeds,function(e){this.fire("google-multi-feeds-response",{feeds:e})})}.bind(this))},_fetchMultipleFeeds:function(e,s){var t=new google.feeds.FeedControl;e&&(e.forEach(function(e){t.addFeed(e)}),t.setNumEntries(this.count),t.draw(this.$.content),google.setOnLoadCallback(s))},_queryChanged:function(){this.query&&(this.loading=!0,this._withFeedsApi(this._findFeeds.bind(this)))},_findFeeds:function(){google.feeds.findFeeds(this.query,this._findFeedsDone.bind(this))},_findFeedsDone:function(e){this.loading=!1,e.error?this.fire("google-feeds-queryerror",{status:e.status}):this.fire("google-feeds-queryresponse",{entries:e.entries})},_feedsCallbacks:[],_feedsApiLoaded:function(){for(;this._feedsCallbacks.length;){var e=this._feedsCallbacks.shift();e()}},_isApiLoaded:function(){return!!(window.google&&google.feeds&&google.feeds.Feed)},_withFeedsApi:function(e){if(this._isApiLoaded()&&e)e();else{if(!this.feedsApiLoading){var s=this._feedsApiLoaded.bind(this),t=document.createElement("google-legacy-loader");t.addEventListener("api-load",function(e){google.load("feeds","1",{callback:s})}),this.feedsApiLoading=!0}e&&this._feedsCallbacks.push(e)}},_format:function(){switch(this.format){case"xml":return google.feeds.Feed.XML_FORMAT;case"mixed":return google.feeds.Feed.MIXED_FORMAT;case"json":default:return google.feeds.Feed.JSON_FORMAT}}})}();</script>
</body></html>