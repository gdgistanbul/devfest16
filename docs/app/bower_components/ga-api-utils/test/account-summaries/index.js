var accountSummaries=require("../../lib/account-summaries"),assert=require("assert"),fixtures=require("./fixtures"),sinon=require("sinon");require("./stubs/gapi"),describe("accountSummaries",function(){describe(".get",function(){it('returns a "thenable" that is resolved with an account summaries array.',function(t){var e=accountSummaries.get();assert("then"in e),e.then(function(e){assert.deepEqual(e.all(),fixtures.get().items),t()}).catch(t)}),it("does not query the API more than once, even with multiple calls.",function(t){var e=sinon.spy(gapi.client.analytics.management.accountSummaries,"list");accountSummaries.get().then(function(a){accountSummaries.get().then(function(n){accountSummaries.get().then(function(s){assert(0===e.callCount),assert.equal(a,n),assert.equal(n,s),assert.deepEqual(s.all(),fixtures.get().items),e.restore(),t()}).catch(t)})})}),it("accepts an optional parameter to clear the cache.",function(t){var e=sinon.spy(gapi.client.analytics.management.accountSummaries,"list");accountSummaries.get(!0).then(function(a){accountSummaries.get(!0).then(function(n){accountSummaries.get(!0).then(function(s){assert.equal(e.callCount,3),assert.notEqual(a,n),assert.notEqual(n,s),assert.deepEqual(a,n),assert.deepEqual(n,s),assert.deepEqual(s.all(),fixtures.get().items),e.restore(),t()}).catch(t)})})}),it("returns the full account summaries list, not a paginatated one.",function(t){var e=gapi.client.analytics.management.accountSummaries.list,a=sinon.stub(gapi.client.analytics.management.accountSummaries,"list",function(t){return t=t||{},t["max-results"]=2,e(t)});accountSummaries.get(!0).then(function(e){assert.equal(a.callCount,3),assert.deepEqual(e.all(),fixtures.get().items),a.restore(),t()}).catch(t)}),it("throws if the user requesting the summares does not have any Google Analytics accounts.",function(t){fixtures.set("without-account"),accountSummaries.get(!0).catch(function(e){assert.equal(e.message,"You do not have any Google Analytics accounts. Go to http://google.com/analytics to sign up."),fixtures.set("with-account"),t()})})})});