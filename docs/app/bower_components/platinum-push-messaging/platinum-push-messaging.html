<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../promise-polyfill/promise-polyfill.html">

<script>!function(){"use strict";var t=(document.currentScript||{}).baseURI,e=new URL("./$$platinum-push-messaging$$/",t).href,i=new URL("./",document.location.href).href,n="serviceWorker"in navigator&&"PushManager"in window&&"Notification"in window,s=1;"PushSubscription"in window||(window.PushSubscription={}),Polymer({is:"platinum-push-messaging",properties:{supported:{readOnly:!0,type:Boolean,value:function(){return n}},subscription:{readOnly:!0,type:PushSubscription,notify:!0},enabled:{readOnly:!0,type:Boolean,notify:!0,value:!1},workerUrl:{type:String,value:function(){return new URL("./service-worker.js",t).href}},messageUrl:String,title:String,message:String,tag:String,iconUrl:String,dir:{type:String,value:"auto"},lang:String,noscreen:{type:Boolean,value:!1},renotify:{type:Boolean,value:!1},silent:{type:Boolean,value:!1},sticky:{type:Boolean,value:!1},vibrate:Array,sound:String,clickUrl:{type:String,value:document.location.href}},_getRegistration:function(){return navigator.serviceWorker.getRegistration(e).then(function(t){if(t&&t.scope===e)return t})},_registrationReady:function(t){if(t.active)return Promise.resolve();var e=t.installing||t.waiting;return new Promise(function(t,i){"activated"===e.state&&t();var n=function(s){if("activated"===e.state)t();else{if("redundant"!==e.state)return;i(new Error("Worker became redundant"))}e.removeEventListener("statechange",n)};e.addEventListener("statechange",n)})},_messageHandler:function(t){if(t.data&&t.data.source===e)switch(t.data.type){case"push":this.fire("platinum-push-messaging-push",t.data);break;case"click":this.fire("platinum-push-messaging-click",t.data)}},_serializeOptions:function(t){var e=Object.keys(t);e.sort();var i=e.filter(function(e){return!!t[e]}).map(function(e){return JSON.stringify(e)+":"+JSON.stringify(t[e])});return encodeURIComponent("{"+i.join(",")+"}")},_getWorkerURL:function(){var t=this._serializeOptions({tag:this.tag,messageUrl:this.messageUrl,title:this.title,message:this.message,iconUrl:this.iconUrl,clickUrl:this.clickUrl,dir:this.dir,lang:this.lang,noscreen:this.noscreen,renotify:this.renotify,silent:this.silent,sound:this.sound,sticky:this.sticky,vibrate:this.vibrate,version:s,baseUrl:i});return this.workerUrl+"?"+t},_updateSubscription:function(t){JSON.stringify(t)!==JSON.stringify(this.subscription)&&this._setSubscription(t)},testPush:function(t){this._getRegistration().then(function(e){e.active.postMessage({type:"test-push",message:t})})},enable:function(){return this.supported?navigator.serviceWorker.register(this._getWorkerURL(),{scope:e}).then(function(t){return this._registrationReady(t).then(function(){return t.pushManager.subscribe({userVisibleOnly:!0})})}.bind(this)).then(function(t){this._updateSubscription(t),this._setEnabled(!0)}.bind(this)).catch(function(t){this.fire("platinum-push-messaging-error",t.message||t)}.bind(this)):(this.fire("platinum-push-messaging-error","Your browser does not support push notifications"),Promise.resolve())},disable:function(){return this.supported?this._getRegistration().then(function(t){if(t)return t.pushManager.getSubscription().then(function(t){if(t)return t.unsubscribe()}).then(function(){return t.unregister()}).then(function(){this._updateSubscription(),this._setEnabled(!1)}.bind(this)).catch(function(t){this.fire("platinum-push-messaging-error",t.message||t)}.bind(this))}.bind(this)):Promise.resolve()},ready:function(){if(this.supported){var t=this._messageHandler.bind(this);window.addEventListener("message",t),navigator.serviceWorker.addEventListener("message",t),this._getRegistration().then(function(t){if(t)return t.active&&t.active.scriptURL!==this._getWorkerURL()?this.enable():t.pushManager.getSubscription().then(function(t){this._updateSubscription(t),this._setEnabled(!0)}.bind(this))}.bind(this))}}})}();</script>
</head><body></body></html>