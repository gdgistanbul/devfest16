<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="firebase.html">

<script>Polymer.FirebaseQueryBehavior={properties:{location:{type:String,notify:!0,reflectToAttribute:!0},query:{type:Object,notify:!0,readOnly:!0},log:{type:Boolean,value:!1,reflectToAttribute:!0}},observers:["_dataChanged(data.*)"],created:function(){this._receivingLocalChanges=!1,this._receivingRemoteChanges=!1},get dataAsObject(){return Array.isArray(this.data)?this.data.reduce(function(e,i,t){e[t]=i},{}):this.data},disconnect:function(){this.location=""},_localDataChanged:function(e){},_applyLocalDataChange:function(e){this._receivingLocalChanges=!0,e.call(this),this._receivingLocalChanges=!1},_applyRemoteDataChange:function(e){this._receivingRemoteChanges=!0,e.call(this),this._receivingRemoteChanges=!1},_dataChanged:function(e){this._receivingRemoteChanges||this._receivingLocalChanges||this._localDataChanged(e)},_queryChanged:function(e,i){i&&this._stopListeningToQuery(i),e&&this._listenToQuery(e)},_listenToQuery:function(e){this._log("Adding Firebase event handlers."),e.on("value",this._onQueryValue,this._onQueryCancel,this),e.on("child_added",this._onQueryChildAdded,this._onQueryCancel,this),e.on("child_removed",this._onQueryChildRemoved,this._onQueryCancel,this),e.on("child_changed",this._onQueryChildChanged,this._onQueryCancel,this),e.on("child_moved",this._onQueryChildMoved,this._onQueryCancel,this)},_stopListeningToQuery:function(e){this._log("Removing Firebase event handlers"),e.off("value",this._onQueryValue,this),e.off("child_added",this._onQueryChildAdded,this),e.off("child_removed",this._onQueryChildRemoved,this),e.off("child_changed",this._onQueryChildChanged,this),e.off("child_moved",this._onQueryChildMoved,this)},_onQueryValue:function(e){this._log('Firebase Event: "value"',e),this.fire("firebase-value",e,{bubbles:!1})},_onQueryChildAdded:function(e,i){this._log('Firebase Event: "child_added"',e,i),this.fire("firebase-child-added",{childSnapshot:e,previousChildName:i},{bubbles:!1})},_onQueryChildRemoved:function(e){this._log('Firebase Event: "child_removed"',e),this.fire("firebase-child-removed",{oldChildSnapshot:e},{bubbles:!1})},_onQueryChildChanged:function(e,i){this._log('Firebase Event: "child_changed"',e,i),this.fire("firebase-child-changed",{childSnapshot:e,previousChildName:i},{bubbles:!1})},_onQueryChildMoved:function(e,i){this._log('Firebase Event: "child_moved"',e,i),this.fire("firebase-child-moved",{childSnapshot:e,previousChildName:i},{bubbles:!1})},_onQueryCancel:function(e){e&&this._error("Firebase Error",e),this._log("Firebase query subscription cancelled."),this.disconnect()},_fireQueryError:function(e){this.fire("firebase-query-error",e),this._error(e)},_log:function(){var e;this.log&&(e=Array.prototype.slice.call(arguments).map(function(e){return e&&"function"==typeof e.val?e.val():e}),console.log.apply(console,e))},_warn:function(){this.log&&Polymer.Base._warn(this._log.apply(this,arguments))},_error:function(){this.log&&Polymer.Base._error(this._log.apply(this,arguments))}};</script>
</head><body></body></html>