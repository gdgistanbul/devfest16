"use strict";function page(e,t){if("function"==typeof e)return page("*",e);if("function"==typeof t)for(var n=new Route(e),a=1;a<arguments.length;++a)page.callbacks.push(n.middleware(arguments[a]));else"string"==typeof e?page["string"==typeof t?"redirect":"show"](e,t):page.start(e)}function unhandled(e){if(!e.handled){var t;t=hashbang?base+location.hash.replace("#!",""):location.pathname+location.search,t!==e.canonicalPath&&(page.stop(),e.handled=!1,location.href=e.canonicalPath)}}function decodeURLEncodedURIComponent(e){return"string"!=typeof e?e:decodeURLComponents?decodeURIComponent(e.replace(/\+/g," ")):e}function Context(e,t){"/"===e[0]&&0!==e.indexOf(base)&&(e=base+(hashbang?"#!":"")+e);var n=e.indexOf("?");if(this.canonicalPath=e,this.path=e.replace(base,"")||"/",hashbang&&(this.path=this.path.replace("#!","")||"/"),this.title=document.title,this.state=t||{},this.state.path=e,this.querystring=~n?decodeURLEncodedURIComponent(e.slice(n+1)):"",this.pathname=decodeURLEncodedURIComponent(~n?e.slice(0,n):e),this.params={},this.hash="",!hashbang){if(!~this.path.indexOf("#"))return;var a=this.path.split("#");this.path=a[0],this.hash=decodeURLEncodedURIComponent(a[1])||"",this.querystring=this.querystring.split("#")[0]}}function Route(e,t){t=t||{},this.path="*"===e?"(.*)":e,this.method="GET",this.regexp=pathtoRegexp(this.path,this.keys=[],t.sensitive,t.strict)}function onclick(e){if(1===which(e)&&!(e.metaKey||e.ctrlKey||e.shiftKey||e.defaultPrevented)){for(var t=e.target;t&&"A"!==t.nodeName;)t=t.parentNode;if(t&&"A"===t.nodeName&&!t.hasAttribute("download")&&"external"!==t.getAttribute("rel")){var n=t.getAttribute("href");if((hashbang||t.pathname!==location.pathname||!t.hash&&"#"!==n)&&!(n&&n.indexOf("mailto:")>-1)&&!t.target&&sameOrigin(t.href)){var a=t.pathname+t.search+(t.hash||"");"undefined"!=typeof process&&a.match(/^\/[a-zA-Z]:\//)&&(a=a.replace(/^\/[a-zA-Z]:\//,"/"));var o=a;0===a.indexOf(base)&&(a=a.substr(base.length)),hashbang&&(a=a.replace("#!","")),base&&o===a||(e.preventDefault(),page.show(o))}}}}function which(e){return e=e||window.event,null===e.which?e.button:e.which}function sameOrigin(e){var t=location.protocol+"//"+location.hostname;return location.port&&(t+=":"+location.port),e&&0===e.indexOf(t)}var pathtoRegexp=require("path-to-regexp");module.exports=page;var clickEvent="undefined"!=typeof document&&document.ontouchstart?"touchstart":"click",location="undefined"!=typeof window&&(window.history.location||window.location),dispatch=!0,decodeURLComponents=!0,base="",running,hashbang=!1,prevContext;page.callbacks=[],page.exits=[],page.current="",page.len=0,page.base=function(e){return 0===arguments.length?base:void(base=e)},page.start=function(e){if(e=e||{},!running&&(running=!0,!1===e.dispatch&&(dispatch=!1),!1===e.decodeURLComponents&&(decodeURLComponents=!1),!1!==e.popstate&&window.addEventListener("popstate",onpopstate,!1),!1!==e.click&&document.addEventListener(clickEvent,onclick,!1),!0===e.hashbang&&(hashbang=!0),dispatch)){var t=hashbang&&~location.hash.indexOf("#!")?location.hash.substr(2)+location.search:location.pathname+location.search+location.hash;page.replace(t,null,!0,dispatch)}},page.stop=function(){running&&(page.current="",page.len=0,running=!1,document.removeEventListener(clickEvent,onclick,!1),window.removeEventListener("popstate",onpopstate,!1))},page.show=function(e,t,n,a){var o=new Context(e,t);return page.current=o.path,!1!==n&&page.dispatch(o),!1!==o.handled&&!1!==a&&o.pushState(),o},page.back=function(e,t){page.len>0?(history.back(),page.len--):e?setTimeout(function(){page.show(e,t)}):setTimeout(function(){page.show(base,t)})},page.redirect=function(e,t){"string"==typeof e&&"string"==typeof t&&page(e,function(e){setTimeout(function(){page.replace(t)},0)}),"string"==typeof e&&"undefined"==typeof t&&setTimeout(function(){page.replace(e)},0)},page.replace=function(e,t,n,a){var o=new Context(e,t);return page.current=o.path,o.init=n,o.save(),!1!==a&&page.dispatch(o),o},page.dispatch=function(e){function t(){var e=page.exits[i++];return e?void e(a,t):n()}function n(){var t=page.callbacks[o++];return e.path!==page.current?void(e.handled=!1):t?void t(e,n):unhandled(e)}var a=prevContext,o=0,i=0;prevContext=e,a?t():n()},page.exit=function(e,t){if("function"==typeof e)return page.exit("*",e);for(var n=new Route(e),a=1;a<arguments.length;++a)page.exits.push(n.middleware(arguments[a]))},page.Context=Context,Context.prototype.pushState=function(){page.len++,history.pushState(this.state,this.title,hashbang&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},Context.prototype.save=function(){history.replaceState(this.state,this.title,hashbang&&"/"!==this.path?"#!"+this.path:this.canonicalPath)},page.Route=Route,Route.prototype.middleware=function(e){var t=this;return function(n,a){return t.match(n.path,n.params)?e(n,a):void a()}},Route.prototype.match=function(e,t){var n=this.keys,a=e.indexOf("?"),o=~a?e.slice(0,a):e,i=this.regexp.exec(decodeURIComponent(o));if(!i)return!1;for(var s=1,r=i.length;s<r;++s){var h=n[s-1],p=decodeURLEncodedURIComponent(i[s]);void 0===p&&hasOwnProperty.call(t,h.name)||(t[h.name]=p)}return!0};var onpopstate=function(){var e=!1;if("undefined"!=typeof window)return"complete"===document.readyState?e=!0:window.addEventListener("load",function(){setTimeout(function(){e=!0},0)}),function(t){if(e)if(t.state){var n=t.state.path;page.replace(n,t.state)}else page.show(location.pathname+location.hash,void 0,void 0,!1)}}();page.sameOrigin=sameOrigin;